<!doctype html>
<html lang="en" id="theme">
<!-- class="dark-theme" -->

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--favicon-->
    <link rel="icon" href="public/images/logo/logo_bar.png" type="image/png" />
    <!--plugins-->
    <link rel="stylesheet" href="public/plugins/simplebar/css/simplebar.css" />
    <link rel="stylesheet" href="public/plugins/perfect-scrollbar/css/perfect-scrollbar.css" />
    <link rel="stylesheet" href="public/plugins/metismenu/css/metisMenu.min.css" />
    <!-- loader-->
    <link rel="stylesheet" href="public/stylesheets/pace.min.css" />
    <!-- <script src="public/javascripts/pace.min.js"></script> -->
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="public/stylesheets/bootstrap.min.css">
    <link rel="stylesheet" href="public/stylesheets/font.css">
    <link rel="stylesheet" href="public/stylesheets/app.css">
    <link rel="stylesheet" href="public/stylesheets/icons.css">
    <!-- Theme Style CSS -->
    <link rel="stylesheet" href="public/stylesheets/dark-theme.css" />
    <link rel="stylesheet" href="public/stylesheets/semi-dark.css" />
    <link rel="stylesheet" href="public/stylesheets/header-colors.css" />

    <link href="public/plugins/datatable/css/dataTables.bootstrap5.min.css" rel="stylesheet" />
    <!-- <link rel="stylesheet" href="public/plugins/datatables/datatables.net.1.10.25.css"> -->
    <!-- <link rel="stylesheet" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css"> -->
    <!-- Loading -->
    <link href="public/plugins/Customizable-Loading-Modal-Plugin/css/modal-loading.css" rel="stylesheet" type="text/css">
    <!-- Popup CSS -->
    <link href="public/plugins/Magnific-Popup-master/dist/magnific-popup.css" rel="stylesheet">
    <!--Range slider CSS -->
    <link href="public/plugins/ion-rangeslider/css/ion.rangeSlider.css" rel="stylesheet">
    <link href="public/plugins/ion-rangeslider/css/ion.rangeSlider.skinModern.css" rel="stylesheet">
    <link href="public/stylesheets/css.css" rel="stylesheet">
    <title>Smart Green House by AI 5.0 AGRICULTURE INNOVATION</title>

    <!--plugins-->
    <script src="public/javascripts/jquery.min.js"></script>
    <script src="public/javascripts/moment.min.js" charset="utf-8"></script>

    <!-- datetime_control_n -->
    <link rel="stylesheet" href="public/plugins/DateTimePicke/src/DateTimePicker.css">
    <script src="public/plugins/DateTimePicke/src/DateTimePicker.js"></script>

    <script src="public/javascripts/decode.js"></script>
    <script src="routes/chack_login.js"></script>
    <!-- Bootstrap SW Toggle -->
    <!-- <link rel="stylesheet" href="public/plugins/bootstrap4-toggle/bootstrap4-toggle.min.css">
    <script src="public/plugins/bootstrap4-toggle/bootstrap4-toggle.min.js" charset="utf-8"></script> -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

    <!-- Date time Picker Report daterangepicker -->
    <!-- <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" /> -->
    <link rel="stylesheet" href="public/stylesheets/daterangepicker.css">
    <!-- <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script> -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>

    <!-- datetime_control -->
    <!-- <link rel="stylesheet" href="public/plugins/bootstrap-material-datetimepicker/css/bootstrap-material-datetimepicker.min.css"> -->
    <!-- <script src="public/plugins/bootstrap-material-datetimepicker/js/moment.min.js"></script> -->
    <!-- <script src="public/plugins/bootstrap-material-datetimepicker/js/bootstrap-material-datetimepicker.min.js"></script> -->

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <!-- <script src="//code.jquery.com/jquery-1.12.4.js"></script> -->
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <!-- sweetalert2 -->
    <!-- <link href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@4/dark.css" rel="stylesheet"> -->
    <!-- <link rel="stylesheet" href="@sweetalert2/theme-bootstrap-4/bootstrap-4.css"> -->
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-borderless/borderless.css"> -->
    <!-- <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@sweetalert2/theme-minimal/minimal.css"> -->
    <!-- <script src="//cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.js"></script> -->
    <style>
        /* .parent {
        display: flex;
        }

        .child {
            padding-left: 20px;
        }

        .child2 {
            padding-left: 0px;
            padding-right: 0px;
        }

        .child1 {
            margin-left: auto;
            padding-right: 20px;
        } */

        .ridge {
            border-style: ridge;
        }
        .toggle.ios,
        .toggle-on.ios,
        .toggle-off.ios {
            border-radius: 20px;
        }

        .toggle.ios .toggle-handle {
            border-radius: 20px;
        }

        .no-gutters {
            margin-right: 0;
            margin-left: 0;
        }

        .no-gutters>.col,
        .no-gutters>[class*="col-"] {
            padding-right: 0;
            padding-left: 0;
        }

        .text_font_size {font-size: 13.5px;}
        .text_blur{opacity: .5;}
    </style>
</head>

<body>
    <!--wrapper-->
    <div class="wrapper">
        <!--sidebar wrapper -->
        <div class="sidebar-wrapper" data-simplebar="true">
            <div class="sidebar-header">
                <div>
                    <!-- <img src="public/images/logo/logo3.png" class="logo-icon" alt="logo icon"> -->
                </div>
                <div>
                    <h4 class="logo-text">SMART GREENHOUSE</h4>
                </div>
                <div class="toggle-icon ms-auto"><i class='bx bx-menu'></i></div>
            </div>
            <!--navigation-->
            <ul class="metismenu" id="menu">
                <li class="memu_site">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='lni lni-map-marker'></i></div>
                        <div class="menu-title">สถานที่</div>
                    </a>
                </li>
                <li class="memu_house">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='lni lni-home'></i></div>
                        <div class="menu-title">โรงเรือน</div>
                    </a>
                </li>
                <li class="memu_dash">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='lni lni-graph'></i>
                        </div>
                        <div class="menu-title">แดชบอร์ด </div>
                    </a>
                </li>

                <li class="memu_control ">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='bx bx-slider-alt'></i>
                        </div>
                        <div class="menu-title">ระบบควบคุม </div>
                    </a>
                </li>
                <li class="memu_compare">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='lni lni-shuffle'></i>
                        </div>
                        <div class="menu-title">เปรียบเทียบข้อมูล </div>
                    </a>
                </li>
                <li class="memu_report">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class='lni lni-popup'></i>
                        </div>
                        <div class="menu-title">รายงาน </div>
                    </a>
                </li>
                <li class="memu_setting">
                    <a href="javascript:;">
                        <div class="parent-icon"><i class="bx bx-cog bx-spin"></i></div>
                        <div class="menu-title">ตั้งค่า</div>
                    </a>
                </li>
            </ul>
            <!--end navigation-->
        </div>
        <!--end sidebar wrapper -->
        <!--start header -->
        <header>
            <div class="topbar d-flex align-items-center">
                <nav class="navbar navbar-expand">
                    <div class="mobile-toggle-menu"><i class='bx bx-menu'></i></div>
                    <!-- <div class="search-bar flex-grow-1">
                        <div class="position-relative search-bar-box">
                            <input type="text" class="form-control search-control" placeholder="Type to search..."> <span class="position-absolute top-50 search-show translate-middle-y"><i class='bx bx-search'></i></span>
                            <span class="position-absolute top-50 search-close translate-middle-y"><i class='bx bx-x'></i></span>
                        </div>
                    </div> -->
                    <div class="top-menu ms-auto">
                        <ul class="navbar-nav align-items-center">

                        </ul>
                    </div>
                    <div class="user-box dropdown">
                        <a class="d-flex align-items-center nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <img src="" class="user-img" alt="user avatar">
                            <div class="user-info ps-3">
                                <p class="user-name mb-0 user_name"></p>
                                <!-- <input type="hidden" class="INuser_name"> -->
                                <!-- <p class="designattion mb-0">Web Designer</p> -->
                            </div>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item menu_setting" menu="1" href="javascript:;"><i class="bx bx-user"></i><span>บัญชี</span></a></li>
                            <!-- <li><a class="dropdown-item menu_setting menu2" menu="2" href="javascript:;"><i class="bx bx-cog"></i><span>ตั้งค่าสถานที่</span></a></li>
                            <li><a class="dropdown-item menu_setting menu3" menu="3" href="javascript:;"><i class="bx bx-cog"></i><span>ตั้งค่าโรงเรือน</span></a></li> -->
                            <li><a class="dropdown-item menu_setting menu4" menu="4" href="javascript:;"><i class="bx bx-cog"></i><span>กำหนดสิทธิ์ผู้ใช้งาน</span></a></li>
                            <li><a class="dropdown-item menu_setting menu5" menu="5" href="javascript:;"><i class="bx bx-cog"></i><span>ประวัติการเข้าสู่ระบบ</span></a></li>
                            <!-- <li><a class="dropdown-item btn_modal_sg" href="javascript:"><i class="lni lni-headphone-alt"></i><span>รายงานปัญหา</span></a></li> -->

                            <li>
                                <div class="dropdown-divider mb-0"></div>
                            </li>
                            <li><a class="dropdown-item logout" href="javascript:;"><i class='bx bx-log-out-circle'></i><span>ลงชื่อออก</span></a></li>
                        </ul>
                        <label id="switch2" class="switch2 ">
                            <input type="checkbox" id="toggleTheme" onchange="toggleTheme($(this).prop('checked'))" >
                            <span class="slider2 round"></span>
                        </label>
                    </div>
                </nav>
            </div>
        </header>
        <!--end header -->
        <!--start page wrapper -->
        <div class="page-wrapper">
            <div id="load_pages_site"></div>
            <div id="load_pages_house"></div>
            <div id="load_pages_compare"></div>
            <div id="load_pages_profile"></div>
            <div id="load_pages_report"></div>
            <div id="load_pages_dashboard">
                <div class="page-content">
                    <div id="load_pages"></div>
                    <div class="card w-100 radius-10 chart">
                        <div class="card-body">
                            <div class="d-flex">
                                <ul class="nav nav-pills mb-3" role="tablist">
                                    <li class="nav-item btn_ch_t" role="presentation">
                                        <a class="nav-link btn_ch_t active" data-bs-toggle="pill" href="#hreft_temp" role="tab" aria-selected="false">
                                            <div class="d-flex align-items-center">
                                                <div class="tab-title text-responsive2">อุณหภูมิ</div>
                                            </div>
                                        </a>
                                    </li>
                                    <li class="nav-item " role="presentation">
                                        <a class="nav-link btn_ch_h" data-bs-toggle="pill" href="#hreft_hum" role="tab" aria-selected="false">
                                            <div class="d-flex align-items-center">
                                                <div class="tab-title text-responsive2">ความชื้นอากาศ</div>
                                            </div>
                                        </a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link btn_ch_l" data-bs-toggle="pill" href="#hreft_light" role="tab" aria-selected="true">
                                            <div class="d-flex align-items-center">
                                                <div class="tab-title text-responsive2">ความเข้มแสง</div>
                                            </div>
                                        </a>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <a class="nav-link btn_ch_s" data-bs-toggle="pill" href="#hreft_soil" role="tab" aria-selected="true">
                                            <div class="d-flex align-items-center">
                                                <div class="tab-title text-responsive2" >ความชื้นดิน</div>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                            <div class="tab-content">
            					<div class="tab-pane fade active show" id="hreft_temp" role="tabpanel">
            		                <div class="chartdiv" id="chart1"></div>
            					</div>
            					<div class="tab-pane fade" id="hreft_hum" role="tabpanel">
                				    <div class="chartdiv" id="chart2"></div>
            					</div>
            					<div class="tab-pane fade" id="hreft_light" role="tabpanel">
                				    <div class="chartdiv" id="chart3"></div>
            					</div>
            					<div class="tab-pane fade" id="hreft_soil" role="tabpanel">
                				    <div class="chartdiv" id="chart4"></div>
            					</div>
            				</div>
                            <!-- <div class="chartdiv" id="chart_realtime"></div> -->
                        </dic>
                    </div>
                    <input type="hidden" class="hidden_select_sw_manual">
                    <input type="hidden" class="hidden_select_sw_auto">
                    <input type="hidden" id="val_config">
                    <!-- <input type="hidden" id="val_sw_manual">
                    <input type="hidden" id="val_sw_auto_time_set">
                    <input type="hidden" id="val_sw_auto_time_loop"> -->
                </div>
            </div>

            <!-- Modal -->
            <div class="modal fade" id="modal_sg" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title text-bold text-danger">ปัญหาและข้อเสนอแนะ</h5>
                            <!-- <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
                        </div>
                        <div class="card border-top border-0 border-4 border-danger">
                            <div class="card-body p-5">
                                <form class="row g-3" id="suggestion_form">
                                    <div class="col-md-12">
                                        <label for="inputLastName1" class="form-label">หัวข้อ</label>
                                        <div class="input-group"> <span class="input-group-text bg-transparent"><i class='bx bxs-user'></i></span>
                                            <input type="text" class="form-control border-start-0 sg_title" name="sg_title" placeholder="หัวข้อ" />
                                            <div class="invalid-feedback">กรุณาระบุหัวข้อ</div>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <label for="inputLastName1" class="form-label">ชื่อ - นามสกุล</label>
                                        <div class="input-group"> <span class="input-group-text bg-transparent"><i class='bx bxs-user'></i></span>
                                            <input type="text" class="form-control border-start-0 sg_name" name="sg_name" placeholder="ชื่อ - นามสกุล" />
                                            <div class="invalid-feedback">กรุณาระบุชื่อ - นามสกุล</div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label for="inputPhoneNo" class="form-label">เบอร์ติดต่อ</label>
                                        <div class="input-group"> <span class="input-group-text bg-transparent"><i class='bx bxs-microphone' ></i></span>
                                            <input type="text" class="form-control border-start-0 sg_tel" name="sg_tel" placeholder="เบอร์ติดต่อ" />
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label for="inputEmailAddress" class="form-label">อีเมลล์</label>
                                        <div class="input-group"> <span class="input-group-text bg-transparent"><i class='bx bxs-message' ></i></span>
                                            <input type="text" class="form-control border-start-0 sg_email" name="sg_email" placeholder="อีเมลล์" />
                                            <div class="invalid-feedback">กรุณาระบุอีเมลล์</div>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <label for="inputAddress3" class="form-label">ปัญหาและข้อเสนอแนะ</label>
                                        <textarea class="form-control sg_text" name="sg_text" placeholder=" " rows="4"></textarea>
                                        <div class="invalid-feedback">กรุณาระบุปัญหาและข้อเสนอแนะ</div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" id="submit_suggestion_modal" class="btn btn-success waves-light">
                                <i class="fadeIn animated bx bx-check"></i> ส่งข้อมูล
                            </button>
                            <button type="button" class="btn btn-danger waves-effect" data-bs-dismiss="modal">
                                <i class="fadeIn animated bx bx-window-close"></i> ยกเลิก
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <!--end Modal -->
        </div>
        <!--end page wrapper -->
        <!--start overlay-->
        <div class="overlay toggle-icon"></div>
        <!--end overlay-->
        <!--Start Back To Top Button--><a href="javaScript:;" class="back-to-top"><i class='bx bxs-up-arrow-alt'></i></a>
        <!--End Back To Top Button-->

        <div id="dtBox"></div>
        <footer class="page-footer d-flex">
            <p class="mb-0">© 2021 Smart Green House v.2.1.2</p>
            <div class="ms-auto">
                <img src="public/images/logo/decc.png" style="height: 20px; border: 0 solid #e5e5e5; padding: 0;">
                <img src="public/images/logo/Ai5.0Agriculture.png" style="height: 38px; border: 0 solid #e5e5e5; padding: 0;">
            </div>
            <!-- <div class="user-box dropdown">
                <a class="d-flex align-items-center nav-link dropdown-toggle dropdown-toggle-nocaret" href="#" role="button" > -->

                    <!-- <img src="" class="user-img" alt="user avatar"> -->
                    <!-- <div class="user-info ps-3">
                        <p class="user-name mb-0 user_name"></p>
                    </div> -->
                <!-- </a>
            </div> -->

        </footer>
    </div>
    <!--end wrapper-->
    <!--start switcher-->
    <div class="switcher-wrapper">
        <div class="switcher-btn memu_control"> <i class='bx bx-cog bx-spin'></i></div>
    </div>
    <!--end switcher-->
    <!-- Bootstrap JS -->
    <script src="public/javascripts/bootstrap.bundle.min.js"></script>

    <script src="public/plugins/simplebar/js/simplebar.min.js"></script>
    <script src="public/plugins/metismenu/js/metisMenu.min.js"></script>
    <script src="public/plugins/perfect-scrollbar/js/perfect-scrollbar.js"></script>
    <!--app JS-->
    <script src="public/javascripts/app.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment.js"></script> -->

    <!-- sweetalert2 -->
    <script src="public/plugins/sweetalert2-7.28.12/dist/sweetalert2.all.min.js"></script>
    <!-- Resources -->
    <!-- <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/dark.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/frozen.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script> -->

    <!-- <script type="text/javascript" src="public/javascripts/echarts.4.8.0.js"></script> -->

    <!-- mqtt_plugin -->
    <!-- <script src="public/plugins/mqtt_plugin/lib/mqttws31.js"></script> -->
    <!-- <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.2/mqttws31.js" type="text/javascript"></script>

    <!-- mqtt_plugin -->
    <!-- <script src="public/plugins/paho.javascript-1.1.0/lib/mqttws31.js"></script> -->

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.21/b-1.6.2/b-flash-1.6.2/b-html5-1.6.2/b-print-1.6.2/datatables.min.js"></script>

    <!-- <script src="public/plugins/datatable/js/jquery.dataTables.min.js"></script>
    <script src="public/plugins/datatable/js/dataTables.bootstrap5.min.js"></script> -->
    <!-- <script src="public/plugins/datatables/datatables.net.1.10.25.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.7.1/js/buttons.print.min.js"></script> -->

    <!-- <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script> -->
    <script src="public/plugins/open-weather-master/src/openweather.js"></script>
    <!-- Loading -->
    <script type="text/javascript" src="public/plugins/Customizable-Loading-Modal-Plugin/js/modal-loading.js"></script>
    <!-- Magnific popup JavaScript -->
    <script src="public/plugins/Magnific-Popup-master/dist/jquery.magnific-popup.min.js"></script>
    <script src="public/plugins/Magnific-Popup-master/dist/jquery.magnific-popup-init.js"></script>
    <!-- Range slider  -->
    <script src="public/plugins/ion-rangeslider/js/ion-rangeSlider/ion.rangeSlider.min.js"></script>
    <script src="public/plugins/ion-rangeslider/js/ion-rangeSlider/ion.rangeSlider-init.js"></script>

    <script src="public/plugins/apexcharts-bundle/js/apexcharts.js"></script>

    <!-- <script src="routes/memu.js"></script> -->
    <!-- <script src="https://unpkg.com/bootstrap?@4.3.1/dist/js/bootstrap.min.js"></script> -->
    <script>
        // alert(url[0])
        $(".logout").click(function() {
            logout()
        });
        $("#dtBox").DateTimePicker();
        if (house_master.length == 8) {
            var loading = verticalNoTitle();
            if (url[0] == 2) {
                $.ajax({
                    url: "routes/kmu/get_config.php",
                    method: "post",
                    data: {
                        house_master: house_master
                    },
                    dataType: "json",
                    success: function(res) {
                        console.log(res);
                        var config_sn = res.config_sn;
                        var config_cn = res.config_cn;
                        var set_maxmin = res.set_maxmin;
                        var sensor = res.sensor;
                        var data_temp_out = [];
                        var data_temp_in = [];
                        var data_hum_out = [];
                        var data_hum_in = [];
                        var data_light_out = [];
                        var data_light_in = [];
                        var data_soil_in1 = [];
                        var data_soil_in2 = [];
                        check_menu_control();
                        function check_menu_control(){
                            if(res.userLevel < 3){
                                if(getArraySum(res.controlstatus) > 0){
                                    $('.memu_control').show()
                                }else {
                                    $('.memu_control').hide()
                                }
                            }else {
                                $('.memu_control').hide()
                            }
                        }
                        $(".memu_dash").click(function() {
                            check_menu_control();
                        });
                        $(".memu_dash").show().addClass("mm-active");
                        $(".memu_report").show();
                        $(".memu_compare").hide();
                        $('#load_pages_dashboard').show();
                        $.ajax({
                            url: "routes/kmu/pages_dashboard.php",
                            method: "post",
                            data: {
                                data: res,
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages").html(res_dash);
                                // Global variables
                                var client = null;
                                // These are configs
                                var hostname = "203.150.37.144"; //'103.2.115.15'; // 203.150.37.144   decccloud.com
                                var port = "8083";
                                var clientId = "mqtt_js_5" + parseInt(Math.random() * 100000, 15);
                                var count = 0;

                                function connect() {
                                    client = new Paho.MQTT.Client(hostname, Number(port), '/mqtt', clientId);
                                    console.info('Connecting to Server: Hostname: ', hostname, '. Port: ', port, '. Client ID: ', clientId);

                                    client.onConnectionLost = onConnectionLost;
                                    client.onMessageArrived = onMessageArrived;

                                    var options = {
                                        onSuccess: onConnect, // after connected, subscribes
                                        onFailure: onFail // useful for logging / debugging
                                    };
                                    // connect the client
                                    client.connect(options);
                                    console.info('Connecting...');
                                }
                                // ---------------------------------------------------------------------------------------
                                function onConnect(context) {
                                    console.log("Client Connected");
                                    // And subscribe to our topics	-- both with the same callback function
                                    options = {
                                        qos: 1,
                                        onSuccess: function (context) {
                                            // console.log("ไม่สามารถเชื่อมต่อกับ เครื่อง ได้ !!!!");
                                            // setInterval(function() {
                                            //     location.reload();
                                            // }, 30000);
                                            console.log("subscribed");
                                        }
                                    }
                                    client.subscribe(house_master + "/1/data_update/data_filter", options);
                                    client.subscribe(house_master + "/1/control/mode", options);
                                    client.subscribe(house_master + "/1/control/control_st_1", options);
                                    client.subscribe(house_master + "/1/control/control_st_2", options);
                                    client.subscribe(house_master + "/1/control/control_st_3", options);
                                    client.subscribe(house_master + "/1/control/control_st_4", options);
                                    client.subscribe(house_master + "/1/control/control_st_5", options);
                                }

                                function onFail(context) {
                                    location.reload();
                                }

                                function onConnectionLost(responseObject) {
                                    if (responseObject.errorCode !== 0) {
                                        console.log("Connection Lost: " + responseObject.errorMessage);
                                        connect();
                                        // location.reload();
                                        // window.alert("Someone else took my websocket!\nRefresh to take it back.");
                                    }
                                }
                                function onMessageArrived(message) {
                                    if(message.destinationName == house_master + "/1/data_update/data_filter") {
                                        var result = message.payloadString;
                                        var p_json = $.parseJSON(result);
                                        var parseJSON = p_json['data_update']['data'][0];
                                        // console.log('parseJSON')
                                        var time_t = parseJSON['time'];
                                        var ntime = time_t.substring(0, 5);
                                        $(".date").html(parseJSON['date']+' '+ntime);
                                        // $(".time").html(ntime);
                                        var data_ = parseJSON['data']
                                        // console.log(data_)
                                        // return false
                                        if(parseJSON['date']+' '+ntime > moment(new Date()).add(-30, 'minutes').format('YYYY/MM/DD HH:mm') ){
                                            $('.status_timeUpdate').html('ออนไลน์').addClass('text-success')
                                        }else {
                                            $('.status_timeUpdate').html('ออฟไลน์').addClass('text-danger')
                                        }
                                        for (var i = 1; i <= 8; i++) {
                                            // console.log(config_sn['sn_sensor_'+i])
                                            //
                                            if (config_sn['sn_status_' + i] == 1) {
                                                if (i == 1) {
                                                    dash_status(sn_data = (data_['data_st2_3'] * 1).toFixed(1), max = set_maxmin.Tmax, min = set_maxmin.Tmin)
                                                } else if (i == 2) {
                                                    dash_status(sn_data = (data_['data_st2_4'] * 1).toFixed(1), max = set_maxmin.Hmax, min = set_maxmin.Hmin)
                                                } else if (i == 3) {
                                                    dash_status(sn_data = (data_['data_st2_2'] * 1).toFixed(1), max = set_maxmin.Lmax, min = set_maxmin.Lmin)
                                                } else if (i == 4) {
                                                    dash_status(sn_data = (data_['data_st1_3'] * 1).toFixed(1), max = set_maxmin.Tmax, min = set_maxmin.Tmin)
                                                } else if (i == 5) {
                                                    dash_status(sn_data = (data_['data_st1_4'] * 1).toFixed(1), max = set_maxmin.Hmax, min = set_maxmin.Hmin)
                                                } else if (i == 6) {
                                                    dash_status(sn_data = (data_['data_st1_2'] * 1).toFixed(1), max = set_maxmin.Lmax, min = set_maxmin.Lmin)
                                                } else if (i == 7) {
                                                    dash_status(sn_data = (data_['data_st3_2'] * 1).toFixed(1), max = set_maxmin.Smax, min = set_maxmin.Smin)
                                                } else if (i == 8) {
                                                    dash_status(sn_data = (data_['data_st3_4'] * 1).toFixed(1), max = set_maxmin.Smax, min = set_maxmin.Smin)
                                                }
                                            }
                                            function dash_status(sn_data, max, min) {
                                                if (sn_data >= max) {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax);
                                                } else if (sn_data < min) {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin);
                                                } else {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                                }
                                                if (sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit == 1) {
                                                    $(".dash_data__" + i).html(sn_data + " ℃");
                                                } else {
                                                    $(".dash_data__" + i).html(sn_data + " " + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit);
                                                }
                                            }
                                        }
                                        return false
                                        // Chart ----------------------------------------
                                        data_temp_out.shift();
                                        data_temp_in.shift();
                                        data_temp_out.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st2_3'] * 1).toFixed(1)
                                        })
                                        data_temp_in.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st1_3'] * 1).toFixed(1)
                                        })
                                        // -------------------
                                        data_hum_out.shift();
                                        data_hum_in.shift();
                                        data_hum_out.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y: (data_['data_st2_4'] * 1).toFixed(1)
                                        })
                                        data_hum_in.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y: (data_['data_st1_4'] * 1).toFixed(1)
                                        })
                                        // -------------------
                                        data_light_out.shift();
                                        data_light_in.shift();
                                        data_light_out.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st2_2'] * 1).toFixed(1)
                                        })
                                        data_light_in.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st1_2'] * 1).toFixed(1)
                                        })
                                        // -------------------
                                        data_soil_in1.shift();
                                        data_soil_in2.shift();
                                        data_soil_in1.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st3_2'] * 1).toFixed(1)
                                        })
                                        data_soil_in2.push({
                                            x: parseJSON['date']+' - '+ntime,
                                            y:(data_['data_st3_4'] * 1).toFixed(1)
                                        })
                                    }
                                    else if (message.destinationName == house_master + "/1/control/mode") {
                                        var cont_status = message.payloadString;
                                        if (cont_status === "on") { //Auto
                                            $('.dash_mode').html('โหมดอัตโนมัติ')
                                            $('.sw_mode_Auto').addClass('btn-success').removeClass('btn-outline-success')
                                            $('.sw_mode_Manual').removeClass('btn-success').addClass('btn-outline-success')
                                            $('.ul_Auto').show();
                                            $('.ul_Manual').hide();
                                        } else {
                                            $('.dash_mode').html('โหมดกำหนดเอง');
                                            $('.sw_mode_Auto').removeClass('btn-success').addClass('btn-outline-success');
                                            $('.sw_mode_Manual').addClass('btn-success').removeClass('btn-outline-success');
                                            $('.ul_Auto').hide();
                                            $('.ul_Manual').show();
                                        }
                                    }
                                    else if (message.destinationName == house_master + "/1/control/control_st_1") {
                                        var cont_status = message.payloadString;
                                        if(cont_status === "off"){
                                            $(".dash_img_con_1").attr("src", "public/images/control/TU/sprinkler-off.svg");
                                            $('.sw_manual_on_1').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="40" />');
                                            $('.sw_manual_off_1').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="40" />');
                                        }
                                        else {
                                            $(".dash_img_con_1").attr("src", "public/images/control/TU/sprinkler-on.svg");
                                            $('.sw_manual_on_1').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="40" />');
                                            $('.sw_manual_off_1').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="40" />');
                                        }
                                    }
                                    else if (message.destinationName == house_master + "/1/control/control_st_2") {
                                        var cont_status = message.payloadString;
                                        if (cont_status === "off") {
                                            $(".dash_img_con_2").attr("src", "public/images/control/TU/sprinkler-off.svg");
                                            $('.sw_manual_on_2').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="40" />');
                                            $('.sw_manual_off_2').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="40" />');
                                            // $(".sw_manual_2").bootstrapToggle('off');
                                        } else {
                                            $(".dash_img_con_2").attr("src", "public/images/control/TU/sprinkler-on.svg");
                                            $('.sw_manual_on_2').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="40" />');
                                            $('.sw_manual_off_2').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="40" />');
                                            // $(".sw_manual_2").bootstrapToggle('on');
                                        }
                                    }
                                    else if (message.destinationName == house_master + "/1/control/control_st_3") {
                                        var cont_status = message.payloadString;
                                        if (cont_status === "off") {
                                            $(".dash_img_con_3").attr("src", "public/images/control/TU/foggy-off.svg");
                                            $('.sw_manual_on_3').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="40" />');
                                            $('.sw_manual_off_3').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="40" />');
                                            // $(".sw_manual_3").bootstrapToggle('off');
                                        } else {
                                            $(".dash_img_con_3").attr("src", "public/images/control/TU/foggy-on.svg");
                                            $('.sw_manual_on_3').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="40" />');
                                            $('.sw_manual_off_3').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="40" />');
                                            // $(".sw_manual_3").bootstrapToggle('on');
                                        }
                                    }
                                    else if (message.destinationName == house_master + "/1/control/control_st_4") {
                                        var cont_status = message.payloadString;
                                        if (cont_status === "off") {
                                            $(".dash_img_con_4").attr("src", "public/images/control/foggy_OFF.svg");
                                            $('.sw_manual_on_4').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="40" />');
                                            $('.sw_manual_off_4').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="40" />');
                                            // $(".sw_manual_4").bootstrapToggle('off');
                                        } else {
                                            $(".dash_img_con_4").attr("src", "public/images/control/foggy_ON.svg");
                                            $('.sw_manual_on_4').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="40" />');
                                            $('.sw_manual_off_4').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="40" />');
                                            // $(".sw_manual_4").bootstrapToggle('on');
                                        }
                                    }
                                    else if (message.destinationName == house_master + "/1/control/control_st_5") {
                                        var cont_status = message.payloadString;
                                        if (cont_status === "off") {
                                            $(".dash_img_con_5").attr("src", "public/images/control/Roof_OFF2.png");
                                            $('.sw_manual_on_5').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="40" />');
                                            $('.sw_manual_off_5').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="40" />');
                                            // $(".sw_manual_5").bootstrapToggle('off');
                                        } else {
                                            $(".dash_img_con_5").attr("src", "public/images/control/Roof_ON2.png");
                                            $('.sw_manual_on_5').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="40" />');
                                            $('.sw_manual_off_5').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="40" />');
                                            // $(".sw_manual_5").bootstrapToggle('on');
                                        }
                                    }
                                }// exit_message
                                connect();
                                loadingOut(loading);
                            }
                        });
                        $.ajax({
                            url: "routes/kmu/pages_report.php",
                            method: "post",
                            data: {
                                data: res,
                                // s_sensor: s_sensor,
                                // count_cn: getArraySum(res.controlstatus)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages_report").html(res_dash);
                            }
                        });
                        var optionsLine = {
                            chart: {
                                id: 'realtime',
                                foreColor: '#9ba7b2',
                                height: 560,
                                type: 'line',
                                toolbar: {
                                    show: false,
                                    tools: {
                                        download: false,
                                        selection: true,
                                         zoom: true,
                                         zoomin: true,
                                         zoomout: true,
                                         pan: true,
                                    }
                                },
                                dropShadow: {
                                    enabled: true,
                                    top: 3,
                                    left: 2,
                                    blur: 4,
                                    opacity: 0.1,
                                }
                            },
                            stroke: {
                                curve: 'smooth',
                                width: 3
                            },
                            // colors: ["#0d6efd", '#212529'],
                            // series: [{
                            //   data: data.slice()
                            // }],
                            series: [],
                            // [{
                            //     name: "temp_out",
                            //     data: res.data.temp_out//[1, 15, 56, 20, 33, 27]
                            // }, {
                            //     name: "temp_in",
                            //     data: res.data.temp_in//[30, 33, 21, 42, 19, 32]
                            // }],
                            title: {
                                // text: 'Multiline Chart',
                                align: 'left',
                                offsetY: 30,
                                // offsetX: 20
                            },
                            animations: {
                              enabled: true,
                              easing: 'linear',
                              // dynamicAnimation: {
                              //   speed: 1000
                              // }
                            },
                            markers: {
                                size: 1,
                                strokeWidth: 0,
                                hover: {
                                    size: 6
                                }
                            },
                            grid: {
                                show: true,
                                padding: {
                                    bottom: 0
                                }
                            },
                            xaxis: {
                                type: 'datetime',
                                // categories:res.data.timestamp,
                                labels: {
                                    datetimeUTC: false,
                                    // format: 'dd/MM HH:mm',
                                    datetimeFormatter: {
                                        year: 'yyyy',
                                        month: 'MMM \'yy',
                                        day: 'dd MMM',
                                        hour: 'HH:mm'
                                    }
                                }
                            },
                            legend: {
                                // position: 'top',
                                // horizontalAlign: 'right',
                                // offsetY: -30
                            },
                            fill: {
                                type: "solid",
                                fillOpacity: 0.7
                            },
                            noData: {
                                text: 'Loading...'
                            },
                            tooltip: {
                                x: {
                                    format: 'yyyy-MM-dd HH:mm'
                                },
                            }
                        }
                        var chartLine1 = new ApexCharts(document.querySelector('#chart1'), optionsLine);
                        chartLine1.render();
                        var chartLine2 = new ApexCharts(document.querySelector('#chart2'), optionsLine);
                        chartLine2.render();
                        var chartLine3 = new ApexCharts(document.querySelector('#chart3'), optionsLine);
                        chartLine3.render();
                        var chartLine4 = new ApexCharts(document.querySelector('#chart4'), optionsLine);
                        chartLine4.render();

                        $.ajax({
                            url: "routes/kmu/get_chart_realtime.php",
                            method: "post",
                            data: {
                                house_master: house_master
                            },
                            dataType: "json",
                            success: function(res) {
                                console.log(res);
                                // console.log(res.data);
                                data_temp_out = res.data.temp_out;
                                data_temp_in = res.data.temp_in;
                                data_hum_out = res.data.hum_out;
                                data_hum_in = res.data.hum_in;
                                data_light_out = res.data.light_out;
                                data_light_in = res.data.light_in;
                                data_soil_in1 = res.data.soil_in1;
                                data_soil_in2 = res.data.soil_in2;

                                chartLine1.updateSeries([
                                    {
                                        name: 'อุณหภูมินอกโรงเรือน',
                                        data: data_temp_out
                                    }, {
                                        name: 'อุณหภูมินอกโรงเรือน',
                                        data: data_temp_in
                                    }
                                ])
                                chartLine1.updateOptions({
                                    title:  {text: 'อุณหภูมิ (℃)'},
                                    tooltip: {
                                        y: {
                                        	formatter: function (val) {
                                        		return  val + " ℃"
                                        	}
                                        }
                                    },
                                    // subtitle: {
                                    //     text: '(℃)',
                                    //     offsetY: 55,
                                    //     offsetX: 10
                                    // },
                                })
                                chartLine2.updateSeries([
                                    {
                                        name: 'ความชื้นนอกโรงเรือน',
                                        data: data_hum_out
                                    }, {
                                        name: 'ความชื้นในโรงเรือน',
                                        data: data_hum_in
                                    }
                                ]);
                                chartLine2.updateOptions({
                                    title:  {text: 'ความชื้นอากาศ (%Rh)'},
                                    tooltip: {
                                        y: {
                                            formatter: function (val) {
                                                return  val + " %Rh"
                                            }
                                        }
                                    },
                                    // subtitle: {
                                    //     text: '(%Rh)',
                                    //     offsetY: 55,
                                    //     offsetX: 10
                                    // },
                                });
                                chartLine3.updateSeries([
                                    {
                                        name: 'ความเข้มแสงนอกโรงเรือน',
                                        data: data_light_out
                                    }, {
                                        name: 'ความเข้มแสงในโรงเรือน',
                                        data: data_light_in
                                    }
                                ]);
                                chartLine3.updateOptions({
                                    title:  {text: 'ความเข้มแสง (Klux)'},
                                    tooltip: {
                                        y: {
                                            formatter: function (val) {
                                                return  val + " Klux"
                                            }
                                        }
                                    },
                                    // subtitle: {
                                    //     text: '(Klux)',
                                    //     offsetY: 55,
                                    //     offsetX: 10
                                    // },
                                })
                                chartLine4.updateSeries([
                                    {
                                        name: 'ความชื้นดิน 1',
                                        data: data_soil_in1
                                    },{
                                        name: 'ความชื้นดิน 2',
                                        data: data_soil_in2
                                    }]
                                )
                                chartLine4.updateOptions({
                                    title:  {text: 'ความชื้นดิน (%)'},
                                    tooltip: {
                                        y: {
                                            formatter: function (val) {
                                                return  val + " %"
                                            }
                                        }
                                    },
                                    // subtitle: {
                                    //     text: '(%)',
                                    //     offsetY: 55,
                                    //     offsetX: 10
                                    // },
                                })
                            }
                        });
                    }
                });
            } // V2
            else if (url[0] == 3) {
                $.ajax({
                    url: "routes/v.3/get_config.php",
                    method: "post",
                    data: {
                        house_master: house_master
                    },
                    dataType: "json",
                    success: function(res) {
                        console.log(res);
                        // return false
                        var dashStatus = res.dashStatus;
                        var dashSncanel = res.dashSncanel;
                        var dashName = res.dashName;
                        var dashMode = res.dashMode;
                        var sensor = res.s_sensor;
                        var set_maxmin = res.set_maxmin;
                        var controlStatus = res.controlStatus;
                        var controlMode = res.controlMode;
                        var control = res.s_control;
                        var data_temp = [];
                        var data_hum = [];
                        var data_soil = [];
                        var data_light = [];

                        check_menu_control()
                        function check_menu_control(){
                            if(res.userLevel < 3){
                                if(getArraySum(res.controlstatus) > 0){
                                    $('.memu_control').show()
                                }else {
                                    $('.memu_control').hide()
                                }
                            }else {
                                $('.memu_control').hide()
                            }
                        }
                        $(".memu_dash").click(function() {
                            check_menu_control();
                        });
                        $(".memu_dash").show().addClass("mm-active");
                        $(".memu_report").show();
                        $(".memu_compare").hide();
                        $('#load_pages_dashboard').show();

                        var temp_c = [];
                        var hum_c = [];
                        var light_c = [];
                        var soil_c = [];
                        // alert(getArraySum(res.dashMode))
                        // return false
                        for (var i = 1; i <= getArraySum(res.dashMode); i++) {
                            if(res.dashStatus[i] == 1){
                                if (res.dashMode[ i] == 1) {
                                    temp_c.push(1);
                                } else if (res.dashMode[ i] == 2) {
                                    hum_c.push(1);
                                } else if (res.dashMode[ i] == 3) {
                                    soil_c.push(1);
                                } else {
                                    light_c.push(1);
                                }
                            }
                        }
                        var count_sensor = {
                            s_btnT: getArraySum(temp_c),
                            s_btnH: getArraySum(hum_c),
                            s_btnS: getArraySum(soil_c),
                            s_btnL: getArraySum(light_c),
                        };
                        if(getArraySum(temp_c) > 0){  $('.btn_ch_t').show();}else { $('.btn_ch_t').hide(); }
                        if(getArraySum(hum_c) > 0){   $('.btn_ch_h').show();}else { $('.btn_ch_h').hide(); }
                        if(getArraySum(light_c) > 0){ $('.btn_ch_l').show();}else { $('.btn_ch_l').hide(); }
                        if(getArraySum(soil_c) > 0){  $('.btn_ch_s').show();}else { $('.btn_ch_s').hide(); }

                        // return false
                        $.ajax({
                            url: "routes/v.3/pages_dashboard.php",
                            method: "post",
                            data: {
                                data: res,
                                count_sensor: count_sensor,
                                count_cn: getArraySum(res.controlStatus)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages").html(res_dash);

                                $('.image-popups').magnificPopup({
                                    delegate: 'a',
                                    type: 'image',
                                    removalDelay: 500, //delay removal by X to allow out-animation
                                    callbacks: {
                                        beforeOpen: function() {
                                            // just a hack that adds mfp-anim class to markup
                                            this.st.image.markup = this.st.image.markup.replace('mfp-figure', 'mfp-figure mfp-with-anim');
                                            this.st.mainClass = this.st.el.attr('data-effect');
                                        }
                                    },
                                    closeOnContentClick: false,
                                    midClick: true // allow opening popup on middle mouse click. Always set it to true if you don't provide alternative source.
                                });

                                // Global variables
                                var client = null;
                                // These are configs
                                var hostname = "203.150.37.144"; //'103.2.115.15'; // 203.150.37.144   decccloud.com
                                var port = "8083";
                                var clientId = "mqtt_js_4" + parseInt(Math.random() * 100000, 10);
                                var count = 0;

                                function connect() {
                                    client = new Paho.MQTT.Client(hostname, Number(port), '/mqtt', clientId);
                                    console.info('Connecting to Server: Hostname: ', hostname, '. Port: ', port, '. Client ID: ', clientId);

                                    client.onConnectionLost = onConnectionLost;
                                    client.onMessageArrived = onMessageArrived;

                                    var options = {
                                        onSuccess: onConnect, // after connected, subscribes
                                        onFailure: onFail // useful for logging / debugging
                                    };
                                    // connect the client
                                    client.connect(options);
                                    console.info('Connecting...');
                                }
                                // ---------------------------------------------------------------------------------------
                                function onConnect(context) {
                                    console.log("Client Connected");
                                    // And subscribe to our topics	-- both with the same callback function
                                    options = {
                                        qos: 1,
                                        onSuccess: function (context) {
                                            // console.log("ไม่สามารถเชื่อมต่อกับ เครื่อง ได้ !!!!");
                                            // setInterval(function() {
                                            //     location.reload();
                                            // }, 30000);
                                            console.log("subscribed "+house_master);
                                        }
                                    }
                                    client.subscribe(house_master + "/1/data_update/data_filter", options);
                                    client.subscribe(house_master + "/1/data_update/data_filter2", options);
                                    client.subscribe(house_master + "/1/control/json_control_filter", options);
                                }

                                function onFail(context) {
                                    location.reload();
                                }

                                function onConnectionLost(responseObject) {
                                    if (responseObject.errorCode !== 0) {
                                        console.log("Connection Lost: " + responseObject.errorMessage);
                                        connect();
                                        // location.reload();
                                        // window.alert("Someone else took my websocket!\nRefresh to take it back.");
                                    }
                                }
                                function onMessageArrived(message) {
                                    if(message.destinationName == house_master + "/1/data_update/data_filter") {
                                        var result = message.payloadString;
                                        var parseJSON = $.parseJSON(result);
                                        // console.log('parseJSON')

                                        var chart_timestamp = parseJSON['date_time'];
                                        var time_t = parseJSON['time'];
                                        var ntime = time_t.substring(0, 5);
                                        $(".date").html(parseJSON['date']+' '+ntime);
                                        if(parseJSON['date']+' - '+ntime > moment(new Date()).add(-5, 'minutes').format('YYYY/MM/DD - HH:mm') ){
                                            $('.status_timeUpdate').html('ออนไลน์').addClass('text-success')
                                        }else {
                                            $('.status_timeUpdate').html('ออฟไลน์').addClass('text-danger')
                                        }
                                        var data_ = parseJSON['data'];
                                        // console.log(data_)
                                        // alert($.map(dashStatus, function(n, i) { return i; }).length)
                                        // return false;
                                        var n_temp = [];
                                        var n_hum = [];
                                        var n_light = [];
                                        var n_soil = [];
                                        var name_temp = [];
                                        var name_hum = [];
                                        var name_light = [];
                                        var name_soilt = [];
                                        for (var i = 1; i <= $.map(dashStatus, function(n, i) { return i; }).length; i++) {
                                            if (dashStatus[i] == 1) {
                                                if (dashMode[i] == 1) {
                                                    n_temp.push({
                                                        x: parseJSON['date']+' - '+ntime,
                                                        y:(data_[dashSncanel[i]]*1).toFixed(1)
                                                    });
                                                    name_temp.push(dashName[i]);
                                                    dash_status(sn_data = (data_[dashSncanel[i]]*1).toFixed(1), max = set_maxmin.Tmax, min = set_maxmin.Tmin)
                                                }
                                                else if (dashMode[i] == 2) {
                                                    n_hum.push({
                                                        x: parseJSON['date']+' - '+ntime,
                                                        y:(data_[dashSncanel[i]]*1).toFixed(1)
                                                    });
                                                    name_hum.push(dashName[i]);
                                                    dash_status(sn_data = (data_[dashSncanel[i]] * 1).toFixed(1), max = set_maxmin.Hmax, min = set_maxmin.Hmin)
                                                }
                                                else if (dashMode[i] == 3) {
                                                    n_soil.push({
                                                        x: parseJSON['date']+' - '+ntime,
                                                        y:(data_[dashSncanel[i]]*1).toFixed(1)
                                                    });
                                                    name_soilt.push(dashName[i]);
                                                    dash_status(sn_data = (data_[dashSncanel[i]] * 1).toFixed(1), max = set_maxmin.Smax, min = set_maxmin.Smin)
                                                }
                                                else if (dashMode[i] == 4) {
                                                    n_light.push({
                                                        x: parseJSON['date']+' - '+ntime,
                                                        y:(data_[dashSncanel[i]] / 1000).toFixed(1)
                                                    });
                                                    name_light.push(dashName[i]);
                                                    dash_status(sn_data = (data_[dashSncanel[i]] / 1000).toFixed(1), max = set_maxmin.Lmax, min = set_maxmin.Lmin)
                                                }
                                                else if (dashMode[i] == 5) {
                                                    n_light.push({
                                                        x: parseJSON['date']+' - '+ntime,
                                                        y:(data_[dashSncanel[i]] / 54).toFixed(1)
                                                    });
                                                    name_light.push(dashName[i]);
                                                    dash_status(sn_data = (data_[dashSncanel[i]] / 54).toFixed(1), max = set_maxmin.Lmax, min = set_maxmin.Lmin)
                                                }
                                            }
                                            function dash_status(sn_data, max, min) {
                                                if (sn_data >= max) {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(dashMode[i] - 1)].sensor_imgMax);
                                                } else if (sn_data < min) {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(dashMode[i] - 1)].sensor_imgMin);
                                                } else {
                                                    $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(dashMode[i] - 1)].sensor_imgNor);
                                                }
                                                if(dashMode[i] == 5){
                                                    $(".dash_data__" + i).html(sn_data + " <br> " + sensor[(dashMode[i] - 1)].sensor_unit);
                                                }else {
                                                    if (sensor[(dashMode[i] - 1)].sensor_unit == 1) {
                                                        $(".dash_data__" + i).html(sn_data + " ℃");
                                                    } else {
                                                        $(".dash_data__" + i).html(sn_data + " " + sensor[(dashMode[i] - 1)].sensor_unit);
                                                    }
                                                }
                                            }
                                        }
                                        // console.log(data_temp);
                                        // alert(data_temp.length)
                                        if($.map(data_temp, function(n, i) { return i; }).length > 0){
                                            var n_data = [];
                                            for (var k = 0; k < $.map(data_temp, function(n, i) { return i; }).length; k++) {
                                                // console.log($.map(data_temp['temp_'+(k+1)], function(n, i) { return i; }).length);
                                                if( $.map(data_temp['temp_'+(k+1)], function(n, i) { return i; }).length > 0){
                                                    var a=[];
                                                    for (var i = 0; i < $.map(data_temp['temp_'+(k+1)], function(n, i) { return i; }).length; i++) {
                                                        if(i != 0){
                                                            if(i == ($.map(data_temp['temp_'+(k+1)], function(n, i) { return i; }).length -1)){
                                                                a.push(data_temp['temp_'+(k+1)][i])
                                                                a.push(n_temp[k])
                                                            }else {
                                                                a.push(data_temp['temp_'+(k+1)][i])
                                                            }
                                                        }
                                                    }
                                                    data_temp['temp_'+(k+1)] = a;
                                                    // a.length = 0;
                                                    // console.log(a);
                                                }
                                                n_data.push({
                                                    name:name_temp[(k+1)],
                                                    data: data_temp['temp_'+(k+1)]
                                                })
                                            }
                                            // console.log(data_temp);
                                            chartLine1.updateSeries(n_data)
                                        }
                                        if($.map(data_hum, function(n, i) { return i; }).length > 0){
                                            var n_data = [];
                                            for (var k = 0; k < $.map(data_hum, function(n, i) { return i; }).length; k++) {
                                                if( $.map(data_hum['hum_'+(k+1)], function(n, i) { return i; }).length > 0){
                                                    var a=[];
                                                    for (var i = 0; i < $.map(data_hum['hum_'+(k+1)], function(n, i) { return i; }).length; i++) {
                                                        if(i != 0){
                                                            if(i == ($.map(data_hum['hum_'+(k+1)], function(n, i) { return i; }).length -1)){
                                                                a.push(data_hum['hum_'+(k+1)][i])
                                                                a.push(n_hum[k])
                                                            }else {
                                                                a.push(data_hum['hum_'+(k+1)][i])
                                                            }
                                                        }
                                                    }
                                                    data_hum['hum_'+(k+1)] = a;
                                                    // a.length = 0;
                                                    // console.log(a);
                                                }
                                                n_data.push({
                                                    name:name_hum[(k+1)],
                                                    data: data_hum['hum_'+(k+1)]
                                                })
                                            }
                                            chartLine2.updateSeries(n_data)
                                        }
                                        if($.map(data_light, function(n, i) { return i; }).length > 0){
                                            var n_data = [];
                                            for (var k = 0; k < $.map(data_light, function(n, i) { return i; }).length; k++) {
                                                if( $.map(data_light['light_'+(k+1)], function(n, i) { return i; }).length > 0){
                                                    var a=[];
                                                    for (var i = 0; i < $.map(data_light['light_'+(k+1)], function(n, i) { return i; }).length; i++) {
                                                        if(i != 0){
                                                            if(i == ($.map(data_light['light_'+(k+1)], function(n, i) { return i; }).length -1)){
                                                                a.push(data_light['light_'+(k+1)][i])
                                                                a.push(n_light[k])
                                                            }else {
                                                                a.push(data_light['light_'+(k+1)][i])
                                                            }
                                                        }
                                                    }
                                                    data_light['light_'+(k+1)] = a;
                                                    // a.length = 0;
                                                    // console.log(a);
                                                }
                                                n_data.push({
                                                    name:name_light[(k+1)],
                                                    data: data_light['light_'+(k+1)]
                                                })
                                            }
                                            chartLine3.updateSeries(n_data)
                                        }
                                        if($.map(data_soil, function(n, i) { return i; }).length > 0){
                                            var n_data = [];
                                            for (var k = 0; k < $.map(data_soil, function(n, i) { return i; }).length; k++) {
                                                if( $.map(data_soil['soil_'+(k+1)], function(n, i) { return i; }).length > 0){
                                                    var a=[];
                                                    for (var i = 0; i < $.map(data_soil['soil_'+(k+1)], function(n, i) { return i; }).length; i++) {
                                                        if(i != 0){
                                                            if(i == ($.map(data_soil['soil_'+(k+1)], function(n, i) { return i; }).length -1)){
                                                                a.push(data_soil['soil_'+(k+1)][i])
                                                                a.push(n_soil[k])
                                                            }else {
                                                                a.push(data_soil['soil_'+(k+1)][i])
                                                            }
                                                        }
                                                    }
                                                    data_soil['soil_'+(k+1)] = a;
                                                    // a.length = 0;
                                                    // console.log(a);
                                                }
                                                n_data.push({
                                                    name:name_soilt[(k+1)],
                                                    data: data_soil['soil_'+(k+1)]
                                                })
                                            }
                                            chartLine4.updateSeries(n_data)
                                        }
                                    }
                                    else if(message.destinationName == house_master + "/1/control/json_control_filter") {
                                        if (getArraySum(res.controlStatus) !== 0) {
                                            var result = message.payloadString;
                                            var parseJSON = $.parseJSON(result);
                                            var data_array = parseJSON.control_status;
                                            console.log(parseJSON);

                                            if (data_array.Mode === "Auto") { //Auto
                                                $(".sw_mode_Manual").removeClass("active");
                                                $(".sw_mode_Auto").addClass("active");
                                                $(".sw_manual").hide();
                                                $(".sw_auto").show();
                                            } else if (data_array.Mode === "Manual") {
                                                $(".sw_mode_Auto").removeClass("active");
                                                $(".sw_mode_Manual").addClass("active");
                                                $(".sw_manual").show();
                                                $(".sw_auto").hide();
                                            }
                                            // alert(imgCon['drip_1'][1])
                                            // alert((controlMode[1]))
                                            // return false;
                                            // for (var i = 1; i <= 12; i++) {
                                            //     if(i <= 8){
                                            //         if (controlStatus[i] == 1) {
                                            //             if (data_array['dripper_'+i] === "OFF") {
                                            //                 $(".dash_img_con_"+i).attr("src", "public/images/control/" + control[(controlMode[i] - 1)].loard_imgOff);
                                            //                 $(".sw_manual_"+i).bootstrapToggle('off');
                                            //             } else {
                                            //                 $(".dash_img_con_"+i).attr("src", "public/images/control/" + control[(controlMode[i] - 1)].loard_imgOn);
                                            //                 $(".sw_manual_"+i).bootstrapToggle('on');
                                            //             }
                                            //         }
                                            //     }
                                            // }
                                            return false;
                                            // // dripper_1
                                            // if (controlStatus[1] == 1) {
                                            //     if (data_array.dripper_1 === "OFF") {
                                            //         $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][1]);
                                            //         $(".sw_manual_1").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][0]);
                                            //         $(".sw_manual_1").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_1", c_dash = data_array.dripper_1, c_img_off = imgCon['drip_1'][1], c_img_on = imgCon['drip_1'][0], ch = '1');
                                            // }
                                            //
                                            // // dripper_2
                                            // if (controlStatus[2] == 1) {
                                            //     if (data_array.dripper_2 === "OFF") {
                                            //         $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][1]);
                                            //         $(".sw_manual_2").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][0]);
                                            //         $(".sw_manual_2").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_2", c_dash = data_array.dripper_2, c_img_off = imgCon['drip_2'][1], c_img_on = imgCon['drip_2'][0], ch = '2');
                                            // }
                                            // // dripper_3
                                            // if (controlStatus[3] == 1) {
                                            //     if (data_array.dripper_3 === "OFF") {
                                            //         $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][1]);
                                            //         $(".sw_manual_3").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][0]);
                                            //         $(".sw_manual_3").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_3", c_dash = data_array.dripper_3, c_img_off = imgCon['drip_3'][1], c_img_on = imgCon['drip_3'][0], ch = '3');
                                            // }
                                            // // dripper_4
                                            // if (controlStatus[4] == 1) {
                                            //     if (data_array.dripper_4 === "OFF") {
                                            //         $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][1]);
                                            //         $(".sw_manual_4").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][0]);
                                            //         $(".sw_manual_4").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_4", c_dash = data_array.dripper_4, c_img_off = imgCon['drip_4'][1], c_img_on = imgCon['drip_4'][0], ch = '4');
                                            // }
                                            // // dripper_5
                                            // if (controlStatus[5] == 1) {
                                            //     if (data_array.dripper_5 === "OFF") {
                                            //         $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][1]);
                                            //         $(".sw_manual_5").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][0]);
                                            //         $(".sw_manual_5").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_5", c_dash = data_array.dripper_5, c_img_off = imgCon['drip_5'][1], c_img_on = imgCon['drip_5'][0], ch = '5');
                                            // }
                                            // // dripper_6
                                            // if (controlStatus[6] == 1) {
                                            //     if (data_array.dripper_6 === "OFF") {
                                            //         $(".dash_img_con_6").attr("src", "public/images/control/" + imgCon['drip_6'][1]);
                                            //         $(".sw_manual_6").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_6").attr("src", "public/images/control/" + imgCon['drip_6'][0]);
                                            //         $(".sw_manual_6").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_6", c_dash = data_array.dripper_6, c_img_off = imgCon['drip_6'][1], c_img_on = imgCon['drip_6'][0], ch = '6');
                                            // }
                                            // // dripper_7
                                            // if (controlStatus[7] == 1) {
                                            //     if (data_array.dripper_7 === "OFF") {
                                            //         $(".dash_img_con_7").attr("src", "public/images/control/" + imgCon['drip_7'][1]);
                                            //         $(".sw_manual_7").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_7").attr("src", "public/images/control/" + imgCon['drip_7'][0]);
                                            //         $(".sw_manual_7").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_7", c_dash = data_array.dripper_7, c_img_off = imgCon['drip_7'][1], c_img_on = imgCon['drip_7'][0], ch = '7');
                                            // }
                                            // // dripper_8
                                            // if (controlStatus[8] == 1) {
                                            //     if (data_array.dripper_8 === "OFF") {
                                            //         $(".dash_img_con_8").attr("src", "public/images/control/" + imgCon['drip_8'][1]);
                                            //         $(".sw_manual_8").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_8").attr("src", "public/images/control/" + imgCon['drip_8'][0]);
                                            //         $(".sw_manual_8").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_8", c_dash = data_array.dripper_8, c_img_off = imgCon['drip_8'][1], c_img_on = imgCon['drip_8'][0], ch = '8');
                                            // }
                                            // // foggy
                                            // if (controlStatus[9] == 1) {
                                            //     if (data_array.foggy === "OFF") {
                                            //         $(".dash_img_con_9").attr("src", "public/images/control/" + imgCon['foggy'][1]);
                                            //         $(".sw_manual_9").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_9").attr("src", "public/images/control/" + imgCon['foggy'][0]);
                                            //         $(".sw_manual_9").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_9", c_dash = data_array.foggy, c_img_off = imgCon['foggy'][1], c_img_on = imgCon['foggy'][0], ch = '9');
                                            // }
                                            // // fan
                                            // if (controlStatus[10] == 1) {
                                            //     if (data_array.fan === "OFF") {
                                            //         $(".dash_img_con_10").attr("src", "public/images/control/" + imgCon['fan'][1]);
                                            //         $(".sw_manual_10").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_10").attr("src", "public/images/control/" + imgCon['fan'][0]);
                                            //         $(".sw_manual_10").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_10", c_dash = data_array.fan, c_img_off = imgCon['fan'][1], c_img_on = imgCon['fan'][1], ch = '10');
                                            // }
                                            //
                                            // //Slan
                                            // if (controlStatus[11] == 1) {
                                            //     if (data_array.shader === "0") {
                                            //         $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][0], ch = '11');
                                            //     } else if (data_array.shader === "1") {
                                            //         $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][1], ch = '11');
                                            //     } else if (data_array.shader === "2") {
                                            //         $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][2], ch = '11');
                                            //     } else if (data_array.shader === "3") {
                                            //         $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][3], ch = '11');
                                            //     } else if (data_array.shader === "4") {
                                            //         $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][4], ch = '11');
                                            //     }
                                            //
                                            //     // modal_manual
                                            //     if (data_array["shader"] == 0) {
                                            //         var shader_slw = "0 : ปิด 100%";
                                            //         $(".sw_shader0").addClass("active");
                                            //         $(".sw_shader1").removeClass("active");
                                            //         $(".sw_shader2").removeClass("active");
                                            //         $(".sw_shader3").removeClass("active");
                                            //         $(".sw_shader4").removeClass("active");
                                            //     }
                                            //     if (data_array["shader"] == 1) {
                                            //         var shader_slw = "1 : เปิด 25%";
                                            //         $(".sw_shader0").removeClass("active");
                                            //         $(".sw_shader1").addClass("active");
                                            //         $(".sw_shader2").removeClass("active");
                                            //         $(".sw_shader3").removeClass("active");
                                            //         $(".sw_shader4").removeClass("active");
                                            //     }
                                            //     if (data_array["shader"] == 2) {
                                            //         var shader_slw = "2 : เปิด 50%";
                                            //         $(".sw_shader0").removeClass("active");
                                            //         $(".sw_shader1").removeClass("active");
                                            //         $(".sw_shader2").addClass("active");
                                            //         $(".sw_shader3").removeClass("active");
                                            //         $(".sw_shader4").removeClass("active");
                                            //     }
                                            //     if (data_array["shader"] == 3) {
                                            //         var shader_slw = "3 : เปิด 75%";
                                            //         $(".sw_shader0").removeClass("active");
                                            //         $(".sw_shader1").removeClass("active");
                                            //         $(".sw_shader2").removeClass("active");
                                            //         $(".sw_shader3").addClass("active");
                                            //         $(".sw_shader4").removeClass("active");
                                            //     }
                                            //     if (data_array["shader"] == 4) {
                                            //         var shader_slw = "4 : เปิด 100%";
                                            //         $(".sw_shader0").removeClass("active");
                                            //         $(".sw_shader1").removeClass("active");
                                            //         $(".sw_shader2").removeClass("active");
                                            //         $(".sw_shader3").removeClass("active");
                                            //         $(".sw_shader4").addClass("active");
                                            //     }
                                            //     $(".shader_slw").html(shader_slw);
                                            // } else {
                                            //     $(".dash_c11").hide();
                                            // }
                                            //
                                            // // fertilizer
                                            // if (controlStatus[12] == 1) {
                                            //     if (data_array.fertilizer === "OFF") {
                                            //         $(".dash_img_con_12").attr("src", "public/images/control/" + imgCon['fertilizer'][1]);
                                            //         $(".sw_manual_12").bootstrapToggle('off');
                                            //     } else {
                                            //         $(".dash_img_con_12").attr("src", "public/images/control/" + imgCon['fertilizer'][0]);
                                            //         $(".sw_manual_12").bootstrapToggle('on');
                                            //     }
                                            //     // cont_dash_show(img_c = "dash_img_con_12", c_dash = data_array.fertilizer, c_img_off = imgCon['fertilizer'][1], c_img_on = imgCon['fertilizer'][0], ch = '12');
                                            // }
                                            //
                                            // function cont_dash_show(img_c, c_dash, c_img_off, c_img_on, ch) {
                                            //     console.log(c_dash)
                                            //     if (c_dash === "OFF") {
                                            //         $("." + img_c).attr("src", "public/images/control/" + c_img_off);
                                            //         $(".sw_manual_" + ch).bootstrapToggle('on');
                                            //     } else if (c_dash === "ON") {
                                            //         $("." + img_c).attr("src", "public/images/control/" + c_img_on);
                                            //         $(".sw_manual_1").bootstrapToggle('on');
                                            //     }
                                            // }
                                        }
                                        // -------------------------------------------------------------------------------------
                                        return false;
                                        // var result = message.payloadString;
                                        // var parseJSON = $.parseJSON(result);
                                        // // console.log(parseJSON)
                                        // if (parseJSON.mode === 'Manual') {
                                        //     $('.dash_mode').html('โหมดกำหนดเอง');
                                        //     $('.sw_mode_Auto').removeClass('btn-success').addClass('btn-outline-success');
                                        //     $('.sw_mode_Manual').addClass('btn-success').removeClass('btn-outline-success');
                                        //     $('.ul_Auto').hide();
                                        //     $('.ul_Manual').show();
                                        //     var sw_log = $.parseJSON($('#val_sw_manual').val());
                                        //     var count_sw1 = [];
                                        //     var count_stats1_on = [];
                                        //     var count_sw2 = [];
                                        //     var count_stats2_on = [];
                                        //     var count_sw3 = [];
                                        //     var count_stats3_on = [];
                                        //     if(sw_log.dripper_1 == 'ON'){ count_sw1[1] = 1; }else { count_sw1[1] = 0; }
                                        //     if(sw_log.dripper_2 == 'ON'){ count_sw1[2] = 1; }else { count_sw1[2] = 0; }
                                        //     if(sw_log.dripper_3 == 'ON'){ count_sw1[3] = 1; }else { count_sw1[3] = 0; }
                                        //     if(sw_log.dripper_4 == 'ON'){ count_sw1[4] = 1; }else { count_sw1[4] = 0; }
                                        //     if(parseJSON.dripper_1 == 'ON'){ count_stats1_on[1] = 1; }else { count_stats1_on[1] = 0; }
                                        //     if(parseJSON.dripper_2 == 'ON'){ count_stats1_on[2] = 1; }else { count_stats1_on[2] = 0; }
                                        //     if(parseJSON.dripper_3 == 'ON'){ count_stats1_on[3] = 1; }else { count_stats1_on[3] = 0; }
                                        //     if(parseJSON.dripper_4 == 'ON'){ count_stats1_on[4] = 1; }else { count_stats1_on[4] = 0; }
                                        //     if(sw_log.fan_1 == 'ON'){ count_sw2[1] = 1; }else { count_sw2[1] = 0; }
                                        //     if(sw_log.fan_2 == 'ON'){ count_sw2[2] = 1; }else { count_sw2[2] = 0; }
                                        //     if(sw_log.fan_3 == 'ON'){ count_sw2[3] = 1; }else { count_sw2[3] = 0; }
                                        //     if(sw_log.fan_4 == 'ON'){ count_sw2[4] = 1; }else { count_sw2[4] = 0; }
                                        //     if(parseJSON.fan_1 == 'ON'){ count_stats2_on[1] = 1; }else { count_stats2_on[1] = 0; }
                                        //     if(parseJSON.fan_2 == 'ON'){ count_stats2_on[2] = 1; }else { count_stats2_on[2] = 0; }
                                        //     if(parseJSON.fan_3 == 'ON'){ count_stats2_on[3] = 1; }else { count_stats2_on[3] = 0; }
                                        //     if(parseJSON.fan_4 == 'ON'){ count_stats2_on[4] = 1; }else { count_stats2_on[4] = 0; }
                                        //     if(sw_log.foggy_1 == 'ON'){ count_sw3[1] = 1; }else { count_sw3[1] = 0; }
                                        //     if(sw_log.foggy_2 == 'ON'){ count_sw3[2] = 1; }else { count_sw3[2] = 0; }
                                        //     if(parseJSON.foggy_1 == 'ON'){ count_stats3_on[1] = 1; }else { count_stats3_on[1] = 0; }
                                        //     if(parseJSON.foggy_2 == 'ON'){ count_stats3_on[2] = 1; }else { count_stats3_on[2] = 0; }
                                        //
                                        //     $('.sw_sel_load_manual').click(function(){
                                        //         var numb = Number($(this).attr('id').substring(1));
                                        //         if($('#close_manual_cont').is(":hidden") != false){
                                        //             fn_check_sw_on_off(numb);
                                        //         }
                                        //     });
                                        //     fn_check_sw_on_off($('.hidden_select_sw_manual').val());
                                        //     function fn_check_sw_on_off(val){
                                        //         if(val == 1){ // dripper
                                        //             if(countElement(1,count_sw1) == countElement(1,count_stats1_on)){
                                        //                 $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                        //                 $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                        //             }
                                        //             else {
                                        //                 $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                        //                 $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                        //             }
                                        //         }
                                        //         else if(val == 2){ // FAN
                                        //             if(countElement(1,count_sw2) == countElement(1,count_stats2_on)){
                                        //                 $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                        //                 $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                        //             }else {
                                        //                 $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                        //                 $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                        //             }
                                        //         }
                                        //         else if(val == 3){ // foggy
                                        //             if(countElement(1,count_sw3) == countElement(1,count_stats3_on)){
                                        //                 $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                        //                 $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                        //             }else {
                                        //                 $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                        //                 $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                        //             }
                                        //         }
                                        //         else if(val == 4){ // spray
                                        //             if(parseJSON.spray == 'ON'){
                                        //                 $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                        //                 $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                        //             }else {
                                        //                 $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                        //                 $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                        //             }
                                        //         }
                                        //         else if(val == 5){ // shading
                                        //             if(parseJSON.shading == 'ON'){
                                        //                 $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                        //                 $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                        //             }else {
                                        //                 $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                        //                 $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                        //             }
                                        //         }
                                        //     }
                                        //     if(countElement(1,count_sw1) == countElement(1,count_stats1_on)){
                                        //         $('.img_sw_sel_load_manual_1').attr('src','public/images/icons/menu_control/dripper_on.png');
                                        //     }else {
                                        //         $('.img_sw_sel_load_manual_1').attr('src','public/images/icons/menu_control/dripper_off.png');
                                        //     }
                                        //     if(countElement(1,count_sw2) == countElement(1,count_stats2_on)){
                                        //         $('.img_sw_sel_load_manual_2').attr('src','public/images/icons/menu_control/fan_on.png');
                                        //     }else {
                                        //         $('.img_sw_sel_load_manual_2').attr('src','public/images/icons/menu_control/fan_off.png');
                                        //     }
                                        //     if(countElement(1,count_sw3) == countElement(1,count_stats3_on)){
                                        //         $('.img_sw_sel_load_manual_3').attr('src','public/images/icons/menu_control/foggy_on.png');
                                        //     }else {
                                        //         $('.img_sw_sel_load_manual_3').attr('src','public/images/icons/menu_control/foggy_off.png');
                                        //     }
                                        //     if(parseJSON.spray == 'ON'){
                                        //         $('.img_sw_sel_load_manual_4').attr('src','public/images/icons/menu_control/spray_on.png');
                                        //     }else {
                                        //         $('.img_sw_sel_load_manual_4').attr('src','public/images/icons/menu_control/spray_off.png');
                                        //     }
                                        //     if(parseJSON.shading == 'ON'){
                                        //         $('.img_sw_sel_load_manual_5').attr('src','public/images/icons/menu_control/shading_on.png');
                                        //     }else {
                                        //         $('.img_sw_sel_load_manual_5').attr('src','public/images/icons/menu_control/shading_off.png');
                                        //     }
                                        //
                                        //     // status control dashboard Manual
                                        //     for (var i = 1; i <= 12; i++) {
                                        //         if (config_cn['cn_status_' + i] == 1) {
                                        //             if (i <= 4) {
                                        //                 if (parseJSON['dripper_' + i] === 'OFF') {
                                        //                     if(sw_log['dripper_'+i] == 'ON'){
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                        //                     }else {
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                        //                     }
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_on.png');
                                        //                 }
                                        //             }
                                        //             if (i > 4 && i <= 8) {
                                        //                 if (parseJSON['fan_' + (i - 4)] === 'OFF') {
                                        //                     if(sw_log['fan_'+(i - 4)] === 'ON'){
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                        //                     }else {
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                        //                     }
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 9 || i == 10) {
                                        //                 if (parseJSON['foggy_' + (i - 8)] === 'OFF') {
                                        //                     if(sw_log['foggy_'+(i - 8)] === 'ON'){
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                        //                     }else {
                                        //                         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                        //                     }
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 11) {
                                        //                 if (parseJSON['spray'] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-off.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 12) {
                                        //                 if (parseJSON['shading'] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_OFF2.png");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_ON2.png");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_on.png');
                                        //                 }
                                        //             }
                                        //         }
                                        //     }
                                        // }
                                        // else { // โหมดอัตโนมัติ
                                        //     $('.dash_mode').html('โหมดอัตโนมัติ')
                                        //     $('.sw_mode_Auto').addClass('btn-success').removeClass('btn-outline-success')
                                        //     $('.sw_mode_Manual').removeClass('btn-success').addClass('btn-outline-success')
                                        //     $('.ul_Auto').show()
                                        //     $('.ul_Manual').hide()
                                        //     if($('#Modal_control').hasClass('show') == true){
                                        //         $(".img_sw").show();
                                        //         $('.input_time').prop('disabled', true);
                                        //         $(".sw_toggle").hide();
                                        //         $(".menu_config_auto").show();
                                        //         $("#save_auto_cont").hide();
                                        //         $("#close_auto_cont").hide();
                                        //         $(".sw_mode_Auto").attr('disabled', false);
                                        //         $(".sw_mode_Manual").attr('disabled', false);
                                        //     }
                                        //     // status control dashboard Auto
                                        //     for (var i = 1; i <= 12; i++) {
                                        //         if (config_cn['cn_status_' + i] == 1) {
                                        //             if (i <= 4) {
                                        //                 if (parseJSON['dripper_' + i] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_on.png');
                                        //                 }
                                        //             }
                                        //             if (i > 4 && i <= 8) {
                                        //                 if (parseJSON['fan_' + (i - 4)] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 9 || i == 10) {
                                        //                 if (parseJSON['foggy_' + (i - 8)] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 11) {
                                        //                 if (parseJSON['spray'] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-off.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-on.svg");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_on.png');
                                        //                 }
                                        //             }
                                        //             if (i == 12) {
                                        //                 if (parseJSON['shading'] === 'OFF') {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_OFF2.png");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_off.png');
                                        //                 } else {
                                        //                     $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_ON2.png");
                                        //                     $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_on.png');
                                        //                 }
                                        //             }
                                        //         }
                                        //     }
                                        // }
                                    }
                                    // else if (message.destinationName == house_master + "/1/data_update/data_filter2"){
                                    //
                                    //     if( $.map(data_temp.temp_1, function(n, i) { return i; }).length > 0){
                                    //     //     console.log( $.map(data_temp.temp_1, function(n, i) { return i; }).length );
                                    //     //     var a = $.map(data_temp.temp_1, function(value, index) { return [value]; })
                                    //     // var a =[];
                                    //     // for (var i = 0; i < $.map(data_temp.temp_1, function(n, i) { return i; }).length; i++) {
                                    //     //     if(i != 0){
                                    //     //         a.push(data_temp.temp_1[i])
                                    //     //     }
                                    //     // }data_temp.temp_1 = a;
                                    //     //     console.log(
                                    //     //         data_temp.temp_1
                                    //     //     );
                                    //     //     // console.log( data_temp.temp_1.shift() );
                                    //     // }
                                    // }
                                }// exit_message
                                connect();
                                loadingOut(loading);
                                // ++++++++++++++++++++++++++++++++++
                            }
                        });

                        $.ajax({
                            url: "routes/v.3/pages_report.php",
                            method: "post",
                            data: {
                                data: res,
                                count_control : countElement(1,controlStatus),
                                count_temp: countElement(1,temp_c),
                                count_hum: countElement(1,hum_c),
                                count_light: countElement(1,light_c),
                                count_soil: countElement(1,soil_c)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages_report").html(res_dash);
                            }
                        });

                        // chart_realtime
                        var optionsLine = {
                            chart: {
                                id: 'realtime',
                                foreColor: '#9ba7b2',
                                height: 560,
                                type: 'line',
                                toolbar: {
                                    show: false,
                                    tools: {
                                        download: false,
                                        selection: true,
                                         zoom: true,
                                         zoomin: true,
                                         zoomout: true,
                                         pan: true,
                                    }
                                },
                                dropShadow: {
                                    enabled: true,
                                    top: 3,
                                    left: 2,
                                    blur: 4,
                                    opacity: 0.1,
                                }
                            },
                            stroke: {
                                curve: 'smooth',
                                width: 3
                            },
                            // colors: ["#0d6efd", '#212529'],
                            // series: [{
                            //   data: data.slice()
                            // }],
                            series: [],
                            // [{
                            //     name: "temp_out",
                            //     data: res.data.temp_out//[1, 15, 56, 20, 33, 27]
                            // }, {
                            //     name: "temp_in",
                            //     data: res.data.temp_in//[30, 33, 21, 42, 19, 32]
                            // }],
                            title: {
                                // text: 'Multiline Chart',
                                align: 'left',
                                offsetY: 30,
                                // offsetX: 20
                            },
                            animations: {
                              enabled: true,
                              easing: 'linear',
                              // dynamicAnimation: {
                              //   speed: 1000
                              // }
                            },
                            markers: {
                                size: 1,
                                strokeWidth: 0,
                                hover: {
                                    size: 6
                                }
                            },
                            grid: {
                                show: true,
                                padding: {
                                    bottom: 0
                                }
                            },
                            xaxis: {
                                type: 'datetime',
                                // categories:res.data.timestamp,
                                labels: {
                                    datetimeUTC: false,
                                    // format: 'dd/MM HH:mm',
                                    datetimeFormatter: {
                                        year: 'yyyy',
                                        month: 'MMM \'yy',
                                        day: 'dd MMM',
                                        hour: 'HH:mm'
                                    }
                                }
                            },
                            legend: {
                                // position: 'top',
                                // horizontalAlign: 'right',
                                // offsetY: -30
                            },
                            fill: {
                                type: "solid",
                                fillOpacity: 0.7
                            },
                            noData: {
                                text: 'Loading...'
                            },
                            tooltip: {
                                x: {
                                    format: 'yyyy-MM-dd HH:mm'
                                },
                            }
                        }
                        var chartLine1 = new ApexCharts(document.querySelector('#chart1'), optionsLine);
                        chartLine1.render();
                        var chartLine2 = new ApexCharts(document.querySelector('#chart2'), optionsLine);
                        chartLine2.render();
                        var chartLine3 = new ApexCharts(document.querySelector('#chart3'), optionsLine);
                        chartLine3.render();
                        var chartLine4 = new ApexCharts(document.querySelector('#chart4'), optionsLine);
                        chartLine4.render();

                        $.ajax({
                            url: "routes/v.3/get_chart_realtime.php",
                            method: "post",
                            data: {
                                house_master: house_master,
                                data: res
                            },
                            dataType: "json",
                            success: function(resp) {
                                // alert($.map(resp.temp, function(n, i) { return i; }).length)
                                // console.log(resp);
                                if($.map(resp.temp, function(n, i) { return i; }).length > 0){
                                    data_temp = resp.temp;
                                    var n_data = [];
                                    // console.log(data_temp['temp_1']);
                                    for (var i = 1; i <= $.map(resp.temp, function(n, i) { return i; }).length; i++) {
                                        n_data.push({
                                            name:resp.Ntemp[(i-1)],
                                            data: data_temp['temp_'+i]
                                        })
                                    }
                                    chartLine1.updateSeries(n_data)
                                    chartLine1.updateOptions({
                                        title:  {text: 'อุณหภูมิ (℃)'},
                                        tooltip: {
                                            y: {
                                            	formatter: function (val) {
                                            		return  val + " ℃"
                                            	}
                                            }
                                        },
                                    })
                                }
                                if($.map(resp.hum, function(n, i) { return i; }).length > 0){
                                    data_hum = resp.hum;
                                    var n_data = [];
                                    for (var i = 1; i <= $.map(resp.hum, function(n, i) { return i; }).length; i++) {
                                        n_data.push({
                                            name:resp.Nhum[(i-1)],
                                            data: data_temp['hum_'+i]
                                        })
                                    }
                                    chartLine2.updateSeries(n_data)
                                    chartLine2.updateOptions({
                                        title:  {text: 'ความชื้น (%Rh)'},
                                        tooltip: {
                                            y: {
                                            	formatter: function (val) {
                                            		return  val + " %Rh"
                                            	}
                                            }
                                        },
                                    })
                                }
                                if($.map(resp.light, function(n, i) { return i; }).length > 0){
                                    data_light = resp.light;
                                    var n_data = [];
                                    if(resp.UnitL == 4){
                                        for (var i = 1; i <= $.map(resp.light, function(n, i) { return i; }).length; i++) {
                                            n_data.push({
                                                name:resp.Nlight[(i-1)],
                                                data: data_light['light_'+i]
                                            })
                                        }
                                        chartLine3.updateSeries(n_data)
                                        chartLine3.updateOptions({
                                            title:  {text: 'ความเข้มแสง (Klux)'},
                                            tooltip: {
                                                y: {
                                                	formatter: function (val) {
                                                		return  val + " Klux"
                                                	}
                                                }
                                            },
                                        })
                                    }else if(resp.UnitL == 5){
                                        // var unit = "µmol m[baseline-shift: super; font-size: 10;]-2[baseline-shift: baseline;]s[baseline-shift: super; font-size: 10;]-1[baseline-shift: baseline;]";
                                        for (var i = 1; i <= $.map(resp.light, function(n, i) { return i; }).length; i++) {
                                            n_data.push({
                                                name:resp.Nlight[(i-1)]+' (µmol m<sup>-2</sup>s<sup>-1</sup>)',
                                                data: data_light['light_'+i]
                                            })
                                        }
                                        chartLine3.updateSeries(n_data)
                                        chartLine3.updateOptions({
                                            title:{text:'ความเข้มแสง'},
                                            tooltip: {
                                                y: {
                                                	formatter: function (val) {
                                                		return  val + " µmol m<sup>-2</sup>s<sup>-1</sup>"
                                                	}
                                                }
                                            },
                                        })
                                    }
                                }
                                if($.map(resp.soil, function(n, i) { return i; }).length > 0){
                                    data_soil = resp.soil;
                                    var n_data = [];
                                    for (var i = 1; i <= $.map(resp.soil, function(n, i) { return i; }).length; i++) {
                                        n_data.push({
                                            name:resp.Nsoil[(i-1)],
                                            data: data_soil['soil_'+i]
                                        })
                                    }
                                    chartLine4.updateSeries(n_data)
                                    chartLine4.updateOptions({
                                        title:  {text: 'ความชื้นดิน (%)'},
                                        tooltip: {
                                            y: {
                                            	formatter: function (val) {
                                            		return  val + " %"
                                            	}
                                            }
                                        },
                                    })
                                }
                                // console.log(res.data);
                            }
                        });
                        // $('.btn_ch_t ').click(function(){
                        //     setTimeout(function(){
                        //         if(data_temp_in.length > 0){
                        //             chartLine1.updateSeries([
                        //                 {
                        //                     name: config_sn.sn_name_1,
                        //                     data: data_temp_out
                        //                 }, {
                        //                     name: config_sn.sn_name_4,
                        //                     data: data_temp_in
                        //                 }
                        //             ])
                        //         }
                        //     }, 1000);
                        // })
                        // $('.btn_ch_h ').click(function(){
                        //     setTimeout(function(){
                        //         if(data_hum_in.length > 0){
                        //             chartLine2.updateSeries([
                        //                 {
                        //                     name: config_sn.sn_name_2,
                        //                     data: data_hum_out
                        //                 }, {
                        //                     name: config_sn.sn_name_5,
                        //                     data: data_hum_in
                        //                 }
                        //             ])
                        //         }
                        //     }, 1000);
                        // })
                        // $('.btn_ch_l ').click(function(){
                        //     setTimeout(function(){
                        //         if(data_light_in.length > 0){
                        //             chartLine3.updateSeries([
                        //                 {
                        //                     name: config_sn.sn_name_3,
                        //                     data: data_light_out
                        //                 }, {
                        //                     name: config_sn.sn_name_6,
                        //                     data: data_light_in
                        //                 }
                        //             ])
                        //         }
                        //     }, 1000);
                        // })
                        // $('.btn_ch_s ').click(function(){
                        //     setTimeout(function(){
                        //         if(data_soil_in.length > 0){
                        //             chartLine4.updateSeries([
                        //                 {
                        //                     name: config_sn.sn_name_7,
                        //                     data: data_soil_in
                        //                 }]
                        //             )
                        //         }
                        //     }, 1000);
                        // })
                    }
                });
            }
            else if (url[0] == 33) {
                $(".title_km").html("ประวัติการตั้งเวลา");
                // return false;
                $.ajax({
                    url: "routes/v.3/get_config.php",
                    method: "post",
                    data: {
                        house_master: house_master
                    },
                    dataType: "json",
                    success: function(res) {
                        console.log(res);

                        //     }
                        // });
                        // $.ajax({
                        //     url: "http://localhost:3001/get_dash/dash/",
                        //     method: "post",
                        //     data: {
                        //         house_master: house_master,
                        //         field2: 2
                        //     },
                        //     // contentType: "application/json",
                        //     success: function(res) {
                        //         console.log(res);
                        var dashStatus = res.dashStatus;
                        var dashName = res.dashName;
                        var dashSncanel = res.dashSncanel;
                        var dashMode = res.dashMode;
                        var dashImg = res.dashImg;
                        var dashUnit = res.dashUnit;
                        var controlStatus = res.controlstatus;
                        var imgCon = res.imgCon;

                        var meter_status = res.meter_status;
                        var meter_chenal = res.meter_chenal;
                        var meterImg = res.meterImg;
                        var meterUnit = res.meterUnit;
                        var time_update = res.time_update;

                        var array_realChT = [];
                        var array_realnameT = [];
                        var array_realChH = [];
                        var array_realnameH = [];
                        var array_realChS = [];
                        var array_realnameS = [];
                        var array_realChL = [];
                        var array_realnameL = [];
                        var array_realChP = [];
                        var array_realnameP = [];
                        var temp_c = [];
                        var hum_c = [];
                        var light_c = [];
                        var soil_c = [];
                        var power_c = [];
                        var unit_T = [];
                        var unit_H = [];
                        var unit_S = [];
                        var unit_L = [];
                        var unit_P = [];
                        for (var i = 1; i <= 40; i++) {
                            if (dashStatus[i] == 1) {
                                if (dashMode[i] == 1) {
                                    temp_c.push(1);
                                    array_realChT.push(dashSncanel[i]);
                                    array_realnameT.push(dashName[i]);
                                    unit_T.push("℃");
                                } else if (dashMode[i] == 2) {
                                    hum_c.push(1);
                                    array_realChH.push(dashSncanel[i]);
                                    array_realnameH.push(dashName[i]);
                                    unit_H.push("%Rh");
                                } else if (dashMode[i] == 3) {
                                    soil_c.push(1);
                                    array_realChS.push(dashSncanel[i]);
                                    array_realnameS.push(dashName[i]);
                                    unit_H.push("%");
                                } else if (dashMode[i] == 4 || dashMode[i] == 5) {
                                    light_c.push(1);
                                    if (house_master !== "KMUMT001") {
                                        array_realChL.push(dashSncanel[i] + "/1000");
                                    } else {
                                        array_realChL.push(dashSncanel[i]);
                                    }
                                    array_realnameL.push(dashName[i]);
                                    unit_L.push("Klux");
                                } else if (dashMode[i] == 6 || dashMode[i] == 7) {
                                    light_c.push(1);
                                    array_realChL.push(dashSncanel[i] + "/54");
                                    array_realnameL.push(dashName[i]);
                                    unit_L.push("µmol m[baseline-shift: super; font-size: 10;]-2[baseline-shift: baseline;]s[baseline-shift: super; font-size: 10;]-1[baseline-shift: baseline;]");
                                } else if (dashMode[i] == 10) {
                                    power_c.push(1);
                                    array_realChP.push(dashSncanel[i]);
                                    array_realnameP.push("กำลังไฟฟ้า");
                                    unit_P.push("W");
                                }
                            }
                        }


                        var count_stcont = getArraySum(controlStatus);
                        var meter_count = getArraySum(meter_status);
                        // alert(meter_count);
                        $.ajax({
                            url: "routes/v.3/pagex_dashboard.php",
                            method: "post",
                            data: {
                                user:res.user,
                                s_master: res.s_master,
                                dashStatus: dashStatus,
                                dashName: dashName,
                                count_stcont: count_stcont,
                                controlstatus: controlStatus,
                                conttrolname: res.conttrolname,
                                ingMap: res.ingMap,
                                meter_count: meter_count,
                                meter_status: meter_status,
                                s_btnT: getArraySum(temp_c),
                                s_btnH: getArraySum(hum_c),
                                s_btnS: getArraySum(soil_c),
                                s_btnL: getArraySum(light_c)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages").html(res_dash);

                                // chack_realtime();

                                function chack_realtime() {
                                    am4core.ready(function() {
                                        // ++++++--------+++++++++
                                        // Global variables
                                        var client = null;
                                        // These are configs
                                        var hostname = "203.150.37.144"; //'103.2.115.15'; // 203.150.37.144   decccloud.com
                                        var port = "8083";
                                        var clientId = "mqtt_js_37074" + parseInt(Math.random() * 100000, 10);
                                        var count = 0;

                                        function connect() {
                                            client = new Paho.MQTT.Client(hostname, Number(port), clientId);
                                            console.info('Connecting to Server: Hostname: ', hostname, '. Port: ', port, '. Client ID: ', clientId);

                                            client.onConnectionLost = onConnectionLost;
                                            client.onMessageArrived = onMessageArrived;

                                            var options = {
                                                onSuccess: onConnect, // after connected, subscribes
                                                onFailure: onFail // useful for logging / debugging
                                            };
                                            // connect the client
                                            client.connect(options);
                                            console.info('Connecting...');
                                        }
                                        // ---------------------------------------------------------------------------------------

                                        function onConnect(context) {
                                            console.log("Client Connected");
                                            // And subscribe to our topics	-- both with the same callback function
                                            options = {
                                                qos: 1,
                                                onSuccess: function(context) {
                                                    // console.log("ไม่สามารถเชื่อมต่อกับ เครื่อง ได้ !!!!");
                                                    // setInterval(function() {
                                                    //     location.reload();
                                                    // }, 30000);
                                                    console.log("subscribed");
                                                }
                                            }
                                            client.subscribe(house_master + "/1/data_update/data_filter", options);
                                            client.subscribe(house_master + "/1/control/json_control_filter", options);

                                        }

                                        function onFail(context) {
                                            location.reload();
                                        }

                                        function onConnectionLost(responseObject) {
                                            if (responseObject.errorCode !== 0) {
                                                console.log("Connection Lost: " + responseObject.errorMessage);
                                                connect();
                                                // location.reload();
                                                // window.alert("Someone else took my websocket!\nRefresh to take it back.");
                                            }
                                        }
                                        // +++++++++------------+++++++++++
                                        const myArr = res.theme.split(" ");
                                        // alert(myArr[0])
                                        if (myArr[0] === "dark-theme") {
                                            am4core.useTheme(am4themes_dark);
                                        }
                                        am4core.useTheme(am4themes_animated);
                                        var chart = am4core.create("chart_realtime", am4charts.XYChart);
                                        chart.dateFormatter.inputDateFormat = "yyyy/MM/dd - HH:mm";

                                        var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
                                        dateAxis.periodChangeDateFormats.setKey("hour", "[bold]dd MMM ");
                                        dateAxis.tooltipDateFormat = "HH:mm, d MMM yyyy";

                                        var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

                                        // alert($(".btn_ch_t").hasClass("active"))
                                        if ($(".btn_ch_t").hasClass("active") == true) {
                                            var array_realCh = array_realChT;
                                            var array_realname = array_realnameT;
                                            var unit = unit_T;
                                        }
                                        if ($(".btn_ch_h").hasClass("active") == true) {
                                            var array_realCh = array_realChH;
                                            var array_realname = array_realnameH;
                                            var unit = unit_H;
                                        }
                                        if ($(".btn_ch_s").hasClass("active") == true) {
                                            var array_realCh = array_realChS;
                                            var array_realname = array_realnameS;
                                            var unit = unit_S;
                                        }
                                        if ($(".btn_ch_l").hasClass("active") == true) {
                                            var array_realCh = array_realChL;
                                            var array_realname = array_realnameL;
                                            var unit = unit_L;
                                        }
                                        if ($(".btn_ch_p").hasClass("active") == true) {
                                            var array_realCh = array_realChP;
                                            var array_realname = array_realnameP;
                                            var unit = unit_P;
                                        }
                                        var new_array_realCh = [];
                                        // alert(array_realCh.length)
                                        for (var a = 1; a <= array_realCh.length; a++) {
                                            new_array_realCh.push('round(' + array_realCh[(a - 1)] + ', 1) AS new_' + a);
                                        }
                                        console.log([
                                            'nn', $(".btn_ch_l").hasClass("active"),
                                            new_array_realCh
                                        ]);
                                        // return false
                                        $.ajax({
                                            url: 'routes/get_chart_realtime.php',
                                            method: "post",
                                            data: {
                                                house_master: house_master,
                                                array_realCh: new_array_realCh,
                                                array_realname: array_realname
                                            },
                                            dataType: "json",
                                            success: function(res_chart) {
                                                if (res_chart.theme === "dark-theme") {
                                                    am4core.useTheme(am4themes_dark);
                                                }
                                                // $("#chart_realtime").addClass("");
                                                console.log(res_chart)
                                                chart.data = res_chart.data;

                                                var series = [];
                                                for (var i = 1; i <= array_realCh.length; i++) {
                                                    series[i] = chart.series.push(new am4charts.LineSeries());
                                                    series[i].dataFields.valueY = "new_" + i;
                                                    series[i].dataFields.dateX = "data_timestamp";
                                                    series[i].tooltipText = array_realname[i - 1] + " {new_" + i + "} (" + unit[i - 1] + ")";
                                                    series[i].name = array_realname[i - 1];
                                                    series[i].strokeWidth = 2;


                                                }
                                            }
                                        });

                                        chart.cursor = new am4charts.XYCursor();
                                        // chart.cursor.snapToSeries = series;
                                        chart.cursor.xAxis = dateAxis;

                                        chart.scrollbarX = new am4core.Scrollbar();
                                        chart.scrollbarX.parent = chart.bottomAxesContainer;
                                        // Add legend
                                        chart.legend = new am4charts.Legend();
                                        chart.legend.itemContainers.template.events.on("over", function(event) {
                                            var segments = event.target.dataItem.dataContext.segments;
                                            segments.each(function(segment) {
                                                segment.isHover = true;
                                            })
                                        })

                                        chart.legend.itemContainers.template.events.on("out", function(event) {
                                            var segments = event.target.dataItem.dataContext.segments;
                                            segments.each(function(segment) {
                                                segment.isHover = false;
                                            })
                                        })

                                        // ------zzz
                                        function onMessageArrived(message) {
                                            if (message.destinationName == house_master + "/1/data_update/data_filter") {
                                                var result = message.payloadString;
                                                var parseJSON = $.parseJSON(result);
                                                // console.log(parseJSON);
                                                if (house_master === "KMUMT001") {
                                                    var p_json = parseJSON['data_update']['data'][0];
                                                    var data_array = p_json['data'];
                                                    // console.log(parseJSON);
                                                    console.log(data_array);

                                                    // console.log(loading);
                                                    // -------------------------------------------------------------
                                                    var chart_timestamp = p_json['date_time'];
                                                    var time_t = p_json['time'];
                                                    var ntime = time_t.substring(0, 5);
                                                    $(".date").html(p_json['date']);
                                                    $(".time").html(ntime);
                                                    // --------------------------------------substring(1, 4)
                                                    // console.log(Sncanel.sncanel_1_1.substring(7));
                                                    // $("#time_stamp").html("Data update : "+time_stmap);
                                                    // return false;
                                                    let strdate = new Date();
                                                    var strNdate = moment(new Date()).add(-10, 'minutes').format('YYYY/MM/DD');
                                                    if (time_update != "false") {
                                                        if (time_update.substring(0, 10) == strNdate || p_json['date'] == strNdate) {
                                                            $(".status_timeUpdate").removeClass("text-danger").addClass("text-success").html("ออนไลน์")
                                                        } else {
                                                            $(".status_timeUpdate").removeClass("text-success").addClass("text-danger").html("ออฟไลน์")
                                                        }
                                                    }

                                                } else {
                                                    // console.log(loading);// != KMUMT001
                                                    // -------------------------------------------------------------
                                                    var chart_timestamp = parseJSON['date_time'];
                                                    var time_t = parseJSON['time'];
                                                    var ntime = time_t.substring(0, 5);
                                                    $(".date").html(parseJSON['date']);
                                                    $(".time").html(ntime);
                                                    // var data_array = parseJSON['data_update']['data'][0]['data'];
                                                    var data_array = parseJSON['data'];
                                                    let strdate = new Date();
                                                    var strNdate = moment(new Date()).add(-10, 'minutes').format('YYYY/MM/DD');
                                                    if (time_update != false) {
                                                        if (time_update.substring(0, 10) == strNdate || parseJSON['date'] == strNdate) {
                                                            $(".status_timeUpdate").removeClass("text-danger").addClass("text-success").html("ออนไลน์")
                                                        } else {
                                                            $(".status_timeUpdate").removeClass("text-success").addClass("text-danger").html("ออฟไลน์")
                                                        }
                                                    }

                                                    // alert(time_update.substring(0, 10) + ' ' + parseJSON['date'] + " " + strNdate)
                                                }
                                                // console.log(parseJSON);
                                                // console.log(dashImg[1]);

                                                var sn_unit = [];
                                                var data_dash = [];
                                                var new_chart = [];
                                                for (var i = 1; i <= 40; i++) {
                                                    if (dashStatus[i] == 1) {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + dashImg[i]);

                                                        // show_dash(unit = dashUnit[i],snmode = dashMode[i]);
                                                        if (house_master !== "KMUMT001") {
                                                            if (dashMode[i] === "7") { // µmol / Klux
                                                                $(".dash_data_1_" + i).html((data_array[dashSncanel[i]] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>' + '<br>' + (data_array[dashSncanel[i]] / 1000).toFixed(1) + " Klux");
                                                            } else if (dashMode[i] === "6") {
                                                                $(".dash_data_1_" + i).html((data_array[dashSncanel[i]] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>');
                                                            } else if (dashMode[i] === "5") {
                                                                $(".dash_data_1_" + i).html((data_array[dashSncanel[i]] / 1000).toFixed(1) + " Klux" + '<br>' + (data_array[dashSncanel[i]] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>');
                                                            } else {
                                                                if (data_array[dashSncanel[i]] >= 1000) {
                                                                    data_dash[i] = (data_array[dashSncanel[i]] / 1000).toFixed(1);
                                                                    sn_unit[i] = 'K' + dashUnit[i];
                                                                } else if (data_array[dashSncanel[i]] >= 1000000) {
                                                                    data_dash[i] = (data_array[dashSncanel[i]] / 1000).toFixed(1);
                                                                    sn_unit[i] = 'M' + dashUnit[i];
                                                                } else {
                                                                    data_dash[i] = (data_array[dashSncanel[i]] * 1).toFixed(1);
                                                                    if (dashUnit[i] === "1") {
                                                                        sn_unit[i] = "℃";
                                                                    } else {
                                                                        sn_unit[i] = dashUnit[i];
                                                                    }
                                                                    $(".dash_data_1_" + i).html(data_dash[i] + " " + sn_unit[i]);
                                                                }
                                                            }
                                                            // ++++++++++
                                                            if ($(".btn_ch_t").hasClass("active") == true) {
                                                                if (dashMode[i] === "1") {
                                                                    new_chart.push((data_array[dashSncanel[i]] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_h").hasClass("active") == true) {
                                                                if (dashMode[i] === "2") {
                                                                    new_chart.push((data_array[dashSncanel[i]] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_s").hasClass("active") == true) {
                                                                if (dashMode[i] === "3") {
                                                                    new_chart.push((data_array[dashSncanel[i]] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_l").hasClass("active") == true) {
                                                                if (dashMode[i] === "4" || dashMode[i] === "5") {
                                                                    new_chart.push((data_array[dashSncanel[i]] / 1000).toFixed(1));
                                                                }
                                                                if (dashMode[i] === "6" || dashMode[i] === "7") {
                                                                    new_chart.push((data_array[dashSncanel[i]] / 54).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_p").hasClass("active") == true) {
                                                                if (dashMode[i] === "10") {
                                                                    new_chart.push((data_array[dashSncanel[i]] * 1).toFixed(1));
                                                                }
                                                            }
                                                        } else { //=== KMUMT001
                                                            if (dashMode[i] === "7") { // µmol / Klux
                                                                $(".dash_data_1_" + i).html((data_array["data_st" + dashSncanel[i].substring(7)] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>' + '<br>' + (data_array[dashSncanel[i]] / 1000).toFixed(1) + " Klux");
                                                            } else if (dashMode[i] === "6") {
                                                                $(".dash_data_1_" + i).html((data_array["data_st" + dashSncanel[i].substring(7)] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>');
                                                            } else if (dashMode[i] === "5") {
                                                                $(".dash_data_1_" + i).html((data_array["data_st" + dashSncanel[i].substring(7)] / 1000).toFixed(1) + " Klux" + '<br>' + (data_array[dashSncanel[i]] / 54).toFixed(1) + ' µmol m<sup>-2</sup>s<sup>-1</sup>');
                                                            } else if (dashMode[i] === "4") {
                                                                $(".dash_data_1_" + i).html((data_array["data_st" + dashSncanel[i].substring(7)]).toFixed(1) + " Klux");
                                                            } else {
                                                                if (data_array["data_st" + dashSncanel[i].substring(7)] >= 1000) {
                                                                    data_dash[i] = (data_array["data_st" + dashSncanel[i].substring(7)] / 1000).toFixed(1);
                                                                    sn_unit[i] = 'K' + dashUnit[i];
                                                                } else if (data_array["data_st" + dashSncanel[i].substring(7)] >= 1000000) {
                                                                    data_dash[i] = (data_array["data_st" + dashSncanel[i].substring(7)] / 1000).toFixed(1);
                                                                    sn_unit[i] = 'M' + dashUnit[i];
                                                                } else {
                                                                    data_dash[i] = (data_array["data_st" + dashSncanel[i].substring(7)] * 1).toFixed(1);
                                                                    if (dashUnit[i] === "1") {
                                                                        sn_unit[i] = "℃";
                                                                    } else {
                                                                        sn_unit[i] = dashUnit[i];
                                                                    }
                                                                    $(".dash_data_1_" + i).html(data_dash[i] + " " + sn_unit[i]);
                                                                }
                                                            }
                                                            // ++++++++++
                                                            if ($(".btn_ch_t").hasClass("active") == true) {
                                                                if (dashMode[i] === "1") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_h").hasClass("active") == true) {
                                                                if (dashMode[i] === "2") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_s").hasClass("active") == true) {
                                                                if (dashMode[i] === "3") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)] * 1).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_l").hasClass("active") == true) {
                                                                if (dashMode[i] === "4" || dashMode[i] === "5") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)]).toFixed(1));
                                                                }
                                                                if (dashMode[i] === "6" || dashMode[i] === "7") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)] / 54).toFixed(1));
                                                                }
                                                            }
                                                            if ($(".btn_ch_p").hasClass("active") == true) {
                                                                if (dashMode[i] === "10") {
                                                                    new_chart.push((data_array["data_st" + dashSncanel[i].substring(7)] * 1).toFixed(1));
                                                                }
                                                            }
                                                        }
                                                    }
                                                }

                                                if (meter_count != 0) {
                                                    if (meter_status[1] == 1) {
                                                        $(".dash_img_v").attr("src", "public/images/Sensor/" + meterImg['Img_v']);
                                                        $(".dash_data_v").html(data_array[meter_chenal[1]].toFixed(1) + " " + meterUnit['Unit_v']);
                                                    }
                                                    if (meter_status[2] == 1) {
                                                        $(".dash_img_a").attr("src", "public/images/Sensor/" + meterImg['Img_a']);
                                                        $(".dash_data_a").html(data_array[meter_chenal[2]].toFixed(2) + " " + meterUnit['Unit_a']);
                                                    }
                                                    if (meter_status[3] == 1) {
                                                        $(".dash_img_p").attr("src", "public/images/Sensor/" + meterImg['Img_p']);
                                                        $(".dash_data_p").html(data_array[meter_chenal[3]].toFixed(2) + " " + meterUnit['Unit_p']);
                                                    }
                                                    if (meter_status[4] == 1) {
                                                        $(".dash_img_pf").attr("src", "public/images/Sensor/" + meterImg['Img_pf']);
                                                        $(".dash_data_pf").html(data_array[meter_chenal[4]].toFixed(2));
                                                    }
                                                    if (meter_status[5] == 1) {
                                                        $(".dash_img_engy").attr("src", "public/images/Sensor/" + meterImg['Img_engy']);
                                                        $(".dash_data_engy").html(data_array[meter_chenal[5]].toFixed(2) + " " + meterUnit['Unit_engy']);
                                                    }
                                                    if (meter_status[6] == 1) {
                                                        $(".dash_img_wc").attr("src", "public/images/Sensor/" + meterImg['Img_wc']);
                                                        $(".dash_data_wc").html(data_array[meter_chenal[6]].toFixed(2) + " " + meterUnit['Unit_wc']);
                                                    }
                                                    if (meter_status[7] == 1) {
                                                        $(".dash_img_wp").attr("src", "public/images/Sensor/" + meterImg['Img_wp']);
                                                        $(".dash_data_wp").html(data_array[meter_chenal[7]].toFixed(2) + " " + meterUnit['Unit_wp']);
                                                    }
                                                    if (meter_status[8] == 1) {
                                                        $(".dash_img_wd").attr("src", "public/images/Sensor/wind-direction1.png");
                                                        $(".dash_data_wd").html('ตะวันออก');
                                                    }
                                                }

                                                // $('.weather-temperature').openWeather({
                                                //     key: 'c9d49310f8023ee2617a7634de23c2aa',
                                                //     lat: '13.576', //res.s_master.site_Latitude, //site_Longitude
                                                //     lng: '100.442', //res.s_master.site_Longitude,
                                                //     // city: 'Los Angeles',
                                                //     descriptionTarget: '.weather-description',
                                                //     windSpeedTarget: '.weather-wind-speed',
                                                //     minTemperatureTarget: '.weather-min-temperature',
                                                //     maxTemperatureTarget: '.weather-max-temperature',
                                                //     humidityTarget: '.weather-humidity',
                                                //     sunriseTarget: '.weather-sunrise',
                                                //     sunsetTarget: '.weather-sunset',
                                                //     placeTarget: '.weather-place',
                                                //     iconTarget: '.weather-icon',
                                                //     customIcons: 'public/plugins/open-weather-master/src/img/icons/weather/',
                                                //     success: function(data) {
                                                //         // show weather
                                                //         $('.weather-wrapper').show();
                                                //         console.log(data);
                                                //     },
                                                //     error: function(data) {
                                                //         console.log(data.error);
                                                //         $('.weather-wrapper').remove();
                                                //     }
                                                // });
                                                // alert(res.s_master.site_Longitude)

                                                // var new_chart2 = [];
                                                // new_chart2.push(chart_timestamp);
                                                // for (var s = 1; s <= array_realCh.length; s++) {
                                                //     new_chart2.push({
                                                //         ['new_' + s]: new_chart[s - 1]
                                                //     });
                                                // }
                                                console.log('new_chart=' + new_chart.length)
                                                    // console.log(new_chart)
                                                if (new_chart.length == 1) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                    });
                                                } else if (new_chart.length == 2) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                    });
                                                } else if (new_chart.length == 2) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                    });
                                                } else if (new_chart.length == 3) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                    });
                                                } else if (new_chart.length == 4) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                    });
                                                } else if (new_chart.length == 5) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                    });
                                                } else if (new_chart.length == 6) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                    });
                                                } else if (new_chart.length == 7) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                    });
                                                } else if (new_chart.length == 8) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7]
                                                    });
                                                } else if (new_chart.length == 9) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8]
                                                    });
                                                } else if (new_chart.length == 10) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9]
                                                    });
                                                } else if (new_chart.length == 11) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10]
                                                    });
                                                } else if (new_chart.length == 12) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11]
                                                    });
                                                } else if (new_chart.length == 13) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12]
                                                    });
                                                } else if (new_chart.length == 14) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13]
                                                    });
                                                } else if (new_chart.length == 15) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14]
                                                    });
                                                } else if (new_chart.length == 16) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15]
                                                    });
                                                } else if (new_chart.length == 17) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16]
                                                    });
                                                } else if (new_chart.length == 18) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17]
                                                    });
                                                } else if (new_chart.length == 19) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18]
                                                    });
                                                } else if (new_chart.length == 20) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19]
                                                    });
                                                } else if (new_chart.length == 21) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19],
                                                        new_21: new_chart[20]
                                                    });
                                                } else if (new_chart.length == 22) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19],
                                                        new_21: new_chart[20],
                                                        new_22: new_chart[21]
                                                    });
                                                } else if (new_chart.length == 23) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19],
                                                        new_21: new_chart[20],
                                                        new_22: new_chart[21],
                                                        new_23: new_chart[22]
                                                    });
                                                } else if (new_chart.length == 24) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19],
                                                        new_21: new_chart[20],
                                                        new_22: new_chart[21],
                                                        new_23: new_chart[22],
                                                        new_24: new_chart[23]
                                                    });
                                                } else if (new_chart.length == 25) {
                                                    chart.addData({
                                                        data_timestamp: chart_timestamp,
                                                        new_1: new_chart[0],
                                                        new_2: new_chart[1],
                                                        new_3: new_chart[2],
                                                        new_4: new_chart[3],
                                                        new_5: new_chart[4],
                                                        new_6: new_chart[5],
                                                        new_7: new_chart[6],
                                                        new_8: new_chart[7],
                                                        new_9: new_chart[8],
                                                        new_10: new_chart[9],
                                                        new_11: new_chart[10],
                                                        new_12: new_chart[11],
                                                        new_13: new_chart[12],
                                                        new_14: new_chart[13],
                                                        new_15: new_chart[14],
                                                        new_16: new_chart[15],
                                                        new_17: new_chart[16],
                                                        new_18: new_chart[17],
                                                        new_19: new_chart[18],
                                                        new_20: new_chart[19],
                                                        new_21: new_chart[20],
                                                        new_22: new_chart[21],
                                                        new_23: new_chart[22],
                                                        new_24: new_chart[23],
                                                        new_25: new_chart[24]
                                                    });
                                                }
                                                console.log(chart.data)
                                                    // else if (new_chart.length == 40) {
                                                    //     chart.addData({
                                                    //         data_timestamp: chart_timestamp,
                                                    //         new_1: new_chart[0],
                                                    //         new_2: new_chart[1],
                                                    //         new_3: new_chart[2],
                                                    //         new_4: new_chart[3],
                                                    //         new_5: new_chart[4],
                                                    //         new_6: new_chart[5],
                                                    //         new_7: new_chart[6],
                                                    //         new_8: new_chart[7],
                                                    //         new_9: new_chart[8],
                                                    //         new_10: new_chart[9],
                                                    //         new_11: new_chart[10],
                                                    //         new_12: new_chart[11],
                                                    //         new_13: new_chart[12],
                                                    //         new_14: new_chart[13],
                                                    //         new_15: new_chart[14],
                                                    //         new_16: new_chart[15],
                                                    //         new_17: new_chart[16],
                                                    //         new_18: new_chart[17],
                                                    //         new_19: new_chart[18],
                                                    //         new_20: new_chart[19],
                                                    //         new_21: new_chart[20],
                                                    //         new_22: new_chart[21],
                                                    //         new_23: new_chart[22],
                                                    //         new_24: new_chart[23],
                                                    //         new_25: new_chart[24],
                                                    //         new_26: new_chart[25],
                                                    //         new_27: new_chart[26],
                                                    //         new_28: new_chart[27],
                                                    //         new_29: new_chart[28],
                                                    //         new_30: new_chart[29],
                                                    //         new_31: new_chart[30],
                                                    //         new_32: new_chart[31],
                                                    //         new_33: new_chart[32],
                                                    //         new_34: new_chart[33],
                                                    //         new_35: new_chart[34],
                                                    //         new_36: new_chart[35],
                                                    //         new_37: new_chart[36],
                                                    //         new_38: new_chart[37],
                                                    //         new_39: new_chart[38],
                                                    //         new_40: new_chart[39]
                                                    //     });
                                                    // }
                                            }
                                            // control
                                            if (house_master !== "KMUMT001") {
                                                if (message.destinationName == house_master + "/1/control/json_control_filter") {
                                                    // alert(count_stcont)
                                                    // return false;
                                                    if (count_stcont !== 0) {
                                                        var result = message.payloadString;
                                                        var parseJSON = $.parseJSON(result);
                                                        var data_array = parseJSON.control_status;
                                                        console.log(parseJSON);

                                                        if (data_array.Mode === "Auto") { //Auto
                                                            $(".sw_mode_Manual").removeClass("active");
                                                            $(".sw_mode_Auto").addClass("active");
                                                            $(".sw_manual").hide();
                                                            $(".sw_auto").show();
                                                        } else if (data_array.Mode === "Manual") {
                                                            $(".sw_mode_Auto").removeClass("active");
                                                            $(".sw_mode_Manual").addClass("active");
                                                            $(".sw_manual").show();
                                                            $(".sw_auto").hide();
                                                        }
                                                        // alert(imgCon['drip_1'][1])
                                                        // dripper_1
                                                        if (controlStatus[1] == 1) {
                                                            if (data_array.dripper_1 === "OFF") {
                                                                $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][1]);
                                                                $(".sw_manual_1").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][0]);
                                                                $(".sw_manual_1").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_1", c_dash = data_array.dripper_1, c_img_off = imgCon['drip_1'][1], c_img_on = imgCon['drip_1'][0], ch = '1');
                                                        }

                                                        // dripper_2
                                                        if (controlStatus[2] == 1) {
                                                            if (data_array.dripper_2 === "OFF") {
                                                                $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][1]);
                                                                $(".sw_manual_2").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][0]);
                                                                $(".sw_manual_2").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_2", c_dash = data_array.dripper_2, c_img_off = imgCon['drip_2'][1], c_img_on = imgCon['drip_2'][0], ch = '2');
                                                        }
                                                        // dripper_3
                                                        if (controlStatus[3] == 1) {
                                                            if (data_array.dripper_3 === "OFF") {
                                                                $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][1]);
                                                                $(".sw_manual_3").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][0]);
                                                                $(".sw_manual_3").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_3", c_dash = data_array.dripper_3, c_img_off = imgCon['drip_3'][1], c_img_on = imgCon['drip_3'][0], ch = '3');
                                                        }
                                                        // dripper_4
                                                        if (controlStatus[4] == 1) {
                                                            if (data_array.dripper_4 === "OFF") {
                                                                $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][1]);
                                                                $(".sw_manual_4").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][0]);
                                                                $(".sw_manual_4").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_4", c_dash = data_array.dripper_4, c_img_off = imgCon['drip_4'][1], c_img_on = imgCon['drip_4'][0], ch = '4');
                                                        }
                                                        // dripper_5
                                                        if (controlStatus[5] == 1) {
                                                            if (data_array.dripper_5 === "OFF") {
                                                                $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][1]);
                                                                $(".sw_manual_5").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][0]);
                                                                $(".sw_manual_5").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_5", c_dash = data_array.dripper_5, c_img_off = imgCon['drip_5'][1], c_img_on = imgCon['drip_5'][0], ch = '5');
                                                        }
                                                        // dripper_6
                                                        if (controlStatus[6] == 1) {
                                                            if (data_array.dripper_6 === "OFF") {
                                                                $(".dash_img_con_6").attr("src", "public/images/control/" + imgCon['drip_6'][1]);
                                                                $(".sw_manual_6").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_6").attr("src", "public/images/control/" + imgCon['drip_6'][0]);
                                                                $(".sw_manual_6").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_6", c_dash = data_array.dripper_6, c_img_off = imgCon['drip_6'][1], c_img_on = imgCon['drip_6'][0], ch = '6');
                                                        }
                                                        // dripper_7
                                                        if (controlStatus[7] == 1) {
                                                            if (data_array.dripper_7 === "OFF") {
                                                                $(".dash_img_con_7").attr("src", "public/images/control/" + imgCon['drip_7'][1]);
                                                                $(".sw_manual_7").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_7").attr("src", "public/images/control/" + imgCon['drip_7'][0]);
                                                                $(".sw_manual_7").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_7", c_dash = data_array.dripper_7, c_img_off = imgCon['drip_7'][1], c_img_on = imgCon['drip_7'][0], ch = '7');
                                                        }
                                                        // dripper_8
                                                        if (controlStatus[8] == 1) {
                                                            if (data_array.dripper_8 === "OFF") {
                                                                $(".dash_img_con_8").attr("src", "public/images/control/" + imgCon['drip_8'][1]);
                                                                $(".sw_manual_8").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_8").attr("src", "public/images/control/" + imgCon['drip_8'][0]);
                                                                $(".sw_manual_8").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_8", c_dash = data_array.dripper_8, c_img_off = imgCon['drip_8'][1], c_img_on = imgCon['drip_8'][0], ch = '8');
                                                        }
                                                        // foggy
                                                        if (controlStatus[9] == 1) {
                                                            if (data_array.foggy === "OFF") {
                                                                $(".dash_img_con_9").attr("src", "public/images/control/" + imgCon['foggy'][1]);
                                                                $(".sw_manual_9").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_9").attr("src", "public/images/control/" + imgCon['foggy'][0]);
                                                                $(".sw_manual_9").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_9", c_dash = data_array.foggy, c_img_off = imgCon['foggy'][1], c_img_on = imgCon['foggy'][0], ch = '9');
                                                        }
                                                        // fan
                                                        if (controlStatus[10] == 1) {
                                                            if (data_array.fan === "OFF") {
                                                                $(".dash_img_con_10").attr("src", "public/images/control/" + imgCon['fan'][1]);
                                                                $(".sw_manual_10").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_10").attr("src", "public/images/control/" + imgCon['fan'][0]);
                                                                $(".sw_manual_10").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_10", c_dash = data_array.fan, c_img_off = imgCon['fan'][1], c_img_on = imgCon['fan'][1], ch = '10');
                                                        }

                                                        //Slan
                                                        if (controlStatus[11] == 1) {
                                                            if (data_array.shader === "0") {
                                                                $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][0], ch = '11');
                                                            } else if (data_array.shader === "1") {
                                                                $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][1], ch = '11');
                                                            } else if (data_array.shader === "2") {
                                                                $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][2], ch = '11');
                                                            } else if (data_array.shader === "3") {
                                                                $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][3], ch = '11');
                                                            } else if (data_array.shader === "4") {
                                                                $(".dash_img_con_11").attr("src", "public/images/control/" + imgCon['shader'][4], ch = '11');
                                                            }

                                                            // modal_manual
                                                            if (data_array["shader"] == 0) {
                                                                var shader_slw = "0 : ปิด 100%";
                                                                $(".sw_shader0").addClass("active");
                                                                $(".sw_shader1").removeClass("active");
                                                                $(".sw_shader2").removeClass("active");
                                                                $(".sw_shader3").removeClass("active");
                                                                $(".sw_shader4").removeClass("active");
                                                            }
                                                            if (data_array["shader"] == 1) {
                                                                var shader_slw = "1 : เปิด 25%";
                                                                $(".sw_shader0").removeClass("active");
                                                                $(".sw_shader1").addClass("active");
                                                                $(".sw_shader2").removeClass("active");
                                                                $(".sw_shader3").removeClass("active");
                                                                $(".sw_shader4").removeClass("active");
                                                            }
                                                            if (data_array["shader"] == 2) {
                                                                var shader_slw = "2 : เปิด 50%";
                                                                $(".sw_shader0").removeClass("active");
                                                                $(".sw_shader1").removeClass("active");
                                                                $(".sw_shader2").addClass("active");
                                                                $(".sw_shader3").removeClass("active");
                                                                $(".sw_shader4").removeClass("active");
                                                            }
                                                            if (data_array["shader"] == 3) {
                                                                var shader_slw = "3 : เปิด 75%";
                                                                $(".sw_shader0").removeClass("active");
                                                                $(".sw_shader1").removeClass("active");
                                                                $(".sw_shader2").removeClass("active");
                                                                $(".sw_shader3").addClass("active");
                                                                $(".sw_shader4").removeClass("active");
                                                            }
                                                            if (data_array["shader"] == 4) {
                                                                var shader_slw = "4 : เปิด 100%";
                                                                $(".sw_shader0").removeClass("active");
                                                                $(".sw_shader1").removeClass("active");
                                                                $(".sw_shader2").removeClass("active");
                                                                $(".sw_shader3").removeClass("active");
                                                                $(".sw_shader4").addClass("active");
                                                            }
                                                            $(".shader_slw").html(shader_slw);
                                                        } else {
                                                            $(".dash_c11").hide();
                                                        }

                                                        // fertilizer
                                                        if (controlStatus[12] == 1) {
                                                            if (data_array.fertilizer === "OFF") {
                                                                $(".dash_img_con_12").attr("src", "public/images/control/" + imgCon['fertilizer'][1]);
                                                                $(".sw_manual_12").bootstrapToggle('off');
                                                            } else {
                                                                $(".dash_img_con_12").attr("src", "public/images/control/" + imgCon['fertilizer'][0]);
                                                                $(".sw_manual_12").bootstrapToggle('on');
                                                            }
                                                            // cont_dash_show(img_c = "dash_img_con_12", c_dash = data_array.fertilizer, c_img_off = imgCon['fertilizer'][1], c_img_on = imgCon['fertilizer'][0], ch = '12');
                                                        }

                                                        function cont_dash_show(img_c, c_dash, c_img_off, c_img_on, ch) {
                                                            console.log(c_dash)
                                                            if (c_dash === "OFF") {
                                                                $("." + img_c).attr("src", "public/images/control/" + c_img_off);
                                                                $(".sw_manual_" + ch).bootstrapToggle('on');
                                                            } else if (c_dash === "ON") {
                                                                $("." + img_c).attr("src", "public/images/control/" + c_img_on);
                                                                $(".sw_manual_1").bootstrapToggle('on');
                                                            }
                                                        }
                                                    }
                                                }
                                            } else { // KMUMT001
                                                // mode_Auto_Manual
                                                if (message.destinationName == "KMUMT001/1/control/mode") {
                                                    var cont_status = message.payloadString;
                                                    if (cont_status === "on") { //Auto
                                                        $(".sw_mode_Manual").removeClass("active");
                                                        $(".sw_mode_Auto").addClass("active");
                                                        $(".sw_manual").hide();
                                                        $(".sw_auto").show();
                                                    } else {
                                                        $(".sw_mode_Auto").removeClass("active");
                                                        $(".sw_mode_Manual").addClass("active");
                                                        $(".sw_manual").show();
                                                        $(".sw_auto").hide();
                                                    }
                                                }
                                                // mode_Control_1
                                                if (controlStatus[1] == 1) {
                                                    if (message.destinationName == "KMUMT001/1/control/control_st_1") {
                                                        var cont_status = message.payloadString;
                                                        if (cont_status === "off") {
                                                            $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][1]);
                                                            $(".sw_manual_1").bootstrapToggle('off');
                                                        } else {
                                                            $(".dash_img_con_1").attr("src", "public/images/control/" + imgCon['drip_1'][0]);
                                                            $(".sw_manual_1").bootstrapToggle('on');
                                                        }
                                                    }
                                                }

                                                // mode_Control_2
                                                if (controlStatus[2] == 1) {
                                                    if (message.destinationName == "KMUMT001/1/control/control_st_2") {
                                                        var cont_status = message.payloadString;
                                                        if (cont_status === "off") {
                                                            $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][1]);
                                                            $(".sw_manual_2").bootstrapToggle('off');
                                                        } else {
                                                            $(".dash_img_con_2").attr("src", "public/images/control/" + imgCon['drip_2'][0]);
                                                            $(".sw_manual_2").bootstrapToggle('on');
                                                        }
                                                    }
                                                }
                                                // mode_Control_3
                                                if (controlStatus[3] == 1) {
                                                    if (message.destinationName == "KMUMT001/1/control/control_st_3") {
                                                        var cont_status = message.payloadString;
                                                        if (cont_status === "off") {
                                                            $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][1]);
                                                            $(".sw_manual_3").bootstrapToggle('off');
                                                        } else {
                                                            $(".dash_img_con_3").attr("src", "public/images/control/" + imgCon['drip_3'][0]);
                                                            $(".sw_manual_3").bootstrapToggle('on');
                                                        }
                                                    }
                                                }
                                                // mode_Control_4
                                                if (controlStatus[4] == 1) {
                                                    if (message.destinationName == "KMUMT001/1/control/control_st_4") {
                                                        var cont_status = message.payloadString;
                                                        if (cont_status === "off") {
                                                            $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][1]);
                                                            $(".sw_manual_4").bootstrapToggle('off');
                                                        } else {
                                                            $(".dash_img_con_4").attr("src", "public/images/control/" + imgCon['drip_4'][0]);
                                                            $(".sw_manual_4").bootstrapToggle('on');
                                                        }
                                                    }
                                                }

                                                // mode_Control_5
                                                if (controlStatus[5] == 1) {
                                                    if (message.destinationName == "KMUMT001/1/control/control_st_5") {
                                                        var cont_status = message.payloadString;
                                                        if (cont_status === "off") {
                                                            $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][1]);
                                                            $(".sw_manual_5").bootstrapToggle('off');
                                                        } else {
                                                            $(".dash_img_con_5").attr("src", "public/images/control/" + imgCon['drip_5'][0]);
                                                            $(".sw_manual_5").bootstrapToggle('on');
                                                        }
                                                    }
                                                }
                                            }
                                        } // exit_message
                                        connect();
                                        // ------zz
                                    });
                                }
                                $(".btn_ch_t").click(function() {
                                    chack_realtime();
                                });
                                $(".btn_ch_h").click(function() {
                                    chack_realtime();
                                });
                                $(".btn_ch_s").click(function() {
                                    chack_realtime();
                                });
                                $(".btn_ch_l").click(function() {
                                    chack_realtime();
                                });
                                // ----------------------------------------------------------------------


                                loadingOut(loading);
                            }
                        });

                        // Report ------------------
                        // $(".memu_report").click(function() {
                        $(".te_st").html(res.s_master.site_name);
                        $(".te_ht").html(res.s_master.house_name);
                        $.ajax({
                            url: "views/report_sensor.php",
                            method: "post",
                            data: {
                                house_master: house_master,
                                dashStatus: res.dashStatus,
                                dashName: res.dashName,
                                dashSncanel: res.dashSncanel,
                                dashMode: res.dashMode,
                                dashUnit: res.dashUnit
                            },
                            // dataType: "json",
                            success: function(resp) {
                                $("#report_sensor").html(resp);
                            }
                        });

                        // var countStatus_con = countElement(1, controlstatus);

                        // function countElement(item, array) {
                        //     var count = 0;
                        //     $.each(array, function(i, v) {
                        //         if (v === item) count++;
                        //     });
                        //     return count;
                        // }
                        if (count_stcont == 0) {
                            $(".r_reControl").hide();
                            $(".r_reAutoControl").hide();
                        } else {
                            $(".r_reControl").show();
                            $(".r_reAutoControl").show();

                            // $(".r_reControl").click(function() {
                            $.ajax({
                                url: "views/report_control.php",
                                method: "post",
                                data: {
                                    house_master: house_master,
                                    controlstatus: JSON.stringify(res.controlstatus),
                                    conttrolname: JSON.stringify(res.conttrolname)
                                },
                                // dataType: "json",
                                success: function(resp) {
                                    $("#report_control").html(resp);
                                }
                            });
                            // });
                            if (house_master !== "KMUMT001") {
                                $.ajax({
                                    url: "views/report_controlAuto.php",
                                    method: "post",
                                    data: {
                                        house_master: house_master,
                                        controlstatus: res.controlstatus,
                                        conttrolname: res.conttrolname
                                    },
                                    // dataType: "json",
                                    success: function(resp) {
                                        $("#report_controlAuto").html(resp);
                                    }
                                });
                            } else {
                                $(".r_reAutoControl").click(function() {
                                    setTimeout(function() {
                                        $.ajax({
                                            url: "views/report_controlAuto.php",
                                            method: "post",
                                            data: {
                                                house_master: house_master,
                                                controlstatus: res.controlstatus,
                                                conttrolname: res.conttrolname
                                            },
                                            // dataType: "json",
                                            success: function(resp) {
                                                $("#report_controlAuto").html(resp);
                                            }
                                        });

                                    }, 1000);
                                });
                            }
                        }
                        // });

                    }
                });
            } // V3
            else if (url[0] == 4) {
                // = มธ.
                $.ajax({
                    url: "routes/tu/get_config.php",
                    method: "post",
                    data: {
                        house_master: house_master
                    },
                    dataType: "json",
                    success: function(res) {
                        // console.log(res);
                        var config_sn = res.config_sn;
                        var config_cn = res.config_cn;
                        var set_maxmin = res.set_maxmin;
                        var sensor = res.sensor;
                        var data_temp_out = [];
                        var data_temp_in = [];
                        var data_hum_out = [];
                        var data_hum_in = [];
                        var data_light_out = [];
                        var data_light_in = [];
                        var data_soil_in = [];
                        var eq = res.s_master.house_eq;
                        // alert(eq)
                        if(config_cn.cn_status_1 == 1 || config_cn.cn_status_2 == 1 || config_cn.cn_status_3 == 1 || config_cn.cn_status_4 == 1){
                            $('.hidden_select_sw_manual').val(1);
                        }else if(config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 || config_cn.cn_status_5 == 1 || config_cn.cn_status_6 == 1 || config_cn.cn_status_7 == 1 || config_cn.cn_status_8 == 1){
                            $('.hidden_select_sw_manual').val(2)
                        }else if(config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 || config_cn.cn_status_9 == 1 ||
                            config_cn.cn_status_10 == 1){
                            $('.hidden_select_sw_manual').val(3)
                        }else if(config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 0 &&
                            config_cn.cn_status_10 == 0 || config_cn.cn_status_11 == 1){
                            $('.hidden_select_sw_manual').val(4)
                        }else if(config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 0 &&
                            config_cn.cn_status_10 == 0 && config_cn.cn_status_11 == 0 || config_cn.cn_status_12 == 1){
                            $('.hidden_select_sw_manual').val(5)
                        }
                        // -------------------------------------
                        if(config_cn.cn_status_1 == 1){
                            $('.hidden_select_sw_auto').val(1);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 1) {
                            $('.hidden_select_sw_auto').val(2);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 1) {
                            $('.hidden_select_sw_auto').val(3);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 1) {
                            $('.hidden_select_sw_auto').val(4);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 1) {
                            $('.hidden_select_sw_auto').val(5);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 1) {
                            $('.hidden_select_sw_auto').val(6);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 1) {
                            $('.hidden_select_sw_auto').val(7);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 1) {
                            $('.hidden_select_sw_auto').val(8);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 1) {
                            $('.hidden_select_sw_auto').val(9);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 0 &&
                            config_cn.cn_status_10 == 1) {
                            $('.hidden_select_sw_auto').val(10);
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 0 &&
                            config_cn.cn_status_10 == 0 && config_cn.cn_status_11 == 1) {
                            $('.hidden_select_sw_auto').val(11); //$("#11").addClass('active');
                        }else if (config_cn.cn_status_1 == 0 && config_cn.cn_status_2 == 0 && config_cn.cn_status_3 == 0 && config_cn.cn_status_4 == 0 && config_cn.cn_status_5 == 0 && config_cn.cn_status_6 == 0 && config_cn.cn_status_7 == 0 && config_cn.cn_status_8 == 0 && config_cn.cn_status_9 == 0 &&
                            config_cn.cn_status_10 == 0 && config_cn.cn_status_11 == 0 && config_cn.cn_status_12 == 1) {
                            $('.hidden_select_sw_auto').val(12);
                        }

                        var temp_c = [], hum_c = [], light_c = [], soil_c = [];
                        for (var i = 1; i <= 7; i++) {
                            if (res.config_sn['sn_sensor_' + i] == 1) {
                                temp_c.push(1);
                            } else if (res.config_sn['sn_sensor_' + i] == 2) {
                                hum_c.push(1);
                            } else if (res.config_sn['sn_sensor_' + i] == 3) {
                                soil_c.push(1);
                            } else {
                                light_c.push(1);
                            }
                        }
                        check_menu_control();
                        function check_menu_control(){
                            // alert(res.userLevel)
                            if(res.userLevel <= 3){
                                if(getArraySum(res.controlstatus) > 0){
                                    $('.memu_control').show()
                                }else {
                                    $('.memu_control').hide()
                                }
                            }else {
                                $('.memu_control').hide()
                            }
                        }
                        $(".memu_dash").click(function() {
                            check_menu_control();
                        });
                        $(".memu_dash").show().addClass("mm-active");

                        if(res.userLevel > 2){
                            // alert(res.userLevel)
                            $(".memu_report").hide();
                        }else {
                            $(".memu_report").show();
                        }
                        $(".memu_compare").hide();
                        $('#load_pages_dashboard').show();
                        var s_sensor = {
                            s_btnT: getArraySum(temp_c),
                            s_btnH: getArraySum(hum_c),
                            s_btnS: getArraySum(soil_c),
                            s_btnL: getArraySum(light_c)
                        };
                        $.ajax({
                            url: "routes/tu/pages_dashboard.php",
                            method: "post",
                            data: {
                                data: res,
                                s_sensor: s_sensor,
                                count_cn: getArraySum(res.controlstatus)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages").html(res_dash);
                                // Global variables
                                var client = null;
                                // These are configs
                                // var hostname = 'mqtt.deccbigdata.ml:2096'
                                // var port = '2096'
                                var hostname = "203.150.37.144"; //'103.2.115.15'; // 203.150.37.144   decccloud.com
                                var port = "8083";
                                var clientId = "mqtt_js_3074" + parseInt(Math.random() * 100000, 10);

                                // return false
                                function connect() {
                                    client = new Paho.MQTT.Client(hostname, Number(port), '/mqtt', clientId);
                                    // console.info('Connecting to Server: Hostname: ', hostname, '. Port: ', port, '. Client ID: ', clientId);

                                    client.onConnectionLost = onConnectionLost;
                                    client.onMessageArrived = onMessageArrived;
                                    // client.tls_set(ca_certs='public/plugins/mqtt_plugin/key/ca1.pem', certfile='public/plugins/mqtt_plugin/key/cert1.pem', keyfile='public/plugins/mqtt_plugin/key/key1.pem')

                                    var options = {
                                        onSuccess: onConnect, // after connected, subscribes
                                        onFailure: onFail, // useful for logging / debugging
                                        // useSSL: true
                                    };
                                    // connect the client
                                    client.connect(options);
                                    console.info('Connecting...');
                                }
                                // ---------------------------------------------------------------------------------------
                                function onConnect(context) {
                                    console.log("Client Connected");
                                    // And subscribe to our topics	-- both with the same callback function
                                    options = {
                                        qos: 1,
                                        onSuccess: function (context) {
                                            // console.log("ไม่สามารถเชื่อมต่อกับ เครื่อง ได้ !!!!");
                                            // setInterval(function() {
                                            //     location.reload();
                                            // }, 30000);
                                            console.log("subscribed");
                                        }
                                    }
                                    // client.subscribe(house_master + "/control/config/manual", options);
                                    client.subscribe(house_master + "/control/set_config", options);
                                    if(eq == 0){
                                        client.subscribe(house_master + "/data_sensor/filter", options);
                                    }else {
                                        client.subscribe(house_master + "/data_sensor/filter_eq", options);
                                    }
                                    client.subscribe(house_master + "/control/response", options);
                                    // client.subscribe(house_master + "/control/config/auto", options);
                                    client.subscribe("connect/status/"+house_master, options);
                                    client.subscribe("web_system", options);
                                    client.subscribe(house_master + "/control/loads/spanel", options);
                                }

                                function onFail(context) {
                                    location.reload();
                                }
                                var timeoutId = 0;
                                var timeoutId2 = 0;
                                function onConnectionLost(responseObject) {
                                    if (responseObject.errorCode !== 0) {
                                        console.log("Connection Lost: " + responseObject.errorMessage);
                                        connect();
                                        // location.reload();
                                        // window.alert("Someone else took my websocket!\nRefresh to take it back.");
                                    }
                                }
                                function onMessageArrived(message) {
                                    // if(message.destinationName ==  house_master + "/control/config/manual"){
                                    //     var result = message.payloadString;
                                    //     var n_result = result.split('\r\n')
                                    //     // var parseJSON = $.parseJSON(result);
                                    //     // console.log(n_result);
                                    //     $('#val_sw_manual').val(JSON.stringify({
                                    //       "dripper_1":  result.split('\r\n')[2].split('=')[1],
                                    //       "dripper_2":  result.split('\r\n')[3].split('=')[1],
                                    //       "dripper_3":  result.split('\r\n')[4].split('=')[1],
                                    //       "dripper_4":  result.split('\r\n')[5].split('=')[1],
                                    //       "fan_1":      result.split('\r\n')[6].split('=')[1],
                                    //       "fan_2":      result.split('\r\n')[7].split('=')[1],
                                    //       "fan_3":      result.split('\r\n')[8].split('=')[1],
                                    //       "fan_4":      result.split('\r\n')[9].split('=')[1],
                                    //       "foggy_1":    result.split('\r\n')[10].split('=')[1],
                                    //       "foggy_2":    result.split('\r\n')[11].split('=')[1]
                                    //     }));
                                    // }
                                    // else if(message.destinationName == house_master + "/control/config/auto"){
                                    //     var result = message.payloadString;
                                    //     var n_result = result.split('\r\n')
                                    //     // console.log(n_result);
                                    //     // return false;
                                    //     var SW_drip1 = []
                                    //     var SW_drip2 = []
                                    //     var SW_drip3 = []
                                    //     var SW_drip4 = []
                                    //     var SW_fan1 = []
                                    //     var SW_fan2 = []
                                    //     var SW_fan3 = []
                                    //     var SW_fan4 = []
                                    //     var SW_foggy1 = []
                                    //     var SW_foggy2 = []
                                    //     var SW_spray = []
                                    //     var SW_shading = []
                                    //     for(var i=1; i<=6; i++){
                                    //         // if(config_cn['cn_status_1'] == 1){
                                    //             if(n_result[i+(i-1)].split('=')[1] != '99:99' && n_result[i+1+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_drip1.push({ sw:1, s:n_result[i+(i-1)].split('=')[1], e:n_result[i+1+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_drip1.push({ sw:0, s:'', e:'' })
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_2'] == 1){
                                    //             if(n_result[i+13+(i-1)].split('=')[1] != '99:99' && n_result[i+14+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_drip2.push({ sw:1, s:n_result[i+13+(i-1)].split('=')[1], e:n_result[i+14+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_drip2.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_3'] == 1){
                                    //             if(n_result[i+26+(i-1)].split('=')[1] != '99:99' && n_result[i+27+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_drip3.push({ sw:1, s:n_result[i+26+(i-1)].split('=')[1], e:n_result[i+27+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_drip3.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_4'] == 1){
                                    //             if(n_result[i+39+(i-1)].split('=')[1] != '99:99' && n_result[i+40+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_drip4.push({ sw:1, s:n_result[i+39+(i-1)].split('=')[1], e:n_result[i+40+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_drip4.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_5'] == 1){
                                    //             if(n_result[i+52+(i-1)].split('=')[1] != '99:99' && n_result[i+53+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_fan1.push({ sw:1, s:n_result[i+52+(i-1)].split('=')[1], e:n_result[i+53+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_fan1.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_6'] == 1){
                                    //             if(n_result[i+65+(i-1)].split('=')[1] != '99:99' && n_result[i+66+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_fan2.push({ sw:1, s:n_result[i+65+(i-1)].split('=')[1], e:n_result[i+66+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_fan2.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_7'] == 1){
                                    //             if(n_result[i+78+(i-1)].split('=')[1] != '99:99' && n_result[i+79+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_fan3.push({ sw:1, s:n_result[i+78+(i-1)].split('=')[1], e:n_result[i+79+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_fan3.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_8'] == 1){
                                    //             if(n_result[i+91+(i-1)].split('=')[1] != '99:99' && n_result[i+92+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_fan4.push({ sw:1, s:n_result[i+91+(i-1)].split('=')[1], e:n_result[i+92+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_fan4.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_9'] == 1){
                                    //             if(n_result[i+104+(i-1)].split('=')[1] != '99:99' && n_result[i+105+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_foggy1.push({ sw:1, s:n_result[i+104+(i-1)].split('=')[1], e:n_result[i+105+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_foggy1.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_10'] == 1){
                                    //             if(n_result[i+117+(i-1)].split('=')[1] != '99:99' && n_result[i+118+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_foggy2.push({ sw:1, s:n_result[i+117+(i-1)].split('=')[1], e:n_result[i+118+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_foggy2.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_11'] == 1){
                                    //             if(n_result[i+130+(i-1)].split('=')[1] != '99:99' && n_result[i+131+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_spray.push({ sw:1, s:n_result[i+130+(i-1)].split('=')[1], e:n_result[i+131+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_spray.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //         // if(config_cn['cn_status_12'] == 1){
                                    //             if(n_result[i+143+(i-1)].split('=')[1] != '99:99' && n_result[i+144+(i-1)].split('=')[1] != '99:99'){
                                    //                 SW_shading.push({ sw:1, s:n_result[i+143+(i-1)].split('=')[1], e:n_result[i+144+(i-1)].split('=')[1] });
                                    //             }else {
                                    //                 SW_shading.push({ sw:0, s:'', e:'' });
                                    //             }
                                    //         // }
                                    //     }
                                    //     // console.log(SW_spray);
                                    //     // return false
                                    //     var data_auto = {};
                                    //     // if(config_cn['cn_status_1'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_1':{
                                    //                 'load_st_1':SW_drip1[0].sw,
                                    //                 'load_st_2':SW_drip1[1].sw,
                                    //                 'load_st_3':SW_drip1[2].sw,
                                    //                 'load_st_4':SW_drip1[3].sw,
                                    //                 'load_st_5':SW_drip1[4].sw,
                                    //                 'load_st_6':SW_drip1[5].sw,
                                    //                 'load_s_1':SW_drip1[0].s,
                                    //                 'load_s_2':SW_drip1[1].s,
                                    //                 'load_s_3':SW_drip1[2].s,
                                    //                 'load_s_4':SW_drip1[3].s,
                                    //                 'load_s_5':SW_drip1[4].s,
                                    //                 'load_s_6':SW_drip1[5].s,
                                    //                 'load_e_1':SW_drip1[0].e,
                                    //                 'load_e_2':SW_drip1[1].e,
                                    //                 'load_e_3':SW_drip1[2].e,
                                    //                 'load_e_4':SW_drip1[3].e,
                                    //                 'load_e_5':SW_drip1[4].e,
                                    //                 'load_e_6':SW_drip1[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_2'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_2':{
                                    //                 'load_st_1':SW_drip2[0].sw,
                                    //                 'load_st_2':SW_drip2[1].sw,
                                    //                 'load_st_3':SW_drip2[2].sw,
                                    //                 'load_st_4':SW_drip2[3].sw,
                                    //                 'load_st_5':SW_drip2[4].sw,
                                    //                 'load_st_6':SW_drip2[5].sw,
                                    //                 'load_s_1':SW_drip2[0].s,
                                    //                 'load_s_2':SW_drip2[1].s,
                                    //                 'load_s_3':SW_drip2[2].s,
                                    //                 'load_s_4':SW_drip2[3].s,
                                    //                 'load_s_5':SW_drip2[4].s,
                                    //                 'load_s_6':SW_drip2[5].s,
                                    //                 'load_e_1':SW_drip2[0].e,
                                    //                 'load_e_2':SW_drip2[1].e,
                                    //                 'load_e_3':SW_drip2[2].e,
                                    //                 'load_e_4':SW_drip2[3].e,
                                    //                 'load_e_5':SW_drip2[4].e,
                                    //                 'load_e_6':SW_drip2[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_3'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_3':{
                                    //                 'load_st_1':SW_drip3[0].sw,
                                    //                 'load_st_2':SW_drip3[1].sw,
                                    //                 'load_st_3':SW_drip3[2].sw,
                                    //                 'load_st_4':SW_drip3[3].sw,
                                    //                 'load_st_5':SW_drip3[4].sw,
                                    //                 'load_st_6':SW_drip3[5].sw,
                                    //                 'load_s_1':SW_drip3[0].s,
                                    //                 'load_s_2':SW_drip3[1].s,
                                    //                 'load_s_3':SW_drip3[2].s,
                                    //                 'load_s_4':SW_drip3[3].s,
                                    //                 'load_s_5':SW_drip3[4].s,
                                    //                 'load_s_6':SW_drip3[5].s,
                                    //                 'load_e_1':SW_drip3[0].e,
                                    //                 'load_e_2':SW_drip3[1].e,
                                    //                 'load_e_3':SW_drip3[2].e,
                                    //                 'load_e_4':SW_drip3[3].e,
                                    //                 'load_e_5':SW_drip3[4].e,
                                    //                 'load_e_6':SW_drip3[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_4'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_4':{
                                    //                 'load_st_1':SW_drip4[0].sw,
                                    //                 'load_st_2':SW_drip4[1].sw,
                                    //                 'load_st_3':SW_drip4[2].sw,
                                    //                 'load_st_4':SW_drip4[3].sw,
                                    //                 'load_st_5':SW_drip4[4].sw,
                                    //                 'load_st_6':SW_drip4[5].sw,
                                    //                 'load_s_1':SW_drip4[0].s,
                                    //                 'load_s_2':SW_drip4[1].s,
                                    //                 'load_s_3':SW_drip4[2].s,
                                    //                 'load_s_4':SW_drip4[3].s,
                                    //                 'load_s_5':SW_drip4[4].s,
                                    //                 'load_s_6':SW_drip4[5].s,
                                    //                 'load_e_1':SW_drip4[0].e,
                                    //                 'load_e_2':SW_drip4[1].e,
                                    //                 'load_e_3':SW_drip4[2].e,
                                    //                 'load_e_4':SW_drip4[3].e,
                                    //                 'load_e_5':SW_drip4[4].e,
                                    //                 'load_e_6':SW_drip4[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_5'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_5':{
                                    //                 'load_st_1':SW_fan1[0].sw,
                                    //                 'load_st_2':SW_fan1[1].sw,
                                    //                 'load_st_3':SW_fan1[2].sw,
                                    //                 'load_st_4':SW_fan1[3].sw,
                                    //                 'load_st_5':SW_fan1[4].sw,
                                    //                 'load_st_6':SW_fan1[5].sw,
                                    //                 'load_s_1':SW_fan1[0].s,
                                    //                 'load_s_2':SW_fan1[1].s,
                                    //                 'load_s_3':SW_fan1[2].s,
                                    //                 'load_s_4':SW_fan1[3].s,
                                    //                 'load_s_5':SW_fan1[4].s,
                                    //                 'load_s_6':SW_fan1[5].s,
                                    //                 'load_e_1':SW_fan1[0].e,
                                    //                 'load_e_2':SW_fan1[1].e,
                                    //                 'load_e_3':SW_fan1[2].e,
                                    //                 'load_e_4':SW_fan1[3].e,
                                    //                 'load_e_5':SW_fan1[4].e,
                                    //                 'load_e_6':SW_fan1[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_6'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_6':{
                                    //                 'load_st_1':SW_fan2[0].sw,
                                    //                 'load_st_2':SW_fan2[1].sw,
                                    //                 'load_st_3':SW_fan2[2].sw,
                                    //                 'load_st_4':SW_fan2[3].sw,
                                    //                 'load_st_5':SW_fan2[4].sw,
                                    //                 'load_st_6':SW_fan2[5].sw,
                                    //                 'load_s_1':SW_fan2[0].s,
                                    //                 'load_s_2':SW_fan2[1].s,
                                    //                 'load_s_3':SW_fan2[2].s,
                                    //                 'load_s_4':SW_fan2[3].s,
                                    //                 'load_s_5':SW_fan2[4].s,
                                    //                 'load_s_6':SW_fan2[5].s,
                                    //                 'load_e_1':SW_fan2[0].e,
                                    //                 'load_e_2':SW_fan2[1].e,
                                    //                 'load_e_3':SW_fan2[2].e,
                                    //                 'load_e_4':SW_fan2[3].e,
                                    //                 'load_e_5':SW_fan2[4].e,
                                    //                 'load_e_6':SW_fan2[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_7'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_7':{
                                    //                 'load_st_1':SW_fan3[0].sw,
                                    //                 'load_st_2':SW_fan3[1].sw,
                                    //                 'load_st_3':SW_fan3[2].sw,
                                    //                 'load_st_4':SW_fan3[3].sw,
                                    //                 'load_st_5':SW_fan3[4].sw,
                                    //                 'load_st_6':SW_fan3[5].sw,
                                    //                 'load_s_1':SW_fan3[0].s,
                                    //                 'load_s_2':SW_fan3[1].s,
                                    //                 'load_s_3':SW_fan3[2].s,
                                    //                 'load_s_4':SW_fan3[3].s,
                                    //                 'load_s_5':SW_fan3[4].s,
                                    //                 'load_s_6':SW_fan3[5].s,
                                    //                 'load_e_1':SW_fan3[0].e,
                                    //                 'load_e_2':SW_fan3[1].e,
                                    //                 'load_e_3':SW_fan3[2].e,
                                    //                 'load_e_4':SW_fan3[3].e,
                                    //                 'load_e_5':SW_fan3[4].e,
                                    //                 'load_e_6':SW_fan3[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_8'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_8':{
                                    //                 'load_st_1':SW_fan4[0].sw,
                                    //                 'load_st_2':SW_fan4[1].sw,
                                    //                 'load_st_3':SW_fan4[2].sw,
                                    //                 'load_st_4':SW_fan4[3].sw,
                                    //                 'load_st_5':SW_fan4[4].sw,
                                    //                 'load_st_6':SW_fan4[5].sw,
                                    //                 'load_s_1':SW_fan4[0].s,
                                    //                 'load_s_2':SW_fan4[1].s,
                                    //                 'load_s_3':SW_fan4[2].s,
                                    //                 'load_s_4':SW_fan4[3].s,
                                    //                 'load_s_5':SW_fan4[4].s,
                                    //                 'load_s_6':SW_fan4[5].s,
                                    //                 'load_e_1':SW_fan4[0].e,
                                    //                 'load_e_2':SW_fan4[1].e,
                                    //                 'load_e_3':SW_fan4[2].e,
                                    //                 'load_e_4':SW_fan4[3].e,
                                    //                 'load_e_5':SW_fan4[4].e,
                                    //                 'load_e_6':SW_fan4[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_9'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_9':{
                                    //                 'load_st_1':SW_foggy1[0].sw,
                                    //                 'load_st_2':SW_foggy1[1].sw,
                                    //                 'load_st_3':SW_foggy1[2].sw,
                                    //                 'load_st_4':SW_foggy1[3].sw,
                                    //                 'load_st_5':SW_foggy1[4].sw,
                                    //                 'load_st_6':SW_foggy1[5].sw,
                                    //                 'load_s_1':SW_foggy1[0].s,
                                    //                 'load_s_2':SW_foggy1[1].s,
                                    //                 'load_s_3':SW_foggy1[2].s,
                                    //                 'load_s_4':SW_foggy1[3].s,
                                    //                 'load_s_5':SW_foggy1[4].s,
                                    //                 'load_s_6':SW_foggy1[5].s,
                                    //                 'load_e_1':SW_foggy1[0].e,
                                    //                 'load_e_2':SW_foggy1[1].e,
                                    //                 'load_e_3':SW_foggy1[2].e,
                                    //                 'load_e_4':SW_foggy1[3].e,
                                    //                 'load_e_5':SW_foggy1[4].e,
                                    //                 'load_e_6':SW_foggy1[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_10'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_10':{
                                    //                 'load_st_1':SW_foggy2[0].sw,
                                    //                 'load_st_2':SW_foggy2[1].sw,
                                    //                 'load_st_3':SW_foggy2[2].sw,
                                    //                 'load_st_4':SW_foggy2[3].sw,
                                    //                 'load_st_5':SW_foggy2[4].sw,
                                    //                 'load_st_6':SW_foggy2[5].sw,
                                    //                 'load_s_1':SW_foggy2[0].s,
                                    //                 'load_s_2':SW_foggy2[1].s,
                                    //                 'load_s_3':SW_foggy2[2].s,
                                    //                 'load_s_4':SW_foggy2[3].s,
                                    //                 'load_s_5':SW_foggy2[4].s,
                                    //                 'load_s_6':SW_foggy2[5].s,
                                    //                 'load_e_1':SW_foggy2[0].e,
                                    //                 'load_e_2':SW_foggy2[1].e,
                                    //                 'load_e_3':SW_foggy2[2].e,
                                    //                 'load_e_4':SW_foggy2[3].e,
                                    //                 'load_e_5':SW_foggy2[4].e,
                                    //                 'load_e_6':SW_foggy2[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_11'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_11':{
                                    //                 'load_st_1':SW_spray[0].sw,
                                    //                 'load_st_2':SW_spray[1].sw,
                                    //                 'load_st_3':SW_spray[2].sw,
                                    //                 'load_st_4':SW_spray[3].sw,
                                    //                 'load_st_5':SW_spray[4].sw,
                                    //                 'load_st_6':SW_spray[5].sw,
                                    //                 'load_s_1':SW_spray[0].s,
                                    //                 'load_s_2':SW_spray[1].s,
                                    //                 'load_s_3':SW_spray[2].s,
                                    //                 'load_s_4':SW_spray[3].s,
                                    //                 'load_s_5':SW_spray[4].s,
                                    //                 'load_s_6':SW_spray[5].s,
                                    //                 'load_e_1':SW_spray[0].e,
                                    //                 'load_e_2':SW_spray[1].e,
                                    //                 'load_e_3':SW_spray[2].e,
                                    //                 'load_e_4':SW_spray[3].e,
                                    //                 'load_e_5':SW_spray[4].e,
                                    //                 'load_e_6':SW_spray[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // if(config_cn['cn_status_12'] == 1){
                                    //         $.extend(data_auto, {
                                    //             'load_12':{
                                    //                 'load_st_1':SW_shading[0].sw,
                                    //                 'load_st_2':SW_shading[1].sw,
                                    //                 'load_st_3':SW_shading[2].sw,
                                    //                 'load_st_4':SW_shading[3].sw,
                                    //                 'load_st_5':SW_shading[4].sw,
                                    //                 'load_st_6':SW_shading[5].sw,
                                    //                 'load_s_1':SW_shading[0].s,
                                    //                 'load_s_2':SW_shading[1].s,
                                    //                 'load_s_3':SW_shading[2].s,
                                    //                 'load_s_4':SW_shading[3].s,
                                    //                 'load_s_5':SW_shading[4].s,
                                    //                 'load_s_6':SW_shading[5].s,
                                    //                 'load_e_1':SW_shading[0].e,
                                    //                 'load_e_2':SW_shading[1].e,
                                    //                 'load_e_3':SW_shading[2].e,
                                    //                 'load_e_4':SW_shading[3].e,
                                    //                 'load_e_5':SW_shading[4].e,
                                    //                 'load_e_6':SW_shading[5].e
                                    //             }
                                    //         });
                                    //     // }
                                    //     // console.log(data_auto);
                                    //     // console.log(JSON.stringify(data_auto) );
                                    //     $('#val_sw_auto_time_set').val(JSON.stringify(data_auto));
                                    //     // console.log($('#val_sw_auto_time_set').val());
                                    // }
                                    if(message.destinationName == house_master + "/control/set_config") {
                                        var result = message.payloadString;
                                        var parseJSON = $.parseJSON(result);
                                        $('#val_config').val(result);
                                        // console.log(parseJSON);
                                        if(parseJSON.mode != "Manual"){ // auto
                                            var sub_mode = parseJSON.sub_mode;
                                            // $('#val_sw_manual').val(JSON.stringify(parseJSON.config_manual));
                                            // $('#val_sw_auto_time_set').val(JSON.stringify(parseJSON.config_timeSet));
                                            // $('#val_sw_auto_time_loop').val(JSON.stringify(parseJSON.config_timeLoop))
                                            // console.log(parseJSON)
                                            // return false;
                                            if (sub_mode.sub_mode == 'Timer') {
                                                $('.sw_mode_tracking').removeClass('btn-info').addClass('btn-outline-info');
                                                $('.sw_mode_timer').addClass('btn-info').removeClass('btn-outline-info');
                                                $('.ul_sub_timer').show();
                                                $('.ul_sub_sensor').hide();

                                                // alert($('.hidden_select_sw_auto').val())
                                                if (sub_mode['sub_mode_'+$('.hidden_select_sw_auto').val()] == 'Time_set') {
                                                    $('.sw_mode_timeSet').addClass('btn-primary').removeClass('btn-outline-primary');
                                                    $('.sw_mode_timeLoop').removeClass('btn-primary').addClass('btn-outline-primary');
                                                    $('.ul_mode_timeSet').show();
                                                    $('.ul_mode_timeLoop').hide();
                                                    $('#view_auto').hide();
                                                }
                                                else {
                                                    $('.sw_mode_timeSet').removeClass('btn-primary').addClass('btn-outline-primary');
                                                    $('.sw_mode_timeLoop').addClass('btn-primary').removeClass('btn-outline-primary');
                                                    $('.ul_mode_timeSet').hide();
                                                    $('.ul_mode_timeLoop').show();
                                                    $('#view_auto').show();
                                                }
                                            }
                                            else { // Sensor_Tracking
                                                $('.sw_mode_tracking').addClass('btn-info').removeClass('btn-outline-info');
                                                $('.sw_mode_timer').removeClass('btn-info').addClass('btn-outline-info');
                                                $('.ul_sub_timer').hide();
                                                $('.ul_sub_sensor').show();
                                                $('#view_auto').hide();
                                                for (var i = 1; i <= 12; i++) {
                                                    if (i <= 4) {
                                                        if (parseJSON.config_tracking['dripper_' + i] === 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                        }
                                                    }
                                                    if (i > 4 && i <= 8) {
                                                        if (parseJSON.config_tracking['fan_' + (i - 4)] === 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                                        }
                                                    }
                                                    if(i == 10){
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    }
                                                }
                                            }
                                        }
                                        else {
                                            var parse_manual = parseJSON.config_manual;
                                            for (var i = 1; i <= 12; i++) {
                                                if (i <= 4) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parse_manual['dripper_' + i] == 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                        } else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                    }
                                                }
                                                if (i > 4 && i <= 8) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parse_manual['fan_' + (i - 4)] == 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                    }
                                                }
                                                if (i == 9 || i == 10) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parse_manual['foggy_' + (i - 8)] == 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    }
                                                }
                                            }
                                        }
                                        $(".img_sw").show();
                                        $('.input_tSet').prop('disabled', true);
                                        $('.input_tLoop').prop('disabled', true);
                                        $(".sw_toggle").hide();
                                        $(".menu_config_auto").show();
                                        $("#save_auto_cont").hide();
                                        $("#close_auto_cont").hide();
                                        $(".sw_mode_Auto").attr('disabled', false);
                                        $(".sw_mode_Manual").attr('disabled', false);
                                        $('.sw_mode_tracking').prop('disabled', false);
                                        $('.sw_mode_timer').prop('disabled', false);
                                        $('.sw_mode_timeSet').prop('disabled', true);
                                        $('.sw_mode_timeLoop').prop('disabled', true);
                                    }
                                    if(message.destinationName == "connect/status/"+house_master){
                                        var result = message.payloadString;
                                        if(result == 'online' ){
                                            $('.status_timeUpdate').html('ออนไลน์').removeClass('text-danger').addClass('text-success')
                                        }else {
                                            $('.status_timeUpdate').html('ออฟไลน์').removeClass('text-success').addClass('text-danger')
                                        }
                                        // var parseJSON = $.parseJSON(result);
                                        // var time_t = parseJSON['time'];
                                        // var ntime = time_t.substring(0, 5);
                                        // $(".time").html(ntime);
                                        // var data_ = parseJSON['data']
                                        // console.log(parseJSON);
                                        // alert(moment(new Date()).add(-5, 'minutes').format('YYYY-MM-DD HH:mm'));
                                        // if(timeoutId2 != 0){clearInterval(timeoutId2);}
                                        // timeoutId2 = setInterval(function() {
                                        //     // console.log( moment(new Date(parseJSON['date']+' '+parseJSON['time'])).format('YYYY-MM-DD HH:mm:ss') +' >= '+ moment(new Date()).add(-1, 'minutes').format('YYYY-MM-DD HH:mm:ss'))
                                        //     if(moment(new Date(parseJSON['date']+' '+parseJSON['time'])).format('YYYY-MM-DD HH:mm:ss') >= moment(new Date()).add(-1, 'minutes').format('YYYY-MM-DD HH:mm:ss') ){
                                        //         $('.status_timeUpdate').html('ออนไลน์').removeClass('text-danger').addClass('text-success')
                                        //         // console.log('a');
                                        //     }else {
                                        //         $('.status_timeUpdate').html('ออฟไลน์').removeClass('text-success').addClass('text-danger')
                                        //         // console.log('b');
                                        //     }
                                        // }, 1000);
                                    }
                                    if(eq == 0){
                                        if(message.destinationName == house_master + "/data_sensor/filter") {
                                            var result = message.payloadString;
                                            var parseJSON = $.parseJSON(result);
                                            // console.log(parseJSON)
                                            var time_t = parseJSON['time'];
                                            var ntime = time_t.substring(0, 5);
                                            $(".date").html(parseJSON['date']+' '+ntime);
                                            // $(".time").html(ntime);
                                            var data_ = parseJSON['data']
                                            // console.log(sensor)
                                            // alert(moment(new Date()).add(-5, 'minutes').format('YYYY-MM-DD HH:mm'));

                                            // ======================================================================
                                            for (var i = 1; i <= 7; i++) {
                                                if (config_sn['sn_status_' + i] == 1) {
                                                    if (config_sn['sn_sensor_'+i] == 1) {
                                                        dash_status(( data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] *1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 2) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 3) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] * 1).toFixed(1), set_maxmin.Smax, set_maxmin.Smin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 4) {
                                                        dash_status(( data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 5) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] / 54).toFixed(1), set_maxmin.Lmax,set_maxmin.Lmi, config_sn['sn_sensor_'+i], i);
                                                    }
                                                }
                                            }

                                            function dash_status(sn_data, max, min, mode, i) {
                                                if(mode == 4 || mode == 5){
                                                    if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/Light_Night.svg");
                                                    }else {
                                                        if (parseFloat(sn_data) >= parseFloat(max)) {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMax);
                                                        } else if (parseFloat(sn_data) < parseFloat(min)) {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMin);
                                                        } else {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgNor);
                                                        }
                                                    }
                                                }
                                                else {
                                                    if (parseFloat(sn_data) >= parseFloat(max)) {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMax);
                                                    } else if (parseFloat(sn_data) < parseFloat(min)) {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMin);
                                                    } else {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgNor);
                                                    }
                                                }
                                                // data
                                                if(mode == 1 || mode == 2){
                                                    if(parseFloat(sn_data) == 0){
                                                        if (sensor[(mode - 1)].sensor_unit == 1) {
                                                            $(".dash_data__" + i).html( sn_data + " ℃").addClass('text-danger');
                                                        }else {
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                        }
                                                    }else { // data != 0
                                                        if (sensor[(mode - 1)].sensor_unit == 1) {
                                                            $(".dash_data__" + i).html( sn_data + " ℃").removeClass('text-danger');
                                                        }else {
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                        }
                                                    }
                                                }
                                                else if(mode == 4 || mode == 5){
                                                    if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                                        // กลางคืน
                                                        if(parseFloat(sn_data) == 0){
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit)//.addClass('text-danger');
                                                        }else {
                                                            if (mode == 4){
                                                                if(parseFloat(sn_data) == 262.1){
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                            else if (mode == 5){
                                                                if (parseFloat(sn_data) == 4854.4) {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                        }
                                                    }else { // กลางวัย
                                                        if(parseFloat(sn_data) == 0){
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                        }else {
                                                            if (mode == 4){
                                                                if(parseFloat(sn_data) == 262.1){
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                            else if (mode == 5){
                                                                if (parseFloat(sn_data) == 4854.4) {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                else {
                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                }
                                            }
                                            // ===================================================================
                                            // for (var i = 1; i <= 7; i++) {
                                            //     // console.log(config_sn['sn_sensor_'+i])
                                            //     //
                                            //     if (config_sn['sn_status_' + i] == 1) {
                                            //         if (i == 1) {
                                            //             dash_status( (data_['temp_out'] * 1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, '', i)
                                            //         } else if (i == 2) {
                                            //             dash_status( (data_['hum_out'] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, '', i)
                                            //         } else if (i == 3) {
                                            //             dash_status( (data_['light_out'] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, 4, i)
                                            //         } else if (i == 4) {
                                            //             dash_status( (data_['temp_in'] * 1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, '', i)
                                            //         } else if (i == 5) {
                                            //             dash_status( (data_['hum_in'] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, '', i)
                                            //         } else if (i == 6) {
                                            //             dash_status( (data_['light_in'] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, 4, i)
                                            //         } else if (i == 7) {
                                            //             dash_status( (data_['soil_in'] * 1).toFixed(1), set_maxmin.Smax, set_maxmin.Smin, '', i)
                                            //         }
                                            //     }
                                            // }
                                            //
                                            // function dash_status(sn_data, max, min, mode, i) {
                                            //     // console.log('i='+i+' sn_data='+sn_data+' max='+max+' min='+min+' mode='+mode+' imgMax='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax+' imgMin='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin+' imgNor='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //     if(mode >= 4 && mode < 8){
                                            //         // alert(moment(new Date()).format('HH:mm') +' > '+ moment('18:40','HH:mm').format('HH:mm'))
                                            //         if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/Light_Night.svg");
                                            //         }else {
                                            //             if (parseInt(sn_data) >= parseInt(max)) {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax);
                                            //             } else if (parseInt(sn_data) < parseInt(min)) {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin);
                                            //             } else {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //             }
                                            //         }
                                            //     }else {
                                            //         if (parseInt(sn_data) >= parseInt(max)) {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax);
                                            //         } else if (parseInt(sn_data) < parseInt(min)) {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin);
                                            //         } else {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //         }
                                            //     }
                                            //     if (sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit == 1) {
                                            //         $(".dash_data__" + i).html(sn_data + " ℃");
                                            //     } else {
                                            //         $(".dash_data__" + i).html(sn_data + " " + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit);
                                            //     }
                                            // }
                                            // Chart ----------------------------------------
                                            if(data_temp_in.length > 0){
                                                // console.log(data_temp_out.length);
                                                data_temp_out.shift();
                                                data_temp_in.shift();
                                                data_temp_out.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['temp_out'] * 1).toFixed(1)
                                                })
                                                // console.log(data_temp_out);
                                                data_temp_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['temp_in'] * 1).toFixed(1)
                                                })
                                                chartLine1.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_1,
                                                        data: data_temp_out
                                                    }, {
                                                        name: config_sn.sn_name_4,
                                                        data: data_temp_in
                                                    }
                                                ])
                                            }
                                            if(data_hum_in.length > 0){
                                                data_hum_out.shift();
                                                data_hum_in.shift();
                                                data_hum_out.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y: (data_['hum_out'] * 1).toFixed(1)
                                                })
                                                data_hum_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y: (data_['hum_in'] * 1).toFixed(1)
                                                })
                                                chartLine2.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_2,
                                                        data: data_hum_out
                                                    }, {
                                                        name: config_sn.sn_name_5,
                                                        data: data_hum_in
                                                    }
                                                ])
                                            }
                                            if(data_light_in.length > 0){
                                                data_light_out.shift();
                                                data_light_in.shift();
                                                if(config_sn['sn_sensor_3'] == 4){
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_out'] / 1000).toFixed(1)
                                                    })
                                                }else if(config_sn['sn_sensor_3'] == 5){
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_out'] / 54).toFixed(1)
                                                    })
                                                }else {
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:data_['light_out'].toFixed(1)
                                                    })
                                                }
                                                if(config_sn['sn_sensor_6'] == 4){
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_in'] / 1000).toFixed(1)
                                                    })
                                                }else if(config_sn['sn_sensor_6'] == 5){
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_in'] / 54).toFixed(1)
                                                    })
                                                }else {
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y: data_['light_in'].toFixed(1)
                                                    })
                                                }
                                                chartLine3.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_3,
                                                        data: data_light_out
                                                    }, {
                                                        name: config_sn.sn_name_6,
                                                        data: data_light_in
                                                    }
                                                ])
                                            }
                                            if(data_soil_in.length > 0){
                                                data_soil_in.shift();
                                                data_soil_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['soil_in'] * 1).toFixed(1)
                                                })
                                                chartLine4.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_7,
                                                        data: data_soil_in
                                                    }
                                                ])
                                            }
                                        }
                                    }
                                    else {
                                        if(message.destinationName == house_master + "/data_sensor/filter_eq") {
                                            var result = message.payloadString;
                                            var parseJSON = $.parseJSON(result);
                                            console.log(parseJSON)
                                            var time_t = parseJSON['time'];
                                            var ntime = time_t.substring(0, 5);
                                            $(".date").html(parseJSON['date']+' '+ntime);
                                            // $(".time").html(ntime);
                                            var data_ = parseJSON['data']
                                            // console.log(sensor)
                                            // alert(moment(new Date()).add(-5, 'minutes').format('YYYY-MM-DD HH:mm'));

                                            // ======================================================================
                                            for (var i = 1; i <= 7; i++) {
                                                if (config_sn['sn_status_' + i] == 1) {
                                                    if (config_sn['sn_sensor_'+i] == 1) {
                                                        dash_status(( data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] *1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 2) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 3) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] * 1).toFixed(1), set_maxmin.Smax, set_maxmin.Smin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 4) {
                                                        dash_status(( data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, config_sn['sn_sensor_'+i], i);
                                                    }
                                                    else if (config_sn['sn_sensor_'+i] == 5) {
                                                        dash_status((  data_[config_sn['sn_channel_'+i].substring(5, (config_sn['sn_channel_'+i].length -2) )] / 54).toFixed(1), set_maxmin.Lmax,set_maxmin.Lmi, config_sn['sn_sensor_'+i], i);
                                                    }
                                                }
                                            }

                                            function dash_status(sn_data, max, min, mode, i) {
                                                if(mode == 4 || mode == 5){
                                                    if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/Light_Night.svg");
                                                    }else {
                                                        if (parseFloat(sn_data) >= parseFloat(max)) {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMax);
                                                        } else if (parseFloat(sn_data) < parseFloat(min)) {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMin);
                                                        } else {
                                                            $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgNor);
                                                        }
                                                    }
                                                }
                                                else {
                                                    if (parseFloat(sn_data) >= parseFloat(max)) {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMax);
                                                    } else if (parseFloat(sn_data) < parseFloat(min)) {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgMin);
                                                    } else {
                                                        $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(mode - 1)].sensor_imgNor);
                                                    }
                                                }
                                                // data
                                                if(mode == 1 || mode == 2){
                                                    if(parseFloat(sn_data) == 0){
                                                        if (sensor[(mode - 1)].sensor_unit == 1) {
                                                            $(".dash_data__" + i).html( sn_data + " ℃").addClass('text-danger');
                                                        }else {
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                        }
                                                    }else { // data != 0
                                                        if (sensor[(mode - 1)].sensor_unit == 1) {
                                                            $(".dash_data__" + i).html( sn_data + " ℃").removeClass('text-danger');
                                                        }else {
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                        }
                                                    }
                                                }
                                                else if(mode == 4 || mode == 5){
                                                    if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                                        // กลางคืน
                                                        if(parseFloat(sn_data) == 0){
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit)//.addClass('text-danger');
                                                        }else {
                                                            if (mode == 4){
                                                                if(parseFloat(sn_data) == 262.1){
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                            else if (mode == 5){
                                                                if (parseFloat(sn_data) == 4854.4) {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                        }
                                                    }else { // กลางวัย
                                                        if(parseFloat(sn_data) == 0){
                                                            $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                        }else {
                                                            if (mode == 4){
                                                                if(parseFloat(sn_data) == 262.1){
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                            else if (mode == 5){
                                                                if (parseFloat(sn_data) == 4854.4) {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).addClass('text-danger');
                                                                }else {
                                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                                else {
                                                    $(".dash_data__" + i).html( sn_data + " "+ sensor[(mode - 1)].sensor_unit).removeClass('text-danger');
                                                }
                                            }
                                            // ===================================================================
                                            // for (var i = 1; i <= 7; i++) {
                                            //     // console.log(config_sn['sn_sensor_'+i])
                                            //     //
                                            //     if (config_sn['sn_status_' + i] == 1) {
                                            //         if (i == 1) {
                                            //             dash_status( (data_['temp_out'] * 1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, '', i)
                                            //         } else if (i == 2) {
                                            //             dash_status( (data_['hum_out'] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, '', i)
                                            //         } else if (i == 3) {
                                            //             dash_status( (data_['light_out'] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, 4, i)
                                            //         } else if (i == 4) {
                                            //             dash_status( (data_['temp_in'] * 1).toFixed(1), set_maxmin.Tmax, set_maxmin.Tmin, '', i)
                                            //         } else if (i == 5) {
                                            //             dash_status( (data_['hum_in'] * 1).toFixed(1), set_maxmin.Hmax, set_maxmin.Hmin, '', i)
                                            //         } else if (i == 6) {
                                            //             dash_status( (data_['light_in'] / 1000).toFixed(1), set_maxmin.Lmax, set_maxmin.Lmin, 4, i)
                                            //         } else if (i == 7) {
                                            //             dash_status( (data_['soil_in'] * 1).toFixed(1), set_maxmin.Smax, set_maxmin.Smin, '', i)
                                            //         }
                                            //     }
                                            // }
                                            //
                                            // function dash_status(sn_data, max, min, mode, i) {
                                            //     // console.log('i='+i+' sn_data='+sn_data+' max='+max+' min='+min+' mode='+mode+' imgMax='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax+' imgMin='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin+' imgNor='+sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //     if(mode >= 4 && mode < 8){
                                            //         // alert(moment(new Date()).format('HH:mm') +' > '+ moment('18:40','HH:mm').format('HH:mm'))
                                            //         if(moment(new Date()).format('HH:mm') > moment('18:40','HH:mm').format('HH:mm') || moment(new Date()).format('HH:mm') < moment('05:40','HH:mm').format('HH:mm')){
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/Light_Night.svg");
                                            //         }else {
                                            //             if (parseInt(sn_data) >= parseInt(max)) {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax);
                                            //             } else if (parseInt(sn_data) < parseInt(min)) {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin);
                                            //             } else {
                                            //                 $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //             }
                                            //         }
                                            //     }else {
                                            //         if (parseInt(sn_data) >= parseInt(max)) {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMax);
                                            //         } else if (parseInt(sn_data) < parseInt(min)) {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgMin);
                                            //         } else {
                                            //             $(".dash_img_" + i).attr("src", "public/images/Sensor/" + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_imgNor);
                                            //         }
                                            //     }
                                            //     if (sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit == 1) {
                                            //         $(".dash_data__" + i).html(sn_data + " ℃");
                                            //     } else {
                                            //         $(".dash_data__" + i).html(sn_data + " " + sensor[(config_sn['sn_sensor_' + i] - 1)].sensor_unit);
                                            //     }
                                            // }
                                            // Chart ----------------------------------------
                                            if(data_temp_in.length > 0){
                                                // console.log(data_temp_out.length);
                                                data_temp_out.shift();
                                                data_temp_in.shift();
                                                data_temp_out.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['temp_out'] * 1).toFixed(1)
                                                })
                                                // console.log(data_temp_out);
                                                data_temp_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['temp_in'] * 1).toFixed(1)
                                                })
                                                chartLine1.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_1,
                                                        data: data_temp_out
                                                    }, {
                                                        name: config_sn.sn_name_4,
                                                        data: data_temp_in
                                                    }
                                                ])
                                            }
                                            if(data_hum_in.length > 0){
                                                data_hum_out.shift();
                                                data_hum_in.shift();
                                                data_hum_out.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y: (data_['hum_out'] * 1).toFixed(1)
                                                })
                                                data_hum_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y: (data_['hum_in'] * 1).toFixed(1)
                                                })
                                                chartLine2.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_2,
                                                        data: data_hum_out
                                                    }, {
                                                        name: config_sn.sn_name_5,
                                                        data: data_hum_in
                                                    }
                                                ])
                                            }
                                            if(data_light_in.length > 0){
                                                data_light_out.shift();
                                                data_light_in.shift();
                                                if(config_sn['sn_sensor_3'] == 4){
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_out'] / 1000).toFixed(1)
                                                    })
                                                }else if(config_sn['sn_sensor_3'] == 5){
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_out'] / 54).toFixed(1)
                                                    })
                                                }else {
                                                    data_light_out.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:data_['light_out'].toFixed(1)
                                                    })
                                                }
                                                if(config_sn['sn_sensor_6'] == 4){
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_in'] / 1000).toFixed(1)
                                                    })
                                                }else if(config_sn['sn_sensor_6'] == 5){
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y:(data_['light_in'] / 54).toFixed(1)
                                                    })
                                                }else {
                                                    data_light_in.push({
                                                        x: parseJSON['date']+' '+ntime,
                                                        y: data_['light_in'].toFixed(1)
                                                    })
                                                }
                                                chartLine3.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_3,
                                                        data: data_light_out
                                                    }, {
                                                        name: config_sn.sn_name_6,
                                                        data: data_light_in
                                                    }
                                                ])
                                            }
                                            if(data_soil_in.length > 0){
                                                data_soil_in.shift();
                                                data_soil_in.push({
                                                    x: parseJSON['date']+' '+ntime,
                                                    y:(data_['soil_in'] * 1).toFixed(1)
                                                })
                                                chartLine4.updateSeries([
                                                    {
                                                        name: config_sn.sn_name_7,
                                                        data: data_soil_in
                                                    }
                                                ])
                                            }
                                        }
                                    }
                                    if(message.destinationName == house_master + "/control/response") {
                                        var result = //'{"serial_id":"TUSMT008","timestamp":"2022-09-29 20:13:31.673963","version":"1.3.2.3r2","mode":"Auto","dripper_1":"ON","dripper_2":"ON","dripper_3":"ON","dripper_4":"ON","fan_1":"OFF","fan_2":"OFF","fan_3":"OFF","fan_4":"OFF","foggy_1":"OFF","foggy_2":"OFF","spray":"OFF","shading":"ON","user_control":"xzenzza"}' //
                                        message.payloadString;
                                        var parseJSON = $.parseJSON(result);
                                        // console.log(parseJSON)

                                        var parseJSON2 = $.parseJSON($('#val_config').val());
                                        var tracking = parseJSON2.config_tracking;
                                        // console.log(tracking)
                                        // console.log($('#val_sw_manual').val());
                                        // return false;
                                        // alert($('.menu_config_auto').is(":hidden"))
                                        if (parseJSON.mode === 'Manual') {
                                            $('.dash_mode').html('โหมด : กำหนดเอง').removeClass('btn-primary').addClass('btn-success')
                                            $('.sw_mode_Auto').removeClass('btn-success').addClass('btn-outline-success');
                                            $('.sw_mode_Manual').addClass('btn-success').removeClass('btn-outline-success');
                                            $('.ul_Auto').hide();
                                            $('.ul_Manual').show();
                                            $('.menu_config_manual').show();
                                            $('.status_config_manual').hide();
                                            $('#save_manual_cont').hide();
                                            $('#close_manual_cont').hide();
                                            var sw_log = parseJSON2.config_manual; //$.parseJSON($('#val_config').val());
                                            // console.log($('#val_sw_manual').val());
                                            // return false;
                                            var count_sw1 = [];
                                            var count_stats1_on = [];
                                            var count_sw2 = [];
                                            var count_stats2_on = [];
                                            var count_sw3 = [];
                                            var count_stats3_on = [];
                                            if(sw_log.dripper_1 == 'ON'){ count_sw1[1] = 1; }else { count_sw1[1] = 0; }
                                            if(sw_log.dripper_2 == 'ON'){ count_sw1[2] = 1; }else { count_sw1[2] = 0; }
                                            if(sw_log.dripper_3 == 'ON'){ count_sw1[3] = 1; }else { count_sw1[3] = 0; }
                                            if(sw_log.dripper_4 == 'ON'){ count_sw1[4] = 1; }else { count_sw1[4] = 0; }
                                            if(parseJSON.dripper_1 == 'ON'){ count_stats1_on[1] = 1; }else { count_stats1_on[1] = 0; }
                                            if(parseJSON.dripper_2 == 'ON'){ count_stats1_on[2] = 1; }else { count_stats1_on[2] = 0; }
                                            if(parseJSON.dripper_3 == 'ON'){ count_stats1_on[3] = 1; }else { count_stats1_on[3] = 0; }
                                            if(parseJSON.dripper_4 == 'ON'){ count_stats1_on[4] = 1; }else { count_stats1_on[4] = 0; }
                                            if(sw_log.fan_1 == 'ON'){ count_sw2[1] = 1; }else { count_sw2[1] = 0; }
                                            if(sw_log.fan_2 == 'ON'){ count_sw2[2] = 1; }else { count_sw2[2] = 0; }
                                            if(sw_log.fan_3 == 'ON'){ count_sw2[3] = 1; }else { count_sw2[3] = 0; }
                                            if(sw_log.fan_4 == 'ON'){ count_sw2[4] = 1; }else { count_sw2[4] = 0; }
                                            if(parseJSON.fan_1 == 'ON'){ count_stats2_on[1] = 1; }else { count_stats2_on[1] = 0; }
                                            if(parseJSON.fan_2 == 'ON'){ count_stats2_on[2] = 1; }else { count_stats2_on[2] = 0; }
                                            if(parseJSON.fan_3 == 'ON'){ count_stats2_on[3] = 1; }else { count_stats2_on[3] = 0; }
                                            if(parseJSON.fan_4 == 'ON'){ count_stats2_on[4] = 1; }else { count_stats2_on[4] = 0; }
                                            if(sw_log.foggy_1 == 'ON'){ count_sw3[1] = 1; }else { count_sw3[1] = 0; }
                                            if(sw_log.foggy_2 == 'ON'){ count_sw3[2] = 1; }else { count_sw3[2] = 0; }
                                            if(parseJSON.foggy_1 == 'ON'){ count_stats3_on[1] = 1; }else { count_stats3_on[1] = 0; }
                                            if(parseJSON.foggy_2 == 'ON'){ count_stats3_on[2] = 1; }else { count_stats3_on[2] = 0; }

                                            $('.sw_sel_load_manual').click(function(){
                                                var numb = Number($(this).attr('id').substring(1));
                                                if($('#close_manual_cont').is(":hidden") != false){
                                                    fn_check_sw_on_off(numb);
                                                }
                                            });
                                            fn_check_sw_on_off($('.hidden_select_sw_manual').val());
                                            function fn_check_sw_on_off(val){
                                                if(val == 1){ // dripper
                                                    if(countElement(1,count_sw1) == countElement(1,count_stats1_on)){
                                                        $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                                        $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                                    }
                                                    else {
                                                        $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                                        $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                                    }
                                                }
                                                else if(val == 2){ // FAN
                                                    if(countElement(1,count_sw2) == countElement(1,count_stats2_on)){
                                                        $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                                        $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                                    }else {
                                                        $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                                        $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                                    }
                                                }
                                                else if(val == 3){ // foggy
                                                    if(countElement(1,count_sw3) == countElement(1,count_stats3_on)){
                                                        $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                                        $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                                    }else {
                                                        $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                                        $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                                    }
                                                }
                                                else if(val == 4){ // spray
                                                    if(parseJSON.spray == 'ON'){
                                                        $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                                        $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                                    }else {
                                                        $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                                        $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                                    }
                                                }
                                                else if(val == 5){ // shading
                                                    if(parseJSON.shading == 'ON'){
                                                        $('.sw_manual_on').addClass('active').html('<img src="public/images/icons/menu_control/on_on.png" width="75" />');
                                                        $('.sw_manual_off').removeClass('active').html('<img src="public/images/icons/menu_control/off_off.png" width="75" />');
                                                    }else {
                                                        $('.sw_manual_on').removeClass('active').html('<img src="public/images/icons/menu_control/on_off.png" width="75" />');
                                                        $('.sw_manual_off').addClass('active').html('<img src="public/images/icons/menu_control/off_on.png" width="75" />');
                                                    }
                                                }
                                            }
                                            if(countElement(1,count_sw1) == countElement(1,count_stats1_on)){
                                                $('.img_sw_sel_load_manual_1').attr('src','public/images/icons/menu_control/dripper_on.png');
                                            }else {
                                                $('.img_sw_sel_load_manual_1').attr('src','public/images/icons/menu_control/dripper_off.png');
                                            }
                                            if(countElement(1,count_sw2) == countElement(1,count_stats2_on)){
                                                $('.img_sw_sel_load_manual_2').attr('src','public/images/icons/menu_control/fan_on.png');
                                            }else {
                                                $('.img_sw_sel_load_manual_2').attr('src','public/images/icons/menu_control/fan_off.png');
                                            }
                                            if(countElement(1,count_sw3) == countElement(1,count_stats3_on)){
                                                $('.img_sw_sel_load_manual_3').attr('src','public/images/icons/menu_control/foggy_on.png');
                                            }else {
                                                $('.img_sw_sel_load_manual_3').attr('src','public/images/icons/menu_control/foggy_off.png');
                                            }
                                            if(parseJSON.spray == 'ON'){
                                                $('.img_sw_sel_load_manual_4').attr('src','public/images/icons/menu_control/spray_on.png');
                                            }else {
                                                $('.img_sw_sel_load_manual_4').attr('src','public/images/icons/menu_control/spray_off.png');
                                            }
                                            if(parseJSON.shading == 'ON'){
                                                $('.img_sw_sel_load_manual_5').attr('src','public/images/icons/menu_control/shading_on.png');
                                            }else {
                                                $('.img_sw_sel_load_manual_5').attr('src','public/images/icons/menu_control/shading_off.png');
                                            }

                                            // status control dashboard Manual
                                            for (var i = 1; i <= 12; i++) {
                                                if (i <= 4) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parseJSON['dripper_' + i] === 'OFF') {
                                                            if(sw_log['dripper_'+i] == 'ON'){
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                            }else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                            }
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                                        }
                                                        else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_on.png');
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                                    }
                                                }
                                                if (i > 4 && i <= 8) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parseJSON['fan_' + (i - 4)] === 'OFF') {
                                                            if(sw_log['fan_'+(i - 4)] === 'ON'){
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                                            }else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                            }
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                                        } else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-on.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_on.png');
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                                    }
                                                }
                                                if (i == 9 || i == 10) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parseJSON['foggy_' + (i - 8)] === 'OFF') {
                                                            if(sw_log['foggy_'+(i - 8)] === 'ON'){
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                                            }else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                            }
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                                        } else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-on.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_on.png');
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                                    }
                                                }
                                                if (i == 11) {
                                                    if (config_cn['cn_status_' + i] == 1) {
                                                        if (parseJSON['spray'] === 'OFF') {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-off.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                                        } else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-on.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_on.png');
                                                        }
                                                    }
                                                    else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-disable.svg");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                                    }
                                                }
                                                if (i == 12) {
                                                    if (parseJSON['shading'] === 'OFF') {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_ON2.png");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_off.png');
                                                    } else {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_OFF2.png");
                                                        $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_on.png');
                                                    }
                                                }
                                            }
                                        }
                                        else { // โหมดอัตโนมัติ
                                            $('.dash_mode').html('โหมด : อัตโนมัติ').removeClass('btn-success').addClass('btn-primary')
                                            $('.sw_mode_Auto').addClass('btn-success').removeClass('btn-outline-success')
                                            $('.sw_mode_Manual').removeClass('btn-success').addClass('btn-outline-success')
                                            $('.ul_Auto').show()
                                            $('.ul_Manual').hide()
                                            if($('#Modal_control').hasClass('show') == true){
                                                if($('.sw_mode_timer').hasClass('btn-info') == true){
                                                    if($('.menu_config_auto').is(":hidden") == false){
                                                        $(".img_sw").show();
                                                        $('.input_time').prop('disabled', true);
                                                        $(".sw_toggle").hide();
                                                        $(".menu_config_auto").show();
                                                        $("#save_auto_cont").hide();
                                                        $("#close_auto_cont").hide();
                                                        $(".sw_mode_Auto").attr('disabled', false);
                                                        $(".sw_mode_Manual").attr('disabled', false);
                                                        $('.sw_mode_tracking').prop('disabled', false);
                                                        $('.sw_mode_timer').prop('disabled', false);
                                                        $('.sw_mode_timeSet').prop('disabled', true);
                                                        $('.sw_mode_timeLoop').prop('disabled', true);
                                                    }
                                                }
                                                else { // Sensor_Tracking
                                                    // $('.menu_config_auto2').show();
                                                    // $('.check_').prop('disabled', true);
                                                    // range_instance4.update({ "disable": true });
                                                    // range_instance2.update({ "disable": true });
                                                    // range_instance1.update({ "disable": true });
                                                    // range_instance3.update({ "disable": true });
                                                }
                                            }
                                            if(parseJSON2.sub_mode["sub_mode"] == "Timer"){
                                                for (var i = 1; i <= 12; i++) {
                                                    if (i <= 4) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (parseJSON['dripper_' + i] === 'OFF') {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_on.png');
                                                            }
                                                        }
                                                        else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/dripper_off.png');
                                                        }
                                                    }
                                                    if (i > 4 && i <= 8) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (parseJSON['fan_' + (i - 4)] === 'OFF') {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-on.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_on.png');
                                                            }
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/fan_off.png');
                                                        }
                                                    }
                                                    if (i == 9 || i == 10) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (parseJSON['foggy_' + (i - 8)] === 'OFF') {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-on.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_on.png');
                                                            }
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/foggy_off.png');
                                                        }
                                                    }
                                                    if (i == 11) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (parseJSON['spray'] === 'OFF') {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-off.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-on.svg");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_on.png');
                                                            }
                                                        }else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-disable.svg");
                                                            $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/spray_off.png');
                                                        }
                                                    }
                                                    if (i == 12) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (parseJSON['shading'] === 'OFF') {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_ON2.png");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_off.png');
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_OFF2.png");
                                                                $('.img_sw_sel_load_auto'+i).attr('src','public/images/icons/menu_control/shading_on.png');
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                            else { // Tracking
                                                if (tracking.status_1 == 1) {
                                                    for (var i = 1; i <= 4; i++) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (tracking['dripper_' + i] === 'ON') {
                                                                if (parseJSON['dripper_' + i] === 'OFF') {
                                                                    $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                                } else {
                                                                    $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                                                }
                                                            } else {
                                                                $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                            }
                                                        }
                                                        else {
                                                            $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                        }
                                                    }
                                                }
                                                else {
                                                    for (var i = 1; i <= 4; i++) {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                    }
                                                }
                                                if (tracking.status_2 == 1 || tracking.status_3 == 1) {
                                                    if (config_cn['cn_status_9'] == 1) {
                                                        if (parseJSON['foggy_1'] === 'OFF') {
                                                            $(".dash_img_con_9").attr("src", "public/images/control/TU/foggy-off.svg");
                                                        } else {
                                                            $(".dash_img_con_9").attr("src", "public/images/control/TU/foggy-on.svg");
                                                        }
                                                    }else {
                                                        $(".dash_img_con_9").attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    }
                                                    $(".dash_img_con_10").attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    if (config_cn['cn_status_11'] == 1) {
                                                        if (parseJSON['spray'] === 'OFF') {
                                                            $(".dash_img_con_11").attr("src", "public/images/control/TU/spray-off.svg");
                                                        } else {
                                                            $(".dash_img_con_11").attr("src", "public/images/control/TU/spray-on.svg");
                                                        }
                                                    }else {
                                                        $(".dash_img_con_11").attr("src", "public/images/control/TU/spray-disable.svg");
                                                    }
                                                }else {
                                                    $(".dash_img_con_9").attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    $(".dash_img_con_10").attr("src", "public/images/control/TU/foggy-disable.svg");
                                                    $(".dash_img_con_11").attr("src", "public/images/control/TU/spray-disable.svg");
                                                }
                                                if (tracking.status_3 == 1) {
                                                    for (var i = 1; i <= 4; i++) {
                                                        if (config_cn['cn_status_' + i] == 1) {
                                                            if (tracking['fan_' + i] === 'ON') {
                                                                if (parseJSON['fan_' + i] === 'OFF') {
                                                                    $(".dash_img_con_" + (i + 4)).attr("src", "public/images/control/TU/fan-off.svg");
                                                                } else {
                                                                    $(".dash_img_con_" + (i + 4)).attr("src", "public/images/control/TU/fan-on.svg");
                                                                }
                                                            } else {
                                                                $(".dash_img_con_" + (i + 4)).attr("src", "public/images/control/TU/fan-disable.svg");
                                                            }
                                                        }else {
                                                            $(".dash_img_con_" + (i + 4)).attr("src", "public/images/control/TU/fan-disable.svg");
                                                        }
                                                    }
                                                }
                                                else {
                                                    for (var i = 5; i <= 8; i++) {
                                                        $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                    }
                                                }
                                                if (tracking.status_4 == 1) {
                                                    if (config_cn['cn_status_12'] == 1) {
                                                        if (parseJSON['shading'] === 'OFF') {
                                                            $(".dash_img_con_12").attr("src", "public/images/control/Roof_ON2.png");
                                                        } else {
                                                            $(".dash_img_con_12").attr("src", "public/images/control/Roof_OFF2.png");
                                                        }
                                                    }
                                                }else {
                                                    $(".dash_img_con_12").attr("src", "public/images/control/Roof_ON2.png");
                                                }
                                                // for (var i = 1; i <= 12; i++) {
                                                //     if (i <= 4) {
                                                //         if (config_cn['cn_status_' + i] == 1) {
                                                //             if (tracking.config_tracking['dripper_' + i] === 'ON') {
                                                //                 if (parseJSON['dripper_' + i] === 'OFF') {
                                                //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-off.svg");
                                                //                 } else {
                                                //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/sprinkler-on.svg");
                                                //                 }
                                                //             } else {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                //             }
                                                //         }
                                                //         else {
                                                //             $(".dash_img_con_" + i).attr("src", "public/images/control/TU/Sprinkler_disable.svg");
                                                //         }
                                                //     }
                                                //     if (i > 4 && i <= 8) {
                                                //         if (config_cn['cn_status_' + i] == 1) {
                                                //             if (tracking.config_tracking['fan_' + (i - 4)] === 'ON') {
                                                //                 if (parseJSON['fan_' + (i - 4)] === 'OFF') {
                                                //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-off.svg");
                                                //                 } else {
                                                //                     $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-on.svg");
                                                //                 }
                                                //             } else {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                //             }
                                                //         }else {
                                                //             $(".dash_img_con_" + i).attr("src", "public/images/control/TU/fan-disable.svg");
                                                //         }
                                                //     }
                                                //     if (i == 9) {
                                                //         if (config_cn['cn_status_' + i] == 1) {
                                                //             if (parseJSON['foggy_' + (i - 8)] === 'OFF') {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-off.svg");
                                                //             } else {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-on.svg");
                                                //             }
                                                //         }else {
                                                //             $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                //         }
                                                //     }
                                                //     if(i == 10){
                                                //         $(".dash_img_con_" + i).attr("src", "public/images/control/TU/foggy-disable.svg");
                                                //     }
                                                //     if (i == 11) {
                                                //         if (config_cn['cn_status_' + i] == 1) {
                                                //             if (parseJSON['spray'] === 'OFF') {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-off.svg");
                                                //             } else {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-on.svg");
                                                //             }
                                                //         }else {
                                                //             $(".dash_img_con_" + i).attr("src", "public/images/control/TU/spray-disable.svg");
                                                //         }
                                                //     }
                                                //     if (i == 12) {
                                                //         if (config_cn['cn_status_' + i] == 1) {
                                                //             if (parseJSON['shading'] === 'OFF') {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_ON2.png");
                                                //             } else {
                                                //                 $(".dash_img_con_" + i).attr("src", "public/images/control/Roof_OFF2.png");
                                                //             }
                                                //         }
                                                //     }
                                                // }
                                            }
                                        }
                                    }
                                    if(message.destinationName == house_master + "/control/loads/spanel"){
                                        var result = message.payloadString;
                                        // alert(house_master)
                                        if(result == 'lock'){
                                            $('.dash_panel_mode').html('ปุ่มกดหน้าตู้ : ล็อค').removeClass('btn-info').addClass('btn-warning');
                                            $('.sw_mode_lock').addClass('active');
                                            $('.sw_mode_unlock').removeClass('active');
                                        }else {
                                            $('.dash_panel_mode').html('ปุ่มกดหน้าตู้ : ปลดล็อค').removeClass('btn-warning').addClass('btn-info');
                                            $('.sw_mode_lock').removeClass('active');
                                            $('.sw_mode_unlock').addClass('active');
                                        }
                                    }
                                    if(message.destinationName == "web_system"){
                                        var result = message.payloadString;
                                        var parseJSON = $.parseJSON(result);
                                        // console.log(parseJSON[res.account_id]['dt'])
                                        if(timeoutId != 0){clearInterval(timeoutId);}
                                        timeoutId = setInterval(function() {
                                            // console.log(
                                            //     moment(new Date()).format('YYYY-MM-DD HH:mm:ss')
                                                // new Date().toLocaleString()
                                            // );
                                            // console.log(moment('2022-08-12 11:03:10').format('YYYY-MM-DD HH:mm:ss'));
                                            // console.log(moment(parseJSON[res.account_id]['dt']).format('YYYY-MM-DD HH:mm:ss'));
                                            if(isset(parseJSON[res.account_id]['dt']) == false){
                                                // alert('a')
                                                logout();
                                                clearInterval(timeoutId);
                                            }
                                            // if(moment(new Date()).format('YYYY-MM-DD HH:mm:ss') >= moment(parseJSON[res.account_id]['dt']).format('YYYY-MM-DD HH:mm:ss') ){
                                            //     logout();
                                            //     clearInterval(timeoutId);
                                            //     // alert('ok')
                                            // }
                                        }, 1000);
                                    }
                                }// exit_message
                                loadingOut(loading);
                                connect();
                                // ++++++++++++++++++++++++++++++++++
                            }
                        });

                        $.ajax({
                            url: "routes/tu/pages_report.php",
                            method: "post",
                            data: {
                                data: res,
                                s_sensor: s_sensor,
                                count_cn: getArraySum(res.controlstatus)
                            },
                            // dataType: "json",
                            success: function(res_dash) {
                                $("#load_pages_report").html(res_dash);
                            }
                        });
                        // ===============================================
                        var optionsLine = {
                            chart: {
                                id: 'realtime',
                                foreColor: '#9ba7b2',
                                height: 560,
                                type: 'line',
                                toolbar: {
                                    show: false,
                                    tools: {
                                        download: false,
                                        selection: true,
                                         zoom: true,
                                         zoomin: true,
                                         zoomout: true,
                                         pan: true,
                                    }
                                },
                                dropShadow: {
                                    enabled: true,
                                    top: 3,
                                    left: 2,
                                    blur: 4,
                                    opacity: 0.1,
                                }
                            },
                            stroke: {
                                curve: 'smooth',
                                width: 3
                            },
                            // colors: ["#0d6efd", '#212529'],
                            // series: [{
                            //   data: data.slice()
                            // }],
                            series: [],
                            // [{
                            //     name: "temp_out",
                            //     data: res.data.temp_out//[1, 15, 56, 20, 33, 27]
                            // }, {
                            //     name: "temp_in",
                            //     data: res.data.temp_in//[30, 33, 21, 42, 19, 32]
                            // }],
                            title: {
                                // text: 'Multiline Chart',
                                align: 'left',
                                offsetY: 30,
                                // offsetX: 20
                            },
                            animations: {
                              enabled: true,
                              easing: 'linear',
                              // dynamicAnimation: {
                              //   speed: 1000
                              // }
                            },
                            markers: {
                                size: 1,
                                strokeWidth: 0,
                                hover: {
                                    size: 6
                                }
                            },
                            grid: {
                                show: true,
                                padding: {
                                    bottom: 0
                                }
                            },
                            xaxis: {
                                type: 'datetime',
                                // categories:res.data.timestamp,
                                labels: {
                                    datetimeUTC: false,
                                    // format: 'dd/MM HH:mm',
                                    datetimeFormatter: {
                                        year: 'yyyy',
                                        month: 'MMM \'yy',
                                        day: 'dd MMM',
                                        hour: 'HH:mm'
                                    }
                                }
                            },
                            legend: {
                                // position: 'top',
                                // horizontalAlign: 'right',
                                // offsetY: -30
                            },
                            fill: {
                                type: "solid",
                                fillOpacity: 0.7
                            },
                            noData: {
                                text: 'Loading...'
                            },
                            tooltip: {
                                x: {
                                    format: 'yyyy-MM-dd HH:mm'
                                },
                            }
                        }
                        var chartLine1 = new ApexCharts(document.querySelector('#chart1'), optionsLine);
                        chartLine1.render();
                        var chartLine2 = new ApexCharts(document.querySelector('#chart2'), optionsLine);
                        chartLine2.render();
                        var chartLine3 = new ApexCharts(document.querySelector('#chart3'), optionsLine);
                        chartLine3.render();
                        var chartLine4 = new ApexCharts(document.querySelector('#chart4'), optionsLine);
                        chartLine4.render();

                        $.ajax({
                            url: "routes/tu/get_chart_realtime.php",
                            method: "post",
                            data: {
                                house_master: house_master,
                                config_sn: config_sn,
                                eq: eq
                            },
                            dataType: "json",
                            success: function(res) {
                                // console.log(res);
                                // console.log(res.data);
                                data_temp_out = res.data.temp_out;
                                data_temp_in = res.data.temp_in;
                                data_hum_out = res.data.hum_out;
                                data_hum_in = res.data.hum_in;
                                data_light_out = res.data.light_out;
                                data_light_in = res.data.light_in;
                                data_soil_in = res.data.soil_in;

                                // if(s_sensor.s_btnT > 0){
                                    chartLine1.updateSeries([
                                        {
                                            name: config_sn.sn_name_1,
                                            data: data_temp_out
                                        }, {
                                            name: config_sn.sn_name_4,
                                            data: data_temp_in
                                        }
                                    ])
                                    chartLine1.updateOptions({
                                        title:  {text: 'อุณหภูมิ (℃)'},
                                        tooltip: {
                                            y: {
                                            	formatter: function (val) {
                                            		return  val + " ℃"
                                            	}
                                            }
                                        },
                                        // subtitle: {
                                        //     text: '(℃)',
                                        //     offsetY: 55,
                                        //     offsetX: 10
                                        // },
                                    })
                                // }
                                // if(s_sensor.s_btnH > 0){
                                    chartLine2.updateSeries([
                                        {
                                            name: config_sn.sn_name_2,
                                            data: data_hum_out
                                        }, {
                                            name: config_sn.sn_name_5,
                                            data: data_hum_in
                                        }
                                    ]);
                                    // console.log(data_hum_out);
                                    chartLine2.updateOptions({
                                        title:  {text: 'ความชื้นอากาศ (%Rh)'},
                                        tooltip: {
                                            y: {
                                                formatter: function (val) {
                                                    return  val + " %Rh"
                                                }
                                            },
                                        },
                                        yaxis: {
                                           max: 100
                                        }
                                        // subtitle: {
                                        //     text: '(%Rh)',
                                        //     offsetY: 55,
                                        //     offsetX: 10
                                        // },
                                    });
                                // }
                                // if(s_sensor.s_btnL > 0){
                                    chartLine3.updateSeries([
                                        {
                                            name: config_sn.sn_name_3,
                                            data: data_light_out
                                        }, {
                                            name: config_sn.sn_name_6,
                                            data: data_light_in
                                        }
                                    ]);
                                    if(config_sn['sn_sensor_3'] == 4 || config_sn['sn_sensor_6'] == 4){
                                        chartLine3.updateOptions({
                                            title:  {text: 'ความเข้มแสง'},
                                            tooltip: {
                                                y: {
                                                    formatter: function (val) {
                                                        return  val + " Klux"
                                                    }
                                                }
                                            },
                                            // subtitle: {
                                            //     text: '(Klux)',
                                            //     offsetY: 55,
                                            //     offsetX: 10
                                            // },
                                        })
                                    }else if(config_sn['sn_sensor_3'] == 5 || config_sn['sn_sensor_6'] == 5){
                                        chartLine3.updateOptions({
                                            title:  {text: 'ความเข้มแสง'},
                                            tooltip: {
                                                y: {
                                                    formatter: function (val) {
                                                        return  val + " µmol m<sup>-2</sup>s<sup>-1</sup>"
                                                    }
                                                }
                                            },
                                            // subtitle: {
                                            //     text: '(Klux)',
                                            //     offsetY: 55,
                                            //     offsetX: 10
                                            // },
                                        })
                                    }
                                // }
                                // if(s_sensor.s_btnS > 0){
                                    chartLine4.updateSeries([
                                        {
                                            name: config_sn.sn_name_7,
                                            data: data_soil_in
                                        }]
                                    )
                                    chartLine4.updateOptions({
                                        title:  {text: 'ความชื้นดิน (%)'},
                                        tooltip: {
                                            y: {
                                                formatter: function (val) {
                                                    return  val + " %"
                                                }
                                            }
                                        },
                                        // subtitle: {
                                        //     text: '(%)',
                                        //     offsetY: 55,
                                        //     offsetX: 10
                                        // },
                                    })
                                // }
                            }
                        });
                        // ===============================================
                        $('.btn_ch_t ').click(function(){
                            setTimeout(function(){
                                if(data_temp_in.length > 0){
                                    chartLine1.updateSeries([
                                        {
                                            name: config_sn.sn_name_1,
                                            data: data_temp_out
                                        }, {
                                            name: config_sn.sn_name_4,
                                            data: data_temp_in
                                        }
                                    ])
                                }
                            }, 1000);
                        })
                        $('.btn_ch_h ').click(function(){
                            setTimeout(function(){
                                if(data_hum_in.length > 0){
                                    chartLine2.updateSeries([
                                        {
                                            name: config_sn.sn_name_2,
                                            data: data_hum_out
                                        }, {
                                            name: config_sn.sn_name_5,
                                            data: data_hum_in
                                        }
                                    ])
                                }
                            }, 1000);
                        })
                        $('.btn_ch_l ').click(function(){
                            setTimeout(function(){
                                if(data_light_in.length > 0){
                                    chartLine3.updateSeries([
                                        {
                                            name: config_sn.sn_name_3,
                                            data: data_light_out
                                        }, {
                                            name: config_sn.sn_name_6,
                                            data: data_light_in
                                        }
                                    ])
                                }
                            }, 1000);
                        })
                        $('.btn_ch_s ').click(function(){
                            setTimeout(function(){
                                if(data_soil_in.length > 0){
                                    chartLine4.updateSeries([
                                        {
                                            name: config_sn.sn_name_7,
                                            data: data_soil_in
                                        }]
                                    )
                                }
                            }, 1000);
                        })
                    }
                }); // ajax
            } // V4
        } else { // No sn
            $(".memu_dash").hide()
            $(".memu_report").hide();
        }

        function getArraySum(a) {
            // count array
            var total = 0;
            for (var i in a) {
                total += a[i];
            }
            return total;
        }
        // count array by value
        function countElement(item,array) {
            var count = 0;
            $.each(array, function(i,v) { if (v === item) count++; });
            return count;
        }
        function isset(v){
            if(v === 'undefined'){
                return false;
            }
            return true;
        }
        // sn2 start '2022-07-06 11:11',
        //           '2022-07-07 09:26',
        // sn2 start '2022-08-15 14:57', ///

        // sn3 start '2022-06-28 17:36', //
        //           '2022-07-01 09:57',
        // sn3 start '2022-08-10 15:18', ///

        // sn4 start '2022-08-05 14:11', ///

        // sn5 start '2022-08-15 18:01', ///
        //           '2022-08-16 20:08', ///
        // sn5 start '2022-08-17 06:02', ///

        // sn6 start '2022-08-17 15:45', ///

        // sn7 start '2022-08-10 15:55', ///
        // 2022-09-13 16:56:00
        // 2022-09-20 18:00:00
    </script>

    <script>
        $("#submit_suggestion_modal").click(function() {
            if ($(".sg_title").val() === "") {
                $(".sg_title").addClass("is-invalid");
                return false;
            } else {
                $(".sg_title").removeClass("is-invalid");
            }
            if ($(".sg_name").val() === "") {
                $(".sg_name").addClass("is-invalid");
                return false;
            } else {
                $(".sg_name").removeClass("is-invalid");
            }
            if ($(".sg_email").val() === "") {
                $(".sg_email").addClass("is-invalid");
                return false;
            } else {
                $(".sg_email").removeClass("is-invalid");
            }
            if ($(".sg_text").val() === "") {
                $(".sg_text").addClass("is-invalid");
                return false;
            } else {
                $(".sg_text").removeClass("is-invalid");
            }
            $.ajax({
                type: "POST",
                url: "routes/insert_suggestion.php",
                data: new FormData($("#suggestion_form")[0]),
                contentType: false,
                cache: false,
                processData: false,
                success: function(res) {
                    var parseJSON = $.parseJSON(res);
                    // console.log(parseJSON.data)
                    // return false
                    if (parseJSON.status === "รูปแบบ email ไม่ถูกต้อง") {
                        swal({
                            title: 'รูปแบบอีเมลล์ไม่ถูกต้อง !',
                            // text: "" + sw_name + " ?",
                            type: 'warning',
                            allowOutsideClick: false,
                            confirmButtonColor: '#32CD32'
                        });
                        $(".p_email").addClass("is-invalid");
                        $(".bp_email").html('กรถณาระบุแีเมลล์ใหม่');
                        return false;
                    }
                    if (parseJSON.status == "Insert_Error") {
                        swal({
                            title: 'เกิดข้อผลิดพลาด !',
                            text: "บันทึกไม่สำเร็จ !!!",
                            type: 'error',
                            allowOutsideClick: false,
                            confirmButtonColor: '#32CD32'
                        }).then((result) => {
                            if (result.value) {
                                location.reload();
                            }
                        });
                        return false;
                    }
                    if (parseJSON.status == "Insert_success") {
                        swal({
                            title: 'ส่งข้อมูลสำเร็จ',
                            text: "ขอบคุณ " + $(".sg_name").val() + " สำหรับการมีส่วนร่วม ",
                            type: 'success',
                            allowOutsideClick: false,
                            confirmButtonColor: '#32CD32'
                        });
                        $("#modal_sg").modal("hide");
                    }
                }
            });
        });

        // let strdate = new Date();
        // var date = moment(new Date()).add(-10, 'minutes').format('YYYY/MM/DD - HH:mm:ss');
        // console.log(date);
    </script>
    <script type="text/javascript">
        $(".memu_site").click(function() {
            $(this).addClass('mm-active');
            // $("#load_pages_site").load('views/pages_site.php');
            if(url[1] == ''){
                $(".memu_house").hide();
                $(".memu_dash").hide();
            }else{
                $(".memu_house").removeClass("mm-active")
                if(house_master === '' || house_master.length != 8){
                    $(".memu_dash").hide();
                }else{
                    $(".memu_dash").show().removeClass("mm-active")
                }
            }
            $(".memu_report").hide()
            $('.memu_control').hide()
            // if(url[0] == 4){
            //     $(".memu_compare").show();
            // }else{
                $(".memu_compare").hide();
            // }
            $('#load_pages_site').show();
            $('#load_pages_house').hide();
            $('#load_pages_compare').hide();
            $('#load_pages_dashboard').hide();
            $('#load_pages_report').hide();
            $('#load_pages_profile').hide();
            $('.memu_setting').hide()
        });
        $(".memu_house").click(function() {
            $(this).addClass('mm-active');
            if(house_master === '' || house_master.length != 8){
                $(".memu_dash").hide();
            }else{
                $(".memu_dash").removeClass("mm-active")
            }
            $(".memu_report").hide()
            $('.memu_control').hide()
            if(url[0] == 4){
                $(".memu_compare").show();
            }else{
                $(".memu_compare").hide();
            }
            $('#load_pages_site').hide();
            $('#load_pages_house').show();
            $('#load_pages_compare').hide();
            $('#load_pages_dashboard').hide();
            $('#load_pages_report').hide();
            $('#load_pages_profile').hide();
            // $("#load_pages").load('views/pages_house.php?s='+url[1]);
            $.ajax({
                url: "views/pages_house.php",
                method: "POST",
                data: {
                    s: url[1]
                },
                // dataType: "json",
                success: function(res_dash) {
                    $("#load_pages_house").html(res_dash);
                    $('.sw_house').click(function(){
                        window.location.hash = $(this).attr("url");
                        location.reload();
                        // alert($(this).attr("url"))
                        // window.location.href = $(this).attr("url");
                    })
                }
            })
            $('.memu_setting').hide()
        });
        $(".memu_compare").click(function(){
            $(this).addClass('mm-active');
            $(".memu_house").removeClass("mm-active")
            $('#load_pages_site').hide();
            $('#load_pages_house').hide();
            $("#load_pages_compare").show().load('routes/tu/pages_compare.php?s='+url[1]);
            $('#load_pages_profile').hide();
            $('.memu_setting').hide()
        })
        $(".memu_dash").click(function() {
            $(this).addClass('mm-active');
            $(".memu_report").show();
            $(".memu_compare").hide();

            $('#load_pages_site').hide();
            $('#load_pages_house').hide();
            $('#load_pages_compare').hide();
            $('#load_pages_dashboard').show();
            $('#load_pages_report').hide();
            $('#load_pages_profile').hide();
            $('.memu_setting').hide()
        });
        $(".memu_report").click(function() {
            $('.memu_control').hide()
            $(this).addClass('mm-active');
            $(".memu_dash").show().removeClass("mm-active");
            $('#load_pages_dashboard').hide();
            $('#load_pages_report').show();
            $('#load_pages_profile').hide();
            $('.memu_setting').hide()
        });
        $(".menu_setting").click(function() {
            $('.memu_setting').show().addClass('mm-active');
            $(".memu_site").removeClass('mm-active');
            $(".memu_house").removeClass("mm-active")
            $(".memu_dash").removeClass('mm-active');
            $('.memu_control').hide()
            $(".memu_report").removeClass('mm-active');
            $('#load_pages_site').hide();
            $('#load_pages_house').hide();
            $('#load_pages_compare').hide();
            $('#load_pages_dashboard').hide();
            $('#load_pages_report').hide();
            $("#load_pages_profile").show();
            $.ajax({
                url: "routes/profile/setting_profile.php",
                method: "post",
                data: {
                    // s_master: res.s_master,
                    pt: $(this).attr('menu')
                },
                // dataType: "json",
                success: function(resp) {
                    $("#load_pages_profile").html(resp);
                }
            });
        });
    </script>
</body>

</html>
